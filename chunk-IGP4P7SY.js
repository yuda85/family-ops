import{T as Ss,X as df,c as ac,oa as Hn,tc as dn}from"./chunk-HNLZOKXJ.js";import{a as W,b as Te,c as hf,d as Kn,e as tt,f as g}from"./chunk-ATWMZ64T.js";var ff=()=>{};var gf=function(r){let e=[],t=0;for(let n=0;n<r.length;n++){let i=r.charCodeAt(n);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Ly=function(r){let e=[],t=0,n=0;for(;t<r.length;){let i=r[t++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=r[t++];e[n++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=r[t++],o=r[t++],c=r[t++],u=((i&7)<<18|(s&63)<<12|(o&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(u>>10)),e[n++]=String.fromCharCode(56320+(u&1023))}else{let s=r[t++],o=r[t++];e[n++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},_f={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<r.length;i+=3){let s=r[i],o=i+1<r.length,c=o?r[i+1]:0,u=i+2<r.length,h=u?r[i+2]:0,f=s>>2,m=(s&3)<<4|c>>4,y=(c&15)<<2|h>>6,P=h&63;u||(P=64,o||(y=64)),n.push(t[f],t[m],t[y],t[P])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(gf(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):Ly(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<r.length;){let s=t[r.charAt(i++)],c=i<r.length?t[r.charAt(i)]:0;++i;let h=i<r.length?t[r.charAt(i)]:64;++i;let m=i<r.length?t[r.charAt(i)]:64;if(++i,s==null||c==null||h==null||m==null)throw new uc;let y=s<<2|c>>4;if(n.push(y),h!==64){let P=c<<4&240|h>>2;if(n.push(P),m!==64){let k=h<<6&192|m;n.push(k)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}},uc=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},My=function(r){let e=gf(r);return _f.encodeByteArray(e,!0)},hc=function(r){return My(r).replace(/\./g,"")},Ps=function(r){try{return _f.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function dc(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Fy=()=>dc().__FIREBASE_DEFAULTS__,Uy=()=>{if(typeof process>"u"||typeof process.env>"u")return;let r=process.env.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},By=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=r&&Ps(r[1]);return e&&JSON.parse(e)},Cs=()=>{try{return ff()||Fy()||Uy()||By()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},yf=r=>Cs()?.emulatorHosts?.[r];var fc=()=>Cs()?.config,pc=r=>Cs()?.[`_${r}`];var Rs=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}};function Pt(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}function Ds(r){return g(this,null,function*(){return(yield fetch(r,{credentials:"include"})).ok})}var ii={};function qy(){let r={prod:[],emulator:[]};for(let e of Object.keys(ii))ii[e]?r.emulator.push(e):r.prod.push(e);return r}function zy(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}var pf=!1;function mc(r,e){if(typeof window>"u"||typeof document>"u"||!Pt(window.location.host)||ii[r]===e||ii[r]||pf)return;ii[r]=e;function t(y){return`__firebase__banner__${y}`}let n="__firebase__banner",s=qy().prod.length>0;function o(){let y=document.getElementById(n);y&&y.remove()}function c(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function u(y,P){y.setAttribute("width","24"),y.setAttribute("id",P),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function h(){let y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{pf=!0,o()},y}function f(y,P){y.setAttribute("id",P),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function m(){let y=zy(n),P=t("text"),k=document.getElementById(P)||document.createElement("span"),O=t("learnmore"),N=document.getElementById(O)||document.createElement("a"),$=t("preprendIcon"),z=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){let B=y.element;c(B),f(N,O);let ne=h();u(z,$),B.append(z,k,N,ne),document.body.appendChild(B)}s?(k.innerText="Preview backend disconnected.",z.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(z.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",P)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function he(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function If(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(he())}function wf(){let r=Cs()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ef(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Tf(){let r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function vf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Af(){let r=he();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function gc(){return!wf()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _c(){return!wf()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Ns(){try{return typeof indexedDB=="object"}catch{return!1}}function bf(){return new Promise((r,e)=>{try{let t=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}var jy="FirebaseError",Le=class r extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=jy,Object.setPrototypeOf(this,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ht.prototype.create)}},ht=class{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Gy(s,n):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new Le(i,c,n)}};function Gy(r,e){return r.replace($y,(t,n)=>{let i=e[n];return i!=null?String(i):`<${n}?>`})}var $y=/\{\$([^}]+)}/g;function Sf(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function nt(r,e){if(r===e)return!0;let t=Object.keys(r),n=Object.keys(e);for(let i of t){if(!n.includes(i))return!1;let s=r[i],o=e[i];if(mf(s)&&mf(o)){if(!nt(s,o))return!1}else if(s!==o)return!1}for(let i of n)if(!t.includes(i))return!1;return!0}function mf(r){return r!==null&&typeof r=="object"}function Qn(r){let e=[];for(let[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Rf(r,e){let t=new lc(r,e);return t.subscribe.bind(t)}var lc=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Wy(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:n},i.next===void 0&&(i.next=cc),i.error===void 0&&(i.error=cc),i.complete===void 0&&(i.complete=cc);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function Wy(r,e){if(typeof r!="object"||r===null)return!1;for(let t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function cc(){}var $v=14400*1e3;function ue(r){return r&&r._delegate?r._delegate:r}var Ge=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var fn="[DEFAULT]";var yc=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let n=new Rs;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Hy(e))try{this.getOrInitializeService({instanceIdentifier:fn})}catch{}for(let[t,n]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:i});n.resolve(s)}catch{}}}}clearInstance(e=fn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return g(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=fn){return this.instances.has(e)}getOptions(e=fn){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[s,o]of this.instancesDeferred.entries()){let c=this.normalizeInstanceIdentifier(s);n===c&&o.resolve(i)}return i}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);let s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Ky(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=fn){return this.component?this.component.multipleInstances?e:fn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Ky(r){return r===fn?void 0:r}function Hy(r){return r.instantiationMode==="EAGER"}var ks=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new yc(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Qy=[],Q=(function(r){return r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT",r})(Q||{}),Jy={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},Yy=Q.INFO,Xy={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},Zy=(r,e,...t)=>{if(e<r.logLevel)return;let n=new Date().toISOString(),i=Xy[e];if(i)console[i](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ct=class{constructor(e){this.name=e,this._logLevel=Yy,this._logHandler=Zy,this._userLogHandler=null,Qy.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Jy[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...e),this._logHandler(this,Q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...e),this._logHandler(this,Q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...e),this._logHandler(this,Q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...e),this._logHandler(this,Q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...e),this._logHandler(this,Q.ERROR,...e)}};var eI=(r,e)=>e.some(t=>r instanceof t),Pf,Cf;function tI(){return Pf||(Pf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nI(){return Cf||(Cf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Df=new WeakMap,wc=new WeakMap,Nf=new WeakMap,Ic=new WeakMap,Tc=new WeakMap;function rI(r){let e=new Promise((t,n)=>{let i=()=>{r.removeEventListener("success",s),r.removeEventListener("error",o)},s=()=>{t(rt(r.result)),i()},o=()=>{n(r.error),i()};r.addEventListener("success",s),r.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&Df.set(t,r)}).catch(()=>{}),Tc.set(e,r),e}function iI(r){if(wc.has(r))return;let e=new Promise((t,n)=>{let i=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",o),r.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{n(r.error||new DOMException("AbortError","AbortError")),i()};r.addEventListener("complete",s),r.addEventListener("error",o),r.addEventListener("abort",o)});wc.set(r,e)}var Ec={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return wc.get(r);if(e==="objectStoreNames")return r.objectStoreNames||Nf.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return rt(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function kf(r){Ec=r(Ec)}function sI(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let n=r.call(Vs(this),e,...t);return Nf.set(n,e.sort?e.sort():[e]),rt(n)}:nI().includes(r)?function(...e){return r.apply(Vs(this),e),rt(Df.get(this))}:function(...e){return rt(r.apply(Vs(this),e))}}function oI(r){return typeof r=="function"?sI(r):(r instanceof IDBTransaction&&iI(r),eI(r,tI())?new Proxy(r,Ec):r)}function rt(r){if(r instanceof IDBRequest)return rI(r);if(Ic.has(r))return Ic.get(r);let e=oI(r);return e!==r&&(Ic.set(r,e),Tc.set(e,r)),e}var Vs=r=>Tc.get(r);function Of(r,e,{blocked:t,upgrade:n,blocking:i,terminated:s}={}){let o=indexedDB.open(r,e),c=rt(o);return n&&o.addEventListener("upgradeneeded",u=>{n(rt(o.result),u.oldVersion,u.newVersion,rt(o.transaction),u)}),t&&o.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{s&&u.addEventListener("close",()=>s()),i&&u.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}var aI=["get","getKey","getAll","getAllKeys","count"],cI=["put","add","delete","clear"],vc=new Map;function Vf(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(vc.get(e))return vc.get(e);let t=e.replace(/FromIndex$/,""),n=e!==t,i=cI.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(i||aI.includes(t)))return;let s=function(o,...c){return g(this,null,function*(){let u=this.transaction(o,i?"readwrite":"readonly"),h=u.store;return n&&(h=h.index(c.shift())),(yield Promise.all([h[t](...c),i&&u.done]))[0]})};return vc.set(e,s),s}kf(r=>Te(W({},r),{get:(e,t,n)=>Vf(e,t)||r.get(e,t,n),has:(e,t)=>!!Vf(e,t)||r.has(e,t)}));var bc=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(uI(t)){let n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}};function uI(r){return r.getComponent()?.type==="VERSION"}var Sc="@firebase/app",xf="0.14.6";var dt=new Ct("@firebase/app"),lI="@firebase/app-compat",hI="@firebase/analytics-compat",dI="@firebase/analytics",fI="@firebase/app-check-compat",pI="@firebase/app-check",mI="@firebase/auth",gI="@firebase/auth-compat",_I="@firebase/database",yI="@firebase/data-connect",II="@firebase/database-compat",wI="@firebase/functions",EI="@firebase/functions-compat",TI="@firebase/installations",vI="@firebase/installations-compat",AI="@firebase/messaging",bI="@firebase/messaging-compat",SI="@firebase/performance",RI="@firebase/performance-compat",PI="@firebase/remote-config",CI="@firebase/remote-config-compat",DI="@firebase/storage",NI="@firebase/storage-compat",kI="@firebase/firestore",VI="@firebase/ai",OI="@firebase/firestore-compat",xI="firebase",LI="12.6.0";var Rc="[DEFAULT]",MI={[Sc]:"fire-core",[lI]:"fire-core-compat",[dI]:"fire-analytics",[hI]:"fire-analytics-compat",[pI]:"fire-app-check",[fI]:"fire-app-check-compat",[mI]:"fire-auth",[gI]:"fire-auth-compat",[_I]:"fire-rtdb",[yI]:"fire-data-connect",[II]:"fire-rtdb-compat",[wI]:"fire-fn",[EI]:"fire-fn-compat",[TI]:"fire-iid",[vI]:"fire-iid-compat",[AI]:"fire-fcm",[bI]:"fire-fcm-compat",[SI]:"fire-perf",[RI]:"fire-perf-compat",[PI]:"fire-rc",[CI]:"fire-rc-compat",[DI]:"fire-gcs",[NI]:"fire-gcs-compat",[kI]:"fire-fst",[OI]:"fire-fst-compat",[VI]:"fire-vertex","fire-js":"fire-js",[xI]:"fire-js-all"};var Os=new Map,FI=new Map,Pc=new Map;function Lf(r,e){try{r.container.addComponent(e)}catch(t){dt.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Nt(r){let e=r.name;if(Pc.has(e))return dt.debug(`There were multiple attempts to register component ${e}.`),!1;Pc.set(e,r);for(let t of Os.values())Lf(t,r);for(let t of FI.values())Lf(t,r);return!0}function oi(r,e){let t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function Me(r){return r==null?!1:r.settings!==void 0}var UI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Dt=new ht("app","Firebase",UI);var Cc=class{constructor(e,t,n){this._isDeleted=!1,this._options=W({},e),this._config=W({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ge("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Dt.create("app-deleted",{appName:this._name})}};var kt=LI;function kc(r,e={}){let t=r;typeof e!="object"&&(e={name:e});let n=W({name:Rc,automaticDataCollectionEnabled:!0},e),i=n.name;if(typeof i!="string"||!i)throw Dt.create("bad-app-name",{appName:String(i)});if(t||(t=fc()),!t)throw Dt.create("no-options");let s=Os.get(i);if(s){if(nt(t,s.options)&&nt(n,s.config))return s;throw Dt.create("duplicate-app",{appName:i})}let o=new ks(i);for(let u of Pc.values())o.addComponent(u);let c=new Cc(t,n,o);return Os.set(i,c),c}function Vc(r=Rc){let e=Os.get(r);if(!e&&r===Rc&&fc())return kc();if(!e)throw Dt.create("no-app",{appName:r});return e}function Ke(r,e,t){let n=MI[r]??r;t&&(n+=`-${t}`);let i=n.match(/\s|\//),s=e.match(/\s|\//);if(i||s){let o=[`Unable to register library "${n}" with version "${e}":`];i&&o.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),dt.warn(o.join(" "));return}Nt(new Ge(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}var BI="firebase-heartbeat-database",qI=1,si="firebase-heartbeat-store",Ac=null;function Bf(){return Ac||(Ac=Of(BI,qI,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(si)}catch(t){console.warn(t)}}}}).catch(r=>{throw Dt.create("idb-open",{originalErrorMessage:r.message})})),Ac}function zI(r){return g(this,null,function*(){try{let t=(yield Bf()).transaction(si),n=yield t.objectStore(si).get(qf(r));return yield t.done,n}catch(e){if(e instanceof Le)dt.warn(e.message);else{let t=Dt.create("idb-get",{originalErrorMessage:e?.message});dt.warn(t.message)}}})}function Mf(r,e){return g(this,null,function*(){try{let n=(yield Bf()).transaction(si,"readwrite");yield n.objectStore(si).put(e,qf(r)),yield n.done}catch(t){if(t instanceof Le)dt.warn(t.message);else{let n=Dt.create("idb-set",{originalErrorMessage:t?.message});dt.warn(n.message)}}})}function qf(r){return`${r.name}!${r.options.appId}`}var jI=1024,GI=30,Dc=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Nc(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}triggerHeartbeat(){return g(this,null,function*(){try{let t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Ff();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(i=>i.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>GI){let i=WI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){dt.warn(e)}})}getHeartbeatsHeader(){return g(this,null,function*(){try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=Ff(),{heartbeatsToSend:t,unsentEntries:n}=$I(this._heartbeatsCache.heartbeats),i=hc(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return dt.warn(e),""}})}};function Ff(){return new Date().toISOString().substring(0,10)}function $I(r,e=jI){let t=[],n=r.slice();for(let i of r){let s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Uf(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Uf(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}var Nc=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return g(this,null,function*(){return Ns()?bf().then(()=>!0).catch(()=>!1):!1})}read(){return g(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield zI(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return g(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield this.read();return Mf(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return g(this,null,function*(){if(yield this._canUseIndexedDBPromise){let n=yield this.read();return Mf(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return})}};function Uf(r){return hc(JSON.stringify({version:2,heartbeats:r})).length}function WI(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}function KI(r){Nt(new Ge("platform-logger",e=>new bc(e),"PRIVATE")),Nt(new Ge("heartbeat",e=>new Dc(e),"PRIVATE")),Ke(Sc,xf,r),Ke(Sc,xf,"esm2020"),Ke("fire-js","")}KI("");var zf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jf={};var ft,Oc;(function(){var r;function e(E,_){function w(){}w.prototype=_.prototype,E.F=_.prototype,E.prototype=new w,E.prototype.constructor=E,E.D=function(v,T,b){for(var I=Array(arguments.length-2),Ve=2;Ve<arguments.length;Ve++)I[Ve-2]=arguments[Ve];return _.prototype[T].apply(v,I)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,w){w||(w=0);let v=Array(16);if(typeof _=="string")for(var T=0;T<16;++T)v[T]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(T=0;T<16;++T)v[T]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=E.g[0],w=E.g[1],T=E.g[2];let b=E.g[3],I;I=_+(b^w&(T^b))+v[0]+3614090360&4294967295,_=w+(I<<7&4294967295|I>>>25),I=b+(T^_&(w^T))+v[1]+3905402710&4294967295,b=_+(I<<12&4294967295|I>>>20),I=T+(w^b&(_^w))+v[2]+606105819&4294967295,T=b+(I<<17&4294967295|I>>>15),I=w+(_^T&(b^_))+v[3]+3250441966&4294967295,w=T+(I<<22&4294967295|I>>>10),I=_+(b^w&(T^b))+v[4]+4118548399&4294967295,_=w+(I<<7&4294967295|I>>>25),I=b+(T^_&(w^T))+v[5]+1200080426&4294967295,b=_+(I<<12&4294967295|I>>>20),I=T+(w^b&(_^w))+v[6]+2821735955&4294967295,T=b+(I<<17&4294967295|I>>>15),I=w+(_^T&(b^_))+v[7]+4249261313&4294967295,w=T+(I<<22&4294967295|I>>>10),I=_+(b^w&(T^b))+v[8]+1770035416&4294967295,_=w+(I<<7&4294967295|I>>>25),I=b+(T^_&(w^T))+v[9]+2336552879&4294967295,b=_+(I<<12&4294967295|I>>>20),I=T+(w^b&(_^w))+v[10]+4294925233&4294967295,T=b+(I<<17&4294967295|I>>>15),I=w+(_^T&(b^_))+v[11]+2304563134&4294967295,w=T+(I<<22&4294967295|I>>>10),I=_+(b^w&(T^b))+v[12]+1804603682&4294967295,_=w+(I<<7&4294967295|I>>>25),I=b+(T^_&(w^T))+v[13]+4254626195&4294967295,b=_+(I<<12&4294967295|I>>>20),I=T+(w^b&(_^w))+v[14]+2792965006&4294967295,T=b+(I<<17&4294967295|I>>>15),I=w+(_^T&(b^_))+v[15]+1236535329&4294967295,w=T+(I<<22&4294967295|I>>>10),I=_+(T^b&(w^T))+v[1]+4129170786&4294967295,_=w+(I<<5&4294967295|I>>>27),I=b+(w^T&(_^w))+v[6]+3225465664&4294967295,b=_+(I<<9&4294967295|I>>>23),I=T+(_^w&(b^_))+v[11]+643717713&4294967295,T=b+(I<<14&4294967295|I>>>18),I=w+(b^_&(T^b))+v[0]+3921069994&4294967295,w=T+(I<<20&4294967295|I>>>12),I=_+(T^b&(w^T))+v[5]+3593408605&4294967295,_=w+(I<<5&4294967295|I>>>27),I=b+(w^T&(_^w))+v[10]+38016083&4294967295,b=_+(I<<9&4294967295|I>>>23),I=T+(_^w&(b^_))+v[15]+3634488961&4294967295,T=b+(I<<14&4294967295|I>>>18),I=w+(b^_&(T^b))+v[4]+3889429448&4294967295,w=T+(I<<20&4294967295|I>>>12),I=_+(T^b&(w^T))+v[9]+568446438&4294967295,_=w+(I<<5&4294967295|I>>>27),I=b+(w^T&(_^w))+v[14]+3275163606&4294967295,b=_+(I<<9&4294967295|I>>>23),I=T+(_^w&(b^_))+v[3]+4107603335&4294967295,T=b+(I<<14&4294967295|I>>>18),I=w+(b^_&(T^b))+v[8]+1163531501&4294967295,w=T+(I<<20&4294967295|I>>>12),I=_+(T^b&(w^T))+v[13]+2850285829&4294967295,_=w+(I<<5&4294967295|I>>>27),I=b+(w^T&(_^w))+v[2]+4243563512&4294967295,b=_+(I<<9&4294967295|I>>>23),I=T+(_^w&(b^_))+v[7]+1735328473&4294967295,T=b+(I<<14&4294967295|I>>>18),I=w+(b^_&(T^b))+v[12]+2368359562&4294967295,w=T+(I<<20&4294967295|I>>>12),I=_+(w^T^b)+v[5]+4294588738&4294967295,_=w+(I<<4&4294967295|I>>>28),I=b+(_^w^T)+v[8]+2272392833&4294967295,b=_+(I<<11&4294967295|I>>>21),I=T+(b^_^w)+v[11]+1839030562&4294967295,T=b+(I<<16&4294967295|I>>>16),I=w+(T^b^_)+v[14]+4259657740&4294967295,w=T+(I<<23&4294967295|I>>>9),I=_+(w^T^b)+v[1]+2763975236&4294967295,_=w+(I<<4&4294967295|I>>>28),I=b+(_^w^T)+v[4]+1272893353&4294967295,b=_+(I<<11&4294967295|I>>>21),I=T+(b^_^w)+v[7]+4139469664&4294967295,T=b+(I<<16&4294967295|I>>>16),I=w+(T^b^_)+v[10]+3200236656&4294967295,w=T+(I<<23&4294967295|I>>>9),I=_+(w^T^b)+v[13]+681279174&4294967295,_=w+(I<<4&4294967295|I>>>28),I=b+(_^w^T)+v[0]+3936430074&4294967295,b=_+(I<<11&4294967295|I>>>21),I=T+(b^_^w)+v[3]+3572445317&4294967295,T=b+(I<<16&4294967295|I>>>16),I=w+(T^b^_)+v[6]+76029189&4294967295,w=T+(I<<23&4294967295|I>>>9),I=_+(w^T^b)+v[9]+3654602809&4294967295,_=w+(I<<4&4294967295|I>>>28),I=b+(_^w^T)+v[12]+3873151461&4294967295,b=_+(I<<11&4294967295|I>>>21),I=T+(b^_^w)+v[15]+530742520&4294967295,T=b+(I<<16&4294967295|I>>>16),I=w+(T^b^_)+v[2]+3299628645&4294967295,w=T+(I<<23&4294967295|I>>>9),I=_+(T^(w|~b))+v[0]+4096336452&4294967295,_=w+(I<<6&4294967295|I>>>26),I=b+(w^(_|~T))+v[7]+1126891415&4294967295,b=_+(I<<10&4294967295|I>>>22),I=T+(_^(b|~w))+v[14]+2878612391&4294967295,T=b+(I<<15&4294967295|I>>>17),I=w+(b^(T|~_))+v[5]+4237533241&4294967295,w=T+(I<<21&4294967295|I>>>11),I=_+(T^(w|~b))+v[12]+1700485571&4294967295,_=w+(I<<6&4294967295|I>>>26),I=b+(w^(_|~T))+v[3]+2399980690&4294967295,b=_+(I<<10&4294967295|I>>>22),I=T+(_^(b|~w))+v[10]+4293915773&4294967295,T=b+(I<<15&4294967295|I>>>17),I=w+(b^(T|~_))+v[1]+2240044497&4294967295,w=T+(I<<21&4294967295|I>>>11),I=_+(T^(w|~b))+v[8]+1873313359&4294967295,_=w+(I<<6&4294967295|I>>>26),I=b+(w^(_|~T))+v[15]+4264355552&4294967295,b=_+(I<<10&4294967295|I>>>22),I=T+(_^(b|~w))+v[6]+2734768916&4294967295,T=b+(I<<15&4294967295|I>>>17),I=w+(b^(T|~_))+v[13]+1309151649&4294967295,w=T+(I<<21&4294967295|I>>>11),I=_+(T^(w|~b))+v[4]+4149444226&4294967295,_=w+(I<<6&4294967295|I>>>26),I=b+(w^(_|~T))+v[11]+3174756917&4294967295,b=_+(I<<10&4294967295|I>>>22),I=T+(_^(b|~w))+v[2]+718787259&4294967295,T=b+(I<<15&4294967295|I>>>17),I=w+(b^(T|~_))+v[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(T+(I<<21&4294967295|I>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+b&4294967295}n.prototype.v=function(E,_){_===void 0&&(_=E.length);let w=_-this.blockSize,v=this.C,T=this.h,b=0;for(;b<_;){if(T==0)for(;b<=w;)i(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<_;)if(v[T++]=E.charCodeAt(b++),T==this.blockSize){i(this,v),T=0;break}}else for(;b<_;)if(v[T++]=E[b++],T==this.blockSize){i(this,v),T=0;break}}this.h=T,this.o+=_},n.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;_=this.o*8;for(var w=E.length-8;w<E.length;++w)E[w]=_&255,_/=256;for(this.v(E),E=Array(16),_=0,w=0;w<4;++w)for(let v=0;v<32;v+=8)E[_++]=this.g[w]>>>v&255;return E};function s(E,_){var w=c;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=_(E)}function o(E,_){this.h=_;let w=[],v=!0;for(let T=E.length-1;T>=0;T--){let b=E[T]|0;v&&b==_||(w[T]=b,v=!1)}this.g=w}var c={};function u(E){return-128<=E&&E<128?s(E,function(_){return new o([_|0],_<0?-1:0)}):new o([E|0],E<0?-1:0)}function h(E){if(isNaN(E)||!isFinite(E))return m;if(E<0)return N(h(-E));let _=[],w=1;for(let v=0;E>=w;v++)_[v]=E/w|0,w*=4294967296;return new o(_,0)}function f(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return N(f(E.substring(1),_));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');let w=h(Math.pow(_,8)),v=m;for(let b=0;b<E.length;b+=8){var T=Math.min(8,E.length-b);let I=parseInt(E.substring(b,b+T),_);T<8?(T=h(Math.pow(_,T)),v=v.j(T).add(h(I))):(v=v.j(w),v=v.add(h(I)))}return v}var m=u(0),y=u(1),P=u(16777216);r=o.prototype,r.m=function(){if(O(this))return-N(this).m();let E=0,_=1;for(let w=0;w<this.g.length;w++){let v=this.i(w);E+=(v>=0?v:4294967296+v)*_,_*=4294967296}return E},r.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(k(this))return"0";if(O(this))return"-"+N(this).toString(E);let _=h(Math.pow(E,6));var w=this;let v="";for(;;){let T=ne(w,_).g;w=$(w,T.j(_));let b=((w.g.length>0?w.g[0]:w.h)>>>0).toString(E);if(w=T,k(w))return b+v;for(;b.length<6;)b="0"+b;v=b+v}},r.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function k(E){if(E.h!=0)return!1;for(let _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function O(E){return E.h==-1}r.l=function(E){return E=$(this,E),O(E)?-1:k(E)?0:1};function N(E){let _=E.g.length,w=[];for(let v=0;v<_;v++)w[v]=~E.g[v];return new o(w,~E.h).add(y)}r.abs=function(){return O(this)?N(this):this},r.add=function(E){let _=Math.max(this.g.length,E.g.length),w=[],v=0;for(let T=0;T<=_;T++){let b=v+(this.i(T)&65535)+(E.i(T)&65535),I=(b>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);v=I>>>16,b&=65535,I&=65535,w[T]=I<<16|b}return new o(w,w[w.length-1]&-2147483648?-1:0)};function $(E,_){return E.add(N(_))}r.j=function(E){if(k(this)||k(E))return m;if(O(this))return O(E)?N(this).j(N(E)):N(N(this).j(E));if(O(E))return N(this.j(N(E)));if(this.l(P)<0&&E.l(P)<0)return h(this.m()*E.m());let _=this.g.length+E.g.length,w=[];for(var v=0;v<2*_;v++)w[v]=0;for(v=0;v<this.g.length;v++)for(let T=0;T<E.g.length;T++){let b=this.i(v)>>>16,I=this.i(v)&65535,Ve=E.i(T)>>>16,Et=E.i(T)&65535;w[2*v+2*T]+=I*Et,z(w,2*v+2*T),w[2*v+2*T+1]+=b*Et,z(w,2*v+2*T+1),w[2*v+2*T+1]+=I*Ve,z(w,2*v+2*T+1),w[2*v+2*T+2]+=b*Ve,z(w,2*v+2*T+2)}for(E=0;E<_;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=_;E<2*_;E++)w[E]=0;return new o(w,0)};function z(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function B(E,_){this.g=E,this.h=_}function ne(E,_){if(k(_))throw Error("division by zero");if(k(E))return new B(m,m);if(O(E))return _=ne(N(E),_),new B(N(_.g),N(_.h));if(O(_))return _=ne(E,N(_)),new B(N(_.g),_.h);if(E.g.length>30){if(O(E)||O(_))throw Error("slowDivide_ only works with positive integers.");for(var w=y,v=_;v.l(E)<=0;)w=Z(w),v=Z(v);var T=Y(w,1),b=Y(v,1);for(v=Y(v,2),w=Y(w,2);!k(v);){var I=b.add(v);I.l(E)<=0&&(T=T.add(w),b=I),v=Y(v,1),w=Y(w,1)}return _=$(E,T.j(_)),new B(T,_)}for(T=m;E.l(_)>=0;){for(w=Math.max(1,Math.floor(E.m()/_.m())),v=Math.ceil(Math.log(w)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),b=h(w),I=b.j(_);O(I)||I.l(E)>0;)w-=v,b=h(w),I=b.j(_);k(b)&&(b=y),T=T.add(b),E=$(E,I)}return new B(T,E)}r.B=function(E){return ne(this,E).h},r.and=function(E){let _=Math.max(this.g.length,E.g.length),w=[];for(let v=0;v<_;v++)w[v]=this.i(v)&E.i(v);return new o(w,this.h&E.h)},r.or=function(E){let _=Math.max(this.g.length,E.g.length),w=[];for(let v=0;v<_;v++)w[v]=this.i(v)|E.i(v);return new o(w,this.h|E.h)},r.xor=function(E){let _=Math.max(this.g.length,E.g.length),w=[];for(let v=0;v<_;v++)w[v]=this.i(v)^E.i(v);return new o(w,this.h^E.h)};function Z(E){let _=E.g.length+1,w=[];for(let v=0;v<_;v++)w[v]=E.i(v)<<1|E.i(v-1)>>>31;return new o(w,E.h)}function Y(E,_){let w=_>>5;_%=32;let v=E.g.length-w,T=[];for(let b=0;b<v;b++)T[b]=_>0?E.i(b+w)>>>_|E.i(b+w+1)<<32-_:E.i(b+w);return new o(T,E.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Oc=jf.Md5=n,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,ft=jf.Integer=o}).apply(typeof zf<"u"?zf:typeof self<"u"?self:typeof window<"u"?window:{});var xs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pt={};var xc,HI,Jn,Lc,ai,Ls,Mc,Fc,Uc;(function(){var r,e=Object.defineProperty;function t(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof xs=="object"&&xs];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function i(a,l){if(l)e:{var d=n;a=a.split(".");for(var p=0;p<a.length-1;p++){var A=a[p];if(!(A in d))break e;d=d[A]}a=a[a.length-1],p=d[a],l=l(p),l!=p&&l!=null&&e(d,a,{configurable:!0,writable:!0,value:l})}}i("Symbol.dispose",function(a){return a||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(a){return a||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(a){return a||function(l){var d=[],p;for(p in l)Object.prototype.hasOwnProperty.call(l,p)&&d.push([p,l[p]]);return d}});var s=s||{},o=this||self;function c(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function u(a,l,d){return a.call.apply(a.bind,arguments)}function h(a,l,d){return h=u,h.apply(null,arguments)}function f(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),a.apply(this,p)}}function m(a,l){function d(){}d.prototype=l.prototype,a.Z=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Ob=function(p,A,R){for(var x=Array(arguments.length-2),K=2;K<arguments.length;K++)x[K-2]=arguments[K];return l.prototype[A].apply(p,x)}}var y=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function P(a){let l=a.length;if(l>0){let d=Array(l);for(let p=0;p<l;p++)d[p]=a[p];return d}return[]}function k(a,l){for(let p=1;p<arguments.length;p++){let A=arguments[p];var d=typeof A;if(d=d!="object"?d:A?Array.isArray(A)?"array":d:"null",d=="array"||d=="object"&&typeof A.length=="number"){d=a.length||0;let R=A.length||0;a.length=d+R;for(let x=0;x<R;x++)a[d+x]=A[x]}else a.push(A)}}class O{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function N(a){o.setTimeout(()=>{throw a},0)}function $(){var a=E;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class z{constructor(){this.h=this.g=null}add(l,d){let p=B.get();p.set(l,d),this.h?this.h.next=p:this.g=p,this.h=p}}var B=new O(()=>new ne,a=>a.reset());class ne{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Z,Y=!1,E=new z,_=()=>{let a=Promise.resolve(void 0);Z=()=>{a.then(w)}};function w(){for(var a;a=$();){try{a.h.call(a.g)}catch(d){N(d)}var l=B;l.j(a),l.h<100&&(l.h++,a.next=l.g,l.g=a)}Y=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};o.addEventListener("test",d,l),o.removeEventListener("test",d,l)}catch{}return a})();function I(a){return/^[\s\xa0]*$/.test(a)}function Ve(a,l){T.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,l)}m(Ve,T),Ve.prototype.init=function(a,l){let d=this.type=a.type,p=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget,l||(d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement)),this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&Ve.Z.h.call(this)},Ve.prototype.h=function(){Ve.Z.h.call(this);let a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var Et="closure_listenable_"+(Math.random()*1e6|0),sy=0;function oy(a,l,d,p,A){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!p,this.ha=A,this.key=++sy,this.da=this.fa=!1}function ls(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function hs(a,l,d){for(let p in a)l.call(d,a[p],p,a)}function ay(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function cd(a){let l={};for(let d in a)l[d]=a[d];return l}let ud="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ld(a,l){let d,p;for(let A=1;A<arguments.length;A++){p=arguments[A];for(d in p)a[d]=p[d];for(let R=0;R<ud.length;R++)d=ud[R],Object.prototype.hasOwnProperty.call(p,d)&&(a[d]=p[d])}}function ds(a){this.src=a,this.g={},this.h=0}ds.prototype.add=function(a,l,d,p,A){let R=a.toString();a=this.g[R],a||(a=this.g[R]=[],this.h++);let x=Fa(a,l,p,A);return x>-1?(l=a[x],d||(l.fa=!1)):(l=new oy(l,this.src,R,!!p,A),l.fa=d,a.push(l)),l};function Ma(a,l){let d=l.type;if(d in a.g){var p=a.g[d],A=Array.prototype.indexOf.call(p,l,void 0),R;(R=A>=0)&&Array.prototype.splice.call(p,A,1),R&&(ls(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function Fa(a,l,d,p){for(let A=0;A<a.length;++A){let R=a[A];if(!R.da&&R.listener==l&&R.capture==!!d&&R.ha==p)return A}return-1}var Ua="closure_lm_"+(Math.random()*1e6|0),Ba={};function hd(a,l,d,p,A){if(p&&p.once)return fd(a,l,d,p,A);if(Array.isArray(l)){for(let R=0;R<l.length;R++)hd(a,l[R],d,p,A);return null}return d=Ga(d),a&&a[Et]?a.J(l,d,c(p)?!!p.capture:!!p,A):dd(a,l,d,!1,p,A)}function dd(a,l,d,p,A,R){if(!l)throw Error("Invalid event type");let x=c(A)?!!A.capture:!!A,K=za(a);if(K||(a[Ua]=K=new ds(a)),d=K.add(l,d,p,x,R),d.proxy)return d;if(p=cy(),d.proxy=p,p.src=a,p.listener=d,a.addEventListener)b||(A=x),A===void 0&&(A=!1),a.addEventListener(l.toString(),p,A);else if(a.attachEvent)a.attachEvent(md(l.toString()),p);else if(a.addListener&&a.removeListener)a.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function cy(){function a(d){return l.call(a.src,a.listener,d)}let l=uy;return a}function fd(a,l,d,p,A){if(Array.isArray(l)){for(let R=0;R<l.length;R++)fd(a,l[R],d,p,A);return null}return d=Ga(d),a&&a[Et]?a.K(l,d,c(p)?!!p.capture:!!p,A):dd(a,l,d,!0,p,A)}function pd(a,l,d,p,A){if(Array.isArray(l))for(var R=0;R<l.length;R++)pd(a,l[R],d,p,A);else p=c(p)?!!p.capture:!!p,d=Ga(d),a&&a[Et]?(a=a.i,R=String(l).toString(),R in a.g&&(l=a.g[R],d=Fa(l,d,p,A),d>-1&&(ls(l[d]),Array.prototype.splice.call(l,d,1),l.length==0&&(delete a.g[R],a.h--)))):a&&(a=za(a))&&(l=a.g[l.toString()],a=-1,l&&(a=Fa(l,d,p,A)),(d=a>-1?l[a]:null)&&qa(d))}function qa(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[Et])Ma(l.i,a);else{var d=a.type,p=a.proxy;l.removeEventListener?l.removeEventListener(d,p,a.capture):l.detachEvent?l.detachEvent(md(d),p):l.addListener&&l.removeListener&&l.removeListener(p),(d=za(l))?(Ma(d,a),d.h==0&&(d.src=null,l[Ua]=null)):ls(a)}}}function md(a){return a in Ba?Ba[a]:Ba[a]="on"+a}function uy(a,l){if(a.da)a=!0;else{l=new Ve(l,this);let d=a.listener,p=a.ha||a.src;a.fa&&qa(a),a=d.call(p,l)}return a}function za(a){return a=a[Ua],a instanceof ds?a:null}var ja="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ga(a){return typeof a=="function"?a:(a[ja]||(a[ja]=function(l){return a.handleEvent(l)}),a[ja])}function be(){v.call(this),this.i=new ds(this),this.M=this,this.G=null}m(be,v),be.prototype[Et]=!0,be.prototype.removeEventListener=function(a,l,d,p){pd(this,a,l,d,p)};function Ce(a,l){var d,p=a.G;if(p)for(d=[];p;p=p.G)d.push(p);if(a=a.M,p=l.type||l,typeof l=="string")l=new T(l,a);else if(l instanceof T)l.target=l.target||a;else{var A=l;l=new T(p,a),ld(l,A)}A=!0;let R,x;if(d)for(x=d.length-1;x>=0;x--)R=l.g=d[x],A=fs(R,p,!0,l)&&A;if(R=l.g=a,A=fs(R,p,!0,l)&&A,A=fs(R,p,!1,l)&&A,d)for(x=0;x<d.length;x++)R=l.g=d[x],A=fs(R,p,!1,l)&&A}be.prototype.N=function(){if(be.Z.N.call(this),this.i){var a=this.i;for(let l in a.g){let d=a.g[l];for(let p=0;p<d.length;p++)ls(d[p]);delete a.g[l],a.h--}}this.G=null},be.prototype.J=function(a,l,d,p){return this.i.add(String(a),l,!1,d,p)},be.prototype.K=function(a,l,d,p){return this.i.add(String(a),l,!0,d,p)};function fs(a,l,d,p){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();let A=!0;for(let R=0;R<l.length;++R){let x=l[R];if(x&&!x.da&&x.capture==d){let K=x.listener,_e=x.ha||x.src;x.fa&&Ma(a.i,x),A=K.call(_e,p)!==!1&&A}}return A&&!p.defaultPrevented}function ly(a,l){if(typeof a!="function")if(a&&typeof a.handleEvent=="function")a=h(a.handleEvent,a);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:o.setTimeout(a,l||0)}function gd(a){a.g=ly(()=>{a.g=null,a.i&&(a.i=!1,gd(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class hy extends v{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:gd(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zr(a){v.call(this),this.h=a,this.g={}}m(zr,v);var _d=[];function yd(a){hs(a.g,function(l,d){this.g.hasOwnProperty(d)&&qa(l)},a),a.g={}}zr.prototype.N=function(){zr.Z.N.call(this),yd(this)},zr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var $a=o.JSON.stringify,dy=o.JSON.parse,fy=class{stringify(a){return o.JSON.stringify(a,void 0)}parse(a){return o.JSON.parse(a,void 0)}};function Id(){}function wd(){}var jr={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Wa(){T.call(this,"d")}m(Wa,T);function Ka(){T.call(this,"c")}m(Ka,T);var an={},Ed=null;function ps(){return Ed=Ed||new be}an.Ia="serverreachability";function Td(a){T.call(this,an.Ia,a)}m(Td,T);function Gr(a){let l=ps();Ce(l,new Td(l))}an.STAT_EVENT="statevent";function vd(a,l){T.call(this,an.STAT_EVENT,a),this.stat=l}m(vd,T);function De(a){let l=ps();Ce(l,new vd(l,a))}an.Ja="timingevent";function Ad(a,l){T.call(this,an.Ja,a),this.size=l}m(Ad,T);function $r(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){a()},l)}function Wr(){this.g=!0}Wr.prototype.ua=function(){this.g=!1};function py(a,l,d,p,A,R){a.info(function(){if(a.g)if(R){var x="",K=R.split("&");for(let ie=0;ie<K.length;ie++){var _e=K[ie].split("=");if(_e.length>1){let Ee=_e[0];_e=_e[1];let et=Ee.split("_");x=et.length>=2&&et[1]=="type"?x+(Ee+"="+_e+"&"):x+(Ee+"=redacted&")}}}else x=null;else x=R;return"XMLHTTP REQ ("+p+") [attempt "+A+"]: "+l+`
`+d+`
`+x})}function my(a,l,d,p,A,R,x){a.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+A+"]: "+l+`
`+d+`
`+R+" "+x})}function Gn(a,l,d,p){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+_y(a,d)+(p?" "+p:"")})}function gy(a,l){a.info(function(){return"TIMEOUT: "+l})}Wr.prototype.info=function(){};function _y(a,l){if(!a.g)return l;if(!l)return null;try{let R=JSON.parse(l);if(R){for(a=0;a<R.length;a++)if(Array.isArray(R[a])){var d=R[a];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var A=p[0];if(A!="noop"&&A!="stop"&&A!="close")for(let x=1;x<p.length;x++)p[x]=""}}}}return $a(R)}catch{return l}}var ms={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},bd={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Sd;function Ha(){}m(Ha,Id),Ha.prototype.g=function(){return new XMLHttpRequest},Sd=new Ha;function Kr(a){return encodeURIComponent(String(a))}function yy(a){var l=1;a=a.split(":");let d=[];for(;l>0&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function Tt(a,l,d,p){this.j=a,this.i=l,this.l=d,this.S=p||1,this.V=new zr(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Rd}function Rd(){this.i=null,this.g="",this.h=!1}var Pd={},Qa={};function Ja(a,l,d){a.M=1,a.A=_s(Ze(l)),a.u=d,a.R=!0,Cd(a,null)}function Cd(a,l){a.F=Date.now(),gs(a),a.B=Ze(a.A);var d=a.B,p=a.S;Array.isArray(p)||(p=[String(p)]),zd(d.i,"t",p),a.C=0,d=a.j.L,a.h=new Rd,a.g=af(a.j,d?l:null,!a.u),a.P>0&&(a.O=new hy(h(a.Y,a,a.g),a.P)),l=a.V,d=a.g,p=a.ba;var A="readystatechange";Array.isArray(A)||(A&&(_d[0]=A.toString()),A=_d);for(let R=0;R<A.length;R++){let x=hd(d,A[R],p||l.handleEvent,!1,l.h||l);if(!x)break;l.g[x.key]=x}l=a.J?cd(a.J):{},a.u?(a.v||(a.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,l)):(a.v="GET",a.g.ea(a.B,a.v,null,l)),Gr(),py(a.i,a.v,a.B,a.l,a.S,a.u)}Tt.prototype.ba=function(a){a=a.target;let l=this.O;l&&bt(a)==3?l.j():this.Y(a)},Tt.prototype.Y=function(a){try{if(a==this.g)e:{let K=bt(this.g),_e=this.g.ya(),ie=this.g.ca();if(!(K<3)&&(K!=3||this.g&&(this.h.h||this.g.la()||Qd(this.g)))){this.K||K!=4||_e==7||(_e==8||ie<=0?Gr(3):Gr(2)),Ya(this);var l=this.g.ca();this.X=l;var d=Iy(this);if(this.o=l==200,my(this.i,this.v,this.B,this.l,this.S,K,l),this.o){if(this.U&&!this.L){t:{if(this.g){var p,A=this.g;if((p=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(p)){var R=p;break t}}R=null}if(a=R)Gn(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Xa(this,a);else{this.o=!1,this.m=3,De(12),cn(this),Hr(this);break e}}if(this.R){a=!0;let Ee;for(;!this.K&&this.C<d.length;)if(Ee=wy(this,d),Ee==Qa){K==4&&(this.m=4,De(14),a=!1),Gn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ee==Pd){this.m=4,De(15),Gn(this.i,this.l,d,"[Invalid Chunk]"),a=!1;break}else Gn(this.i,this.l,Ee,null),Xa(this,Ee);if(Dd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),K!=4||d.length!=0||this.h.h||(this.m=1,De(16),a=!1),this.o=this.o&&a,!a)Gn(this.i,this.l,d,"[Invalid Chunked Response]"),cn(this),Hr(this);else if(d.length>0&&!this.W){this.W=!0;var x=this.j;x.g==this&&x.aa&&!x.P&&(x.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),sc(x),x.P=!0,De(11))}}else Gn(this.i,this.l,d,null),Xa(this,d);K==4&&cn(this),this.o&&!this.K&&(K==4?nf(this.j,this):(this.o=!1,gs(this)))}else Oy(this.g),l==400&&d.indexOf("Unknown SID")>0?(this.m=3,De(12)):(this.m=0,De(13)),cn(this),Hr(this)}}}catch{}finally{}};function Iy(a){if(!Dd(a))return a.g.la();let l=Qd(a.g);if(l==="")return"";let d="",p=l.length,A=bt(a.g)==4;if(!a.h.i){if(typeof TextDecoder>"u")return cn(a),Hr(a),"";a.h.i=new o.TextDecoder}for(let R=0;R<p;R++)a.h.h=!0,d+=a.h.i.decode(l[R],{stream:!(A&&R==p-1)});return l.length=0,a.h.g+=d,a.C=0,a.h.g}function Dd(a){return a.g?a.v=="GET"&&a.M!=2&&a.j.Aa:!1}function wy(a,l){var d=a.C,p=l.indexOf(`
`,d);return p==-1?Qa:(d=Number(l.substring(d,p)),isNaN(d)?Pd:(p+=1,p+d>l.length?Qa:(l=l.slice(p,p+d),a.C=p+d,l)))}Tt.prototype.cancel=function(){this.K=!0,cn(this)};function gs(a){a.T=Date.now()+a.H,Nd(a,a.H)}function Nd(a,l){if(a.D!=null)throw Error("WatchDog timer not null");a.D=$r(h(a.aa,a),l)}function Ya(a){a.D&&(o.clearTimeout(a.D),a.D=null)}Tt.prototype.aa=function(){this.D=null;let a=Date.now();a-this.T>=0?(gy(this.i,this.B),this.M!=2&&(Gr(),De(17)),cn(this),this.m=2,Hr(this)):Nd(this,this.T-a)};function Hr(a){a.j.I==0||a.K||nf(a.j,a)}function cn(a){Ya(a);var l=a.O;l&&typeof l.dispose=="function"&&l.dispose(),a.O=null,yd(a.V),a.g&&(l=a.g,a.g=null,l.abort(),l.dispose())}function Xa(a,l){try{var d=a.j;if(d.I!=0&&(d.g==a||Za(d.h,a))){if(!a.L&&Za(d.h,a)&&d.I==3){try{var p=d.Ba.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var A=p;if(A[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<a.F)vs(d),Es(d);else break e;ic(d),De(18)}}else d.xa=A[1],0<d.xa-d.K&&A[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=$r(h(d.Va,d),6e3));Od(d.h)<=1&&d.ta&&(d.ta=void 0)}else ln(d,11)}else if((a.L||d.g==a)&&vs(d),!I(l))for(A=d.Ba.g.parse(l),l=0;l<A.length;l++){let ie=A[l],Ee=ie[0];if(!(Ee<=d.K))if(d.K=Ee,ie=ie[1],d.I==2)if(ie[0]=="c"){d.M=ie[1],d.ba=ie[2];let et=ie[3];et!=null&&(d.ka=et,d.j.info("VER="+d.ka));let hn=ie[4];hn!=null&&(d.za=hn,d.j.info("SVER="+d.za));let St=ie[5];St!=null&&typeof St=="number"&&St>0&&(p=1.5*St,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;let Rt=a.g;if(Rt){let bs=Rt.g?Rt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(bs){var R=p.h;R.g||bs.indexOf("spdy")==-1&&bs.indexOf("quic")==-1&&bs.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(ec(R,R.h),R.h=null))}if(p.G){let oc=Rt.g?Rt.g.getResponseHeader("X-HTTP-Session-Id"):null;oc&&(p.wa=oc,oe(p.J,p.G,oc))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-a.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var x=a;if(p.na=of(p,p.L?p.ba:null,p.W),x.L){xd(p.h,x);var K=x,_e=p.O;_e&&(K.H=_e),K.D&&(Ya(K),gs(K)),p.g=x}else ef(p);d.i.length>0&&Ts(d)}else ie[0]!="stop"&&ie[0]!="close"||ln(d,7);else d.I==3&&(ie[0]=="stop"||ie[0]=="close"?ie[0]=="stop"?ln(d,7):rc(d):ie[0]!="noop"&&d.l&&d.l.qa(ie),d.A=0)}}Gr(4)}catch{}}var Ey=class{constructor(a,l){this.g=a,this.map=l}};function kd(a){this.l=a||10,o.PerformanceNavigationTiming?(a=o.performance.getEntriesByType("navigation"),a=a.length>0&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Vd(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Od(a){return a.h?1:a.g?a.g.size:0}function Za(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function ec(a,l){a.g?a.g.add(l):a.h=l}function xd(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}kd.prototype.cancel=function(){if(this.i=Ld(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Ld(a){if(a.h!=null)return a.i.concat(a.h.G);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.G);return l}return P(a.i)}var Md=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ty(a,l){if(a){a=a.split("&");for(let d=0;d<a.length;d++){let p=a[d].indexOf("="),A,R=null;p>=0?(A=a[d].substring(0,p),R=a[d].substring(p+1)):A=a[d],l(A,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function vt(a){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;a instanceof vt?(this.l=a.l,Qr(this,a.j),this.o=a.o,this.g=a.g,Jr(this,a.u),this.h=a.h,tc(this,jd(a.i)),this.m=a.m):a&&(l=String(a).match(Md))?(this.l=!1,Qr(this,l[1]||"",!0),this.o=Yr(l[2]||""),this.g=Yr(l[3]||"",!0),Jr(this,l[4]),this.h=Yr(l[5]||"",!0),tc(this,l[6]||"",!0),this.m=Yr(l[7]||"")):(this.l=!1,this.i=new Zr(null,this.l))}vt.prototype.toString=function(){let a=[];var l=this.j;l&&a.push(Xr(l,Fd,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(Xr(l,Fd,!0),"@"),a.push(Kr(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&a.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Xr(d,d.charAt(0)=="/"?by:Ay,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Xr(d,Ry)),a.join("")},vt.prototype.resolve=function(a){let l=Ze(this),d=!!a.j;d?Qr(l,a.j):d=!!a.o,d?l.o=a.o:d=!!a.g,d?l.g=a.g:d=a.u!=null;var p=a.h;if(d)Jr(l,a.u);else if(d=!!a.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var A=l.h.lastIndexOf("/");A!=-1&&(p=l.h.slice(0,A+1)+p)}if(A=p,A==".."||A==".")p="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){p=A.lastIndexOf("/",0)==0,A=A.split("/");let R=[];for(let x=0;x<A.length;){let K=A[x++];K=="."?p&&x==A.length&&R.push(""):K==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),p&&x==A.length&&R.push("")):(R.push(K),p=!0)}p=R.join("/")}else p=A}return d?l.h=p:d=a.i.toString()!=="",d?tc(l,jd(a.i)):d=!!a.m,d&&(l.m=a.m),l};function Ze(a){return new vt(a)}function Qr(a,l,d){a.j=d?Yr(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function Jr(a,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);a.u=l}else a.u=null}function tc(a,l,d){l instanceof Zr?(a.i=l,Py(a.i,a.l)):(d||(l=Xr(l,Sy)),a.i=new Zr(l,a.l))}function oe(a,l,d){a.i.set(l,d)}function _s(a){return oe(a,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),a}function Yr(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Xr(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,vy),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function vy(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Fd=/[#\/\?@]/g,Ay=/[#\?:]/g,by=/[#\?]/g,Sy=/[#\?@]/g,Ry=/#/g;function Zr(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function un(a){a.g||(a.g=new Map,a.h=0,a.i&&Ty(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}r=Zr.prototype,r.add=function(a,l){un(this),this.i=null,a=$n(this,a);let d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function Ud(a,l){un(a),l=$n(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function Bd(a,l){return un(a),l=$n(a,l),a.g.has(l)}r.forEach=function(a,l){un(this),this.g.forEach(function(d,p){d.forEach(function(A){a.call(l,A,p,this)},this)},this)};function qd(a,l){un(a);let d=[];if(typeof l=="string")Bd(a,l)&&(d=d.concat(a.g.get($n(a,l))));else for(a=Array.from(a.g.values()),l=0;l<a.length;l++)d=d.concat(a[l]);return d}r.set=function(a,l){return un(this),this.i=null,a=$n(this,a),Bd(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},r.get=function(a,l){return a?(a=qd(this,a),a.length>0?String(a[0]):l):l};function zd(a,l,d){Ud(a,l),d.length>0&&(a.i=null,a.g.set($n(a,l),P(d)),a.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(let p=0;p<l.length;p++){var d=l[p];let A=Kr(d);d=qd(this,d);for(let R=0;R<d.length;R++){let x=A;d[R]!==""&&(x+="="+Kr(d[R])),a.push(x)}}return this.i=a.join("&")};function jd(a){let l=new Zr;return l.i=a.i,a.g&&(l.g=new Map(a.g),l.h=a.h),l}function $n(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function Py(a,l){l&&!a.j&&(un(a),a.i=null,a.g.forEach(function(d,p){let A=p.toLowerCase();p!=A&&(Ud(this,p),zd(this,A,d))},a)),a.j=l}function Cy(a,l){let d=new Wr;if(o.Image){let p=new Image;p.onload=f(At,d,"TestLoadImage: loaded",!0,l,p),p.onerror=f(At,d,"TestLoadImage: error",!1,l,p),p.onabort=f(At,d,"TestLoadImage: abort",!1,l,p),p.ontimeout=f(At,d,"TestLoadImage: timeout",!1,l,p),o.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=a}else l(!1)}function Dy(a,l){let d=new Wr,p=new AbortController,A=setTimeout(()=>{p.abort(),At(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:p.signal}).then(R=>{clearTimeout(A),R.ok?At(d,"TestPingServer: ok",!0,l):At(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(A),At(d,"TestPingServer: error",!1,l)})}function At(a,l,d,p,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),p(d)}catch{}}function Ny(){this.g=new fy}function ys(a){this.i=a.Sb||null,this.h=a.ab||!1}m(ys,Id),ys.prototype.g=function(){return new Is(this.i,this.h)};function Is(a,l){be.call(this),this.H=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}m(Is,be),r=Is.prototype,r.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=l,this.readyState=1,ti(this)},r.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(l.body=a),(this.H||o).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ei(this)),this.readyState=0},r.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ti(this)),this.g&&(this.readyState=3,ti(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Gd(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))};function Gd(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}r.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?ei(this):ti(this),this.readyState==3&&Gd(this)}},r.Oa=function(a){this.g&&(this.response=this.responseText=a,ei(this))},r.Na=function(a){this.g&&(this.response=a,ei(this))},r.ga=function(){this.g&&ei(this)};function ei(a){a.readyState=4,a.l=null,a.j=null,a.B=null,ti(a)}r.setRequestHeader=function(a,l){this.A.append(a,l)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function ti(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Is.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function $d(a){let l="";return hs(a,function(d,p){l+=p,l+=":",l+=d,l+=`\r
`}),l}function nc(a,l,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=$d(d),typeof a=="string"?d!=null&&Kr(d):oe(a,l,d))}function le(a){be.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}m(le,be);var ky=/^https?$/i,Vy=["POST","PUT"];r=le.prototype,r.Fa=function(a){this.H=a},r.ea=function(a,l,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Sd.g(),this.g.onreadystatechange=y(h(this.Ca,this));try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(R){Wd(this,R);return}if(a=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var A in p)d.set(A,p[A]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let R of p.keys())d.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(R=>R.toLowerCase()=="content-type"),A=o.FormData&&a instanceof o.FormData,!(Array.prototype.indexOf.call(Vy,l,void 0)>=0)||p||A||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[R,x]of d)this.g.setRequestHeader(R,x);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(R){Wd(this,R)}};function Wd(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.o=5,Kd(a),ws(a)}function Kd(a){a.A||(a.A=!0,Ce(a,"complete"),Ce(a,"error"))}r.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,Ce(this,"complete"),Ce(this,"abort"),ws(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ws(this,!0)),le.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?Hd(this):this.Xa())},r.Xa=function(){Hd(this)};function Hd(a){if(a.h&&typeof s<"u"){if(a.v&&bt(a)==4)setTimeout(a.Ca.bind(a),0);else if(Ce(a,"readystatechange"),bt(a)==4){a.h=!1;try{let R=a.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var p;if(p=R===0){let x=String(a.D).match(Md)[1]||null;!x&&o.self&&o.self.location&&(x=o.self.location.protocol.slice(0,-1)),p=!ky.test(x?x.toLowerCase():"")}d=p}if(d)Ce(a,"complete"),Ce(a,"success");else{a.o=6;try{var A=bt(a)>2?a.g.statusText:""}catch{A=""}a.l=A+" ["+a.ca()+"]",Kd(a)}}finally{ws(a)}}}}function ws(a,l){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);let d=a.g;a.g=null,l||Ce(a,"ready");try{d.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function bt(a){return a.g?a.g.readyState:0}r.ca=function(){try{return bt(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),dy(l)}};function Qd(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function Oy(a){let l={};a=(a.g&&bt(a)>=2&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<a.length;p++){if(I(a[p]))continue;var d=yy(a[p]);let A=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let R=l[A]||[];l[A]=R,R.push(d)}ay(l,function(p){return p.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ni(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function Jd(a){this.za=0,this.i=[],this.j=new Wr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ni("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ni("baseRetryDelayMs",5e3,a),this.Za=ni("retryDelaySeedMs",1e4,a),this.Ta=ni("forwardChannelMaxRetries",2,a),this.va=ni("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new kd(a&&a.concurrentRequestLimit),this.Ba=new Ny,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=Jd.prototype,r.ka=8,r.I=1,r.connect=function(a,l,d,p){De(0),this.W=a,this.H=l||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=of(this,null,this.W),Ts(this)};function rc(a){if(Yd(a),a.I==3){var l=a.V++,d=Ze(a.J);if(oe(d,"SID",a.M),oe(d,"RID",l),oe(d,"TYPE","terminate"),ri(a,d),l=new Tt(a,a.j,l),l.M=2,l.A=_s(Ze(d)),d=!1,o.navigator&&o.navigator.sendBeacon)try{d=o.navigator.sendBeacon(l.A.toString(),"")}catch{}!d&&o.Image&&(new Image().src=l.A,d=!0),d||(l.g=af(l.j,null),l.g.ea(l.A)),l.F=Date.now(),gs(l)}sf(a)}function Es(a){a.g&&(sc(a),a.g.cancel(),a.g=null)}function Yd(a){Es(a),a.v&&(o.clearTimeout(a.v),a.v=null),vs(a),a.h.cancel(),a.m&&(typeof a.m=="number"&&o.clearTimeout(a.m),a.m=null)}function Ts(a){if(!Vd(a.h)&&!a.m){a.m=!0;var l=a.Ea;Z||_(),Y||(Z(),Y=!0),E.add(l,a),a.D=0}}function xy(a,l){return Od(a.h)>=a.h.j-(a.m?1:0)?!1:a.m?(a.i=l.G.concat(a.i),!0):a.I==1||a.I==2||a.D>=(a.Sa?0:a.Ta)?!1:(a.m=$r(h(a.Ea,a,l),rf(a,a.D)),a.D++,!0)}r.Ea=function(a){if(this.m)if(this.m=null,this.I==1){if(!a){this.V=Math.floor(Math.random()*1e5),a=this.V++;let A=new Tt(this,this.j,a),R=this.o;if(this.U&&(R?(R=cd(R),ld(R,this.U)):R=this.U),this.u!==null||this.R||(A.J=R,R=null),this.S)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(l+=p,l>4096){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Zd(this,A,l),d=Ze(this.J),oe(d,"RID",a),oe(d,"CVER",22),this.G&&oe(d,"X-HTTP-Session-Id",this.G),ri(this,d),R&&(this.R?l="headers="+Kr($d(R))+"&"+l:this.u&&nc(d,this.u,R)),ec(this.h,A),this.Ra&&oe(d,"TYPE","init"),this.S?(oe(d,"$req",l),oe(d,"SID","null"),A.U=!0,Ja(A,d,null)):Ja(A,d,l),this.I=2}}else this.I==3&&(a?Xd(this,a):this.i.length==0||Vd(this.h)||Xd(this))};function Xd(a,l){var d;l?d=l.l:d=a.V++;let p=Ze(a.J);oe(p,"SID",a.M),oe(p,"RID",d),oe(p,"AID",a.K),ri(a,p),a.u&&a.o&&nc(p,a.u,a.o),d=new Tt(a,a.j,d,a.D+1),a.u===null&&(d.J=a.o),l&&(a.i=l.G.concat(a.i)),l=Zd(a,d,1e3),d.H=Math.round(a.va*.5)+Math.round(a.va*.5*Math.random()),ec(a.h,d),Ja(d,p,l)}function ri(a,l){a.H&&hs(a.H,function(d,p){oe(l,p,d)}),a.l&&hs({},function(d,p){oe(l,p,d)})}function Zd(a,l,d){d=Math.min(a.i.length,d);let p=a.l?h(a.l.Ka,a.l,a):null;e:{var A=a.i;let K=-1;for(;;){let _e=["count="+d];K==-1?d>0?(K=A[0].g,_e.push("ofs="+K)):K=0:_e.push("ofs="+K);let ie=!0;for(let Ee=0;Ee<d;Ee++){var R=A[Ee].g;let et=A[Ee].map;if(R-=K,R<0)K=Math.max(0,A[Ee].g-100),ie=!1;else try{R="req"+R+"_"||"";try{var x=et instanceof Map?et:Object.entries(et);for(let[hn,St]of x){let Rt=St;c(St)&&(Rt=$a(St)),_e.push(R+hn+"="+encodeURIComponent(Rt))}}catch(hn){throw _e.push(R+"type="+encodeURIComponent("_badmap")),hn}}catch{p&&p(et)}}if(ie){x=_e.join("&");break e}}x=void 0}return a=a.i.splice(0,d),l.G=a,x}function ef(a){if(!a.g&&!a.v){a.Y=1;var l=a.Da;Z||_(),Y||(Z(),Y=!0),E.add(l,a),a.A=0}}function ic(a){return a.g||a.v||a.A>=3?!1:(a.Y++,a.v=$r(h(a.Da,a),rf(a,a.A)),a.A++,!0)}r.Da=function(){if(this.v=null,tf(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=$r(h(this.Wa,this),a)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,De(10),Es(this),tf(this))};function sc(a){a.B!=null&&(o.clearTimeout(a.B),a.B=null)}function tf(a){a.g=new Tt(a,a.j,"rpc",a.Y),a.u===null&&(a.g.J=a.o),a.g.P=0;var l=Ze(a.na);oe(l,"RID","rpc"),oe(l,"SID",a.M),oe(l,"AID",a.K),oe(l,"CI",a.F?"0":"1"),!a.F&&a.ia&&oe(l,"TO",a.ia),oe(l,"TYPE","xmlhttp"),ri(a,l),a.u&&a.o&&nc(l,a.u,a.o),a.O&&(a.g.H=a.O);var d=a.g;a=a.ba,d.M=1,d.A=_s(Ze(l)),d.u=null,d.R=!0,Cd(d,a)}r.Va=function(){this.C!=null&&(this.C=null,Es(this),ic(this),De(19))};function vs(a){a.C!=null&&(o.clearTimeout(a.C),a.C=null)}function nf(a,l){var d=null;if(a.g==l){vs(a),sc(a),a.g=null;var p=2}else if(Za(a.h,l))d=l.G,xd(a.h,l),p=1;else return;if(a.I!=0){if(l.o)if(p==1){d=l.u?l.u.length:0,l=Date.now()-l.F;var A=a.D;p=ps(),Ce(p,new Ad(p,d)),Ts(a)}else ef(a);else if(A=l.m,A==3||A==0&&l.X>0||!(p==1&&xy(a,l)||p==2&&ic(a)))switch(d&&d.length>0&&(l=a.h,l.i=l.i.concat(d)),A){case 1:ln(a,5);break;case 4:ln(a,10);break;case 3:ln(a,6);break;default:ln(a,2)}}}function rf(a,l){let d=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(d*=2),d*l}function ln(a,l){if(a.j.info("Error code "+l),l==2){var d=h(a.bb,a),p=a.Ua;let A=!p;p=new vt(p||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Qr(p,"https"),_s(p),A?Cy(p.toString(),d):Dy(p.toString(),d)}else De(2);a.I=0,a.l&&a.l.pa(l),sf(a),Yd(a)}r.bb=function(a){a?(this.j.info("Successfully pinged google.com"),De(2)):(this.j.info("Failed to ping google.com"),De(1))};function sf(a){if(a.I=0,a.ja=[],a.l){let l=Ld(a.h);(l.length!=0||a.i.length!=0)&&(k(a.ja,l),k(a.ja,a.i),a.h.i.length=0,P(a.i),a.i.length=0),a.l.oa()}}function of(a,l,d){var p=d instanceof vt?Ze(d):new vt(d);if(p.g!="")l&&(p.g=l+"."+p.g),Jr(p,p.u);else{var A=o.location;p=A.protocol,l=l?l+"."+A.hostname:A.hostname,A=+A.port;let R=new vt(null);p&&Qr(R,p),l&&(R.g=l),A&&Jr(R,A),d&&(R.h=d),p=R}return d=a.G,l=a.wa,d&&l&&oe(p,d,l),oe(p,"VER",a.ka),ri(a,p),p}function af(a,l,d){if(l&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Aa&&!a.ma?new le(new ys({ab:d})):new le(a.ma),l.Fa(a.L),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function cf(){}r=cf.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function As(){}As.prototype.g=function(a,l){return new xe(a,l)};function xe(a,l){be.call(this),this.g=new Jd(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(a?a["X-WebChannel-Client-Profile"]=l.sa:a={"X-WebChannel-Client-Profile":l.sa}),this.g.U=a,(a=l&&l.Qb)&&!I(a)&&(this.g.u=a),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!I(l)&&(this.g.G=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new Wn(this)}m(xe,be),xe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xe.prototype.close=function(){rc(this.g)},xe.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.v&&(d={},d.__data__=$a(a),a=d);l.i.push(new Ey(l.Ya++,a)),l.I==3&&Ts(l)},xe.prototype.N=function(){this.g.l=null,delete this.j,rc(this.g),delete this.g,xe.Z.N.call(this)};function uf(a){Wa.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){e:{for(let d in l){a=d;break e}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}m(uf,Wa);function lf(){Ka.call(this),this.status=1}m(lf,Ka);function Wn(a){this.g=a}m(Wn,cf),Wn.prototype.ra=function(){Ce(this.g,"a")},Wn.prototype.qa=function(a){Ce(this.g,new uf(a))},Wn.prototype.pa=function(a){Ce(this.g,new lf)},Wn.prototype.oa=function(){Ce(this.g,"b")},As.prototype.createWebChannel=As.prototype.g,xe.prototype.send=xe.prototype.o,xe.prototype.open=xe.prototype.m,xe.prototype.close=xe.prototype.close,Uc=pt.createWebChannelTransport=function(){return new As},Fc=pt.getStatEventTarget=function(){return ps()},Mc=pt.Event=an,Ls=pt.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ms.NO_ERROR=0,ms.TIMEOUT=8,ms.HTTP_ERROR=6,ai=pt.ErrorCode=ms,bd.COMPLETE="complete",Lc=pt.EventType=bd,wd.EventType=jr,jr.OPEN="a",jr.CLOSE="b",jr.ERROR="c",jr.MESSAGE="d",be.prototype.listen=be.prototype.J,Jn=pt.WebChannel=wd,HI=pt.FetchXmlHttpFactory=ys,le.prototype.listenOnce=le.prototype.K,le.prototype.getLastError=le.prototype.Ha,le.prototype.getLastErrorCode=le.prototype.ya,le.prototype.getStatus=le.prototype.ca,le.prototype.getResponseJson=le.prototype.La,le.prototype.getResponseText=le.prototype.la,le.prototype.send=le.prototype.ea,le.prototype.setWithCredentials=le.prototype.Fa,xc=pt.XhrIo=le}).apply(typeof xs<"u"?xs:typeof self<"u"?self:typeof window<"u"?window:{});var Gf="@firebase/firestore",$f="4.9.3";var ve=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ve.UNAUTHENTICATED=new ve(null),ve.GOOGLE_CREDENTIALS=new ve("google-credentials-uid"),ve.FIRST_PARTY=new ve("first-party-uid"),ve.MOCK_USER=new ve("mock-user");var Or="12.7.0";var Dn=new Ct("@firebase/firestore");function rr(){return Dn.logLevel}function D(r,...e){if(Dn.logLevel<=Q.DEBUG){let t=e.map(Jl);Dn.debug(`Firestore (${Or}): ${r}`,...t)}}function de(r,...e){if(Dn.logLevel<=Q.ERROR){let t=e.map(Jl);Dn.error(`Firestore (${Or}): ${r}`,...t)}}function vi(r,...e){if(Dn.logLevel<=Q.WARN){let t=e.map(Jl);Dn.warn(`Firestore (${Or}): ${r}`,...t)}}function Jl(r){if(typeof r=="string")return r;try{return(function(t){return JSON.stringify(t)})(r)}catch{return r}}function M(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,im(r,n,t)}function im(r,e,t){let n=`FIRESTORE (${Or}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw de(n),new Error(n)}function U(r,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,r||im(e,i,n)}function F(r,e){return r}var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends Le{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var $e=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Qc=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Jc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ve.UNAUTHENTICATED))}shutdown(){}};var Yc=class{constructor(e){this.t=e,this.currentUser=ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){U(this.o===void 0,42304);let n=this.i,i=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve(),s=new $e;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new $e,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>g(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},c=u=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?c(u):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new $e)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U(typeof n.accessToken=="string",31837,{l:n}),new Qc(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return U(e===null||typeof e=="string",2055,{h:e}),new ve(e)}},Xc=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=ve.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Zc=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Xc(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Js=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},eu=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Me(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){U(this.o===void 0,3512);let n=s=>{s.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,D("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Js(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(U(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Js(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function QI(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}var Ai=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let i=QI(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}};function G(r,e){return r<e?-1:r>e?1:0}function tu(r,e){let t=Math.min(r.length,e.length);for(let n=0;n<t;n++){let i=r.charAt(n),s=e.charAt(n);if(i!==s)return Bc(i)===Bc(s)?G(i,s):Bc(i)?1:-1}return G(r.length,e.length)}var JI=55296,YI=57343;function Bc(r){let e=r.charCodeAt(0);return e>=JI&&e<=YI}function dr(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function sm(r){return r+"\0"}var Wf="__name__",Ys=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&M(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&M(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=r.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return G(e.length,t.length)}static compareSegments(e,t){let n=r.isNumericId(e),i=r.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?r.extractNumericId(e).compare(r.extractNumericId(t)):tu(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ft.fromString(e.substring(4,e.length-2))}},ee=class r extends Ys{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new V(C.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},XI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ye=class r extends Ys{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return XI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Wf}static keyField(){return new r([Wf])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new V(C.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},o=!1;for(;i<e.length;){let c=e[i];if(c==="\\"){if(i+1===e.length)throw new V(C.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new V(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else c==="`"?(o=!o,i++):c!=="."||o?(n+=c,i++):(s(),i++)}if(s(),o)throw new V(C.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};var L=class r{constructor(e){this.path=e}static fromPath(e){return new r(ee.fromString(e))}static fromName(e){return new r(ee.fromString(e).popFirst(5))}static empty(){return new r(ee.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ee.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ee.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new ee(e.slice()))}};function om(r,e,t){if(!t)throw new V(C.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function ZI(r,e,t,n){if(e===!0&&n===!0)throw new V(C.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Kf(r){if(!L.isDocumentKey(r))throw new V(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Hf(r){if(L.isDocumentKey(r))throw new V(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function am(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Zo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=(function(n){return n.constructor?n.constructor.name:null})(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":M(12329,{type:typeof r})}function ze(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new V(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Zo(r);throw new V(C.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function me(r,e){let t={typeString:r};return e&&(t.value=e),t}function Hi(r,e){if(!am(r))throw new V(C.INVALID_ARGUMENT,"JSON must be an object");let t;for(let n in e)if(e[n]){let i=e[n].typeString,s="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}let o=r[n];if(i&&typeof o!==i){t=`JSON field '${n}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${n}' field to equal '${s.value}'`;break}}if(t)throw new V(C.INVALID_ARGUMENT,t);return!0}var Qf=-62135596800,Jf=1e6,se=class r{static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Jf);return new r(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Qf)throw new V(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Jf}_compareTo(e){return this.seconds===e.seconds?G(this.nanoseconds,e.nanoseconds):G(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Hi(e,r._jsonSchema))return new r(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Qf;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};se._jsonSchemaVersion="firestore/timestamp/1.0",se._jsonSchema={type:me("string",se._jsonSchemaVersion),seconds:me("number"),nanoseconds:me("number")};var q=class r{static fromTimestamp(e){return new r(e)}static min(){return new r(new se(0,0))}static max(){return new r(new se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var fr=-1,pr=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};function nu(r){return r.fields.find(e=>e.kind===2)}function mn(r){return r.fields.filter(e=>e.kind!==2)}pr.UNKNOWN_ID=-1;var ur=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var bi=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,We.min())}};function cm(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=q.fromTimestamp(n===1e9?new se(t+1,0):new se(t,n));return new We(i,L.empty(),e)}function um(r){return new We(r.readTime,r.key,fr)}var We=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(q.min(),L.empty(),fr)}static max(){return new r(q.max(),L.empty(),fr)}};function Yl(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(r.documentKey,e.documentKey),t!==0?t:G(r.largestBatchId,e.largestBatchId))}var lm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Xs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Zt(r){return g(this,null,function*(){if(r.code!==C.FAILED_PRECONDITION||r.message!==lm)throw r;D("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,o=!1;e.forEach(c=>{++i,c.next(()=>{++s,o&&s===i&&t()},u=>n(u))}),o=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,o=new Array(s),c=0;for(let u=0;u<s;u++){let h=u;t(e[h]).next(f=>{o[h]=f,++c,c===s&&n(o)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};var Fe="SimpleDb",Zs=class r{static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new An(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new $e,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new An(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{let i=Xl(n.target.error);this.S.reject(new An(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(D(Fe,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new iu(t)}},mr=class r{static delete(e){return D(Fe,"Removing database:",e),_n(dc().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Ns())return!1;if(r.F())return!0;let e=he(),t=r.M(e),n=0<t&&t<10,i=hm(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.N=n,this.B=null,r.M(he())===12.2&&de("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}L(e){return g(this,null,function*(){return this.db||(D(Fe,"Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{n(new An(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?n(new V(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?n(new V(C.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):n(new An(e,o))},i.onupgradeneeded=s=>{D(Fe,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.N.k(o,i.transaction,s.oldVersion,this.version).next(()=>{D(Fe,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=t=>this.q(t)),this.db})}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){return g(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.L(e);let c=Zs.open(this.db,e,s?"readonly":"readwrite",n),u=i(c).next(h=>(c.C(),h)).catch(h=>(c.abort(h),S.reject(h))).toPromise();return u.catch(()=>{}),yield c.D,u}catch(c){let u=c,h=u.name!=="FirebaseError"&&o<3;if(D(Fe,"Transaction failed with error:",u.message,"Retrying:",h),this.close(),!h)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function hm(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var ru=class{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return _n(this.U.delete())}},An=class extends V{constructor(e,t){super(C.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function en(r){return r.name==="IndexedDbTransactionError"}var iu=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(D(Fe,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(D(Fe,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),_n(n)}add(e){return D(Fe,"ADD",this.store.name,e,e),_n(this.store.add(e))}get(e){return _n(this.store.get(e)).next(t=>(t===void 0&&(t=null),D(Fe,"GET",this.store.name,e,t),t))}delete(e){return D(Fe,"DELETE",this.store.name,e),_n(this.store.delete(e))}count(){return D(Fe,"COUNT",this.store.name),_n(this.store.count())}J(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((o,c)=>{s.onerror=u=>{c(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(n),o=[];return this.H(s,(c,u)=>{o.push(u)}).next(()=>o)}}Y(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new S((i,s)=>{n.onerror=o=>{s(o.target.error)},n.onsuccess=o=>{i(o.target.result)}})}Z(e,t){D(Fe,"DELETE ALL",this.store.name);let n=this.options(e,t);n.X=!1;let i=this.cursor(n);return this.H(i,(s,o,c)=>c.delete())}ee(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.H(i,t)}te(e){let t=this.cursor({});return new S((n,i)=>{t.onerror=s=>{let o=Xl(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(c=>{c?o.continue():n()}):n()}})}H(e,t){let n=[];return new S((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let c=o.target.result;if(!c)return void i();let u=new ru(c),h=t(c.primaryKey,c.value,u);if(h instanceof S){let f=h.catch(m=>(u.done(),S.reject(m)));n.push(f)}u.isDone?i():u.G===null?c.continue():c.continue(u.G)}}).next(()=>S.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function _n(r){return new S((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=Xl(n.target.error);t(i)}})}var Yf=!1;function Xl(r){let e=mr.M(he());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Yf||(Yf=!0,setTimeout(()=>{throw n},0)),n}}return r}var pi="IndexBackfiller",su=class{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){D(pi,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{let t=yield this.ne.ie();D(pi,`Documents written: ${t}`)}catch(t){en(t)?D(pi,"Ignoring IndexedDB error during index backfill: ",t):yield Zt(t)}yield this.re(6e4)}))}},ou=class{constructor(e,t){this.localStore=e,this.persistence=t}ie(e=50){return g(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))})}se(e,t){let n=new Set,i=t,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!n.has(o))return D(pi,`Processing collection: ${o}`),this.oe(e,o,i).next(c=>{i-=c,n.add(o)});s=!1})).next(()=>t-i)}oe(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(i,s)).next(c=>(D(pi,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>o.size)}))}_e(e,t){let n=e;return t.changes.forEach((i,s)=>{let o=um(s);Yl(o,n)>0&&(n=o)}),new We(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Ue=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>n.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ue&&this.ue(t),t}}r.ce=-1;return r})(),bn=-1;function ea(r){return r==null}function Si(r){return r===0&&1/r==-1/0}function dm(r){return typeof r=="number"&&Number.isInteger(r)&&!Si(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var eo="";function Pe(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Xf(e)),e=ew(r.get(t),e);return Xf(e)}function ew(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case eo:t+="";break;default:t+=s}}return t}function Xf(r){return r+eo+""}function st(r){let e=r.length;if(U(e>=2,64408,{path:r}),e===2)return U(r.charAt(0)===eo&&r.charAt(1)==="",56145,{path:r}),ee.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let o=r.indexOf(eo,s);switch((o<0||o>t)&&M(50515,{path:r}),r.charAt(o+1)){case"":let c=r.substring(s,o),u;i.length===0?u=c:(i+=c,u=i,i=""),n.push(u);break;case"":i+=r.substring(s,o),i+="\0";break;case"":i+=r.substring(s,o+1);break;default:M(61167,{path:r})}s=o+2}return new ee(n)}var gn="remoteDocuments",Qi="owner",Yn="owner",Ri="mutationQueues",tw="userId",He="mutations",Zf="batchId",En="userMutationsIndex",ep=["userId","batchId"];function zs(r,e){return[r,Pe(e)]}function fm(r,e,t){return[r,Pe(e),t]}var nw={},gr="documentMutations",to="remoteDocumentsV14",rw=["prefixPath","collectionGroup","readTime","documentId"],js="documentKeyIndex",iw=["prefixPath","collectionGroup","documentId"],pm="collectionGroupIndex",sw=["collectionGroup","readTime","prefixPath","documentId"],Pi="remoteDocumentGlobal",au="remoteDocumentGlobalKey",_r="targets",mm="queryTargetsIndex",ow=["canonicalId","targetId"],yr="targetDocuments",aw=["targetId","path"],Zl="documentTargetsIndex",cw=["path","targetId"],no="targetGlobalKey",Sn="targetGlobal",Ci="collectionParents",uw=["collectionId","parent"],Ir="clientMetadata",lw="clientId",ta="bundles",hw="bundleId",na="namedQueries",dw="name",eh="indexConfiguration",fw="indexId",cu="collectionGroupIndex",pw="collectionGroup",mi="indexState",mw=["indexId","uid"],gm="sequenceNumberIndex",gw=["uid","sequenceNumber"],gi="indexEntries",_w=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],_m="documentKeyIndex",yw=["indexId","uid","orderedDocumentKey"],ra="documentOverlays",Iw=["userId","collectionPath","documentId"],uu="collectionPathOverlayIndex",ww=["userId","collectionPath","largestBatchId"],ym="collectionGroupOverlayIndex",Ew=["userId","collectionGroup","largestBatchId"],th="globals",Tw="name",Im=[Ri,He,gr,gn,_r,Qi,Sn,yr,Ir,Pi,Ci,ta,na],vw=[...Im,ra],wm=[Ri,He,gr,to,_r,Qi,Sn,yr,Ir,Pi,Ci,ta,na,ra],Em=wm,nh=[...Em,eh,mi,gi],Aw=nh,Tm=[...nh,th],bw=Tm;var Di=class extends Xs{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}};function we(r,e){let t=F(r);return mr.O(t.le,e)}function tp(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function tn(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function vm(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}var ae=class r{constructor(e,t){this.comparator=e,this.root=t||at.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,at.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,at.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cr(this.root,e,this.comparator,!1)}getReverseIterator(){return new cr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cr(this.root,e,this.comparator,!0)}},cr=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},at=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+(this.isRed()?0:1)}};at.EMPTY=null,at.RED=!0,at.BLACK=!1;at.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new at(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var re=class r{constructor(e){this.comparator=e,this.data=new ae(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ro(this.data.getIterator())}getIteratorFrom(e){return new ro(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},ro=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Xn(r){return r.hasNext()?r.getNext():void 0}var Be=class r{constructor(e){this.fields=e,e.sort(ye.comparator)}static empty(){return new r([])}unionWith(e){let t=new re(ye.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return dr(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var io=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var ge=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new io("Invalid base64 string: "+s):s}})(e);return new r(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s})(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return G(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};ge.EMPTY_BYTE_STRING=new ge("");var Sw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gt(r){if(U(!!r,39018),typeof r=="string"){let e=0,t=Sw.exec(r);if(U(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ce(r.seconds),nanos:ce(r.nanos)}}function ce(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function _t(r){return typeof r=="string"?ge.fromBase64String(r):ge.fromUint8Array(r)}var Am="server_timestamp",bm="__type__",Sm="__previous_value__",Rm="__local_write_time__";function rh(r){return(r?.mapValue?.fields||{})[bm]?.stringValue===Am}function ia(r){let e=r.mapValue.fields[Sm];return rh(e)?ia(e):e}function Ni(r){let e=gt(r.mapValue.fields[Rm].timestampValue);return new se(e.seconds,e.nanos)}var lu=class{constructor(e,t,n,i,s,o,c,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=h,this.isUsingEmulator=f}},so="(default)",wr=class r{constructor(e,t){this.projectId=e,this.database=t||so}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===so}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};var ih="__type__",Pm="__max__",Mt={mapValue:{fields:{__type__:{stringValue:Pm}}}},sh="__vector__",Er="value",Gs={nullValue:"NULL_VALUE"};function zt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?rh(r)?4:Cm(r)?9007199254740991:sa(r)?10:11:M(28295,{value:r})}function ct(r,e){if(r===e)return!0;let t=zt(r);if(t!==zt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Ni(r).isEqual(Ni(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=gt(i.timestampValue),c=gt(s.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos})(r,e);case 5:return r.stringValue===e.stringValue;case 6:return(function(i,s){return _t(i.bytesValue).isEqual(_t(s.bytesValue))})(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return(function(i,s){return ce(i.geoPointValue.latitude)===ce(s.geoPointValue.latitude)&&ce(i.geoPointValue.longitude)===ce(s.geoPointValue.longitude)})(r,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return ce(i.integerValue)===ce(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ce(i.doubleValue),c=ce(s.doubleValue);return o===c?Si(o)===Si(c):isNaN(o)&&isNaN(c)}return!1})(r,e);case 9:return dr(r.arrayValue.values||[],e.arrayValue.values||[],ct);case 10:case 11:return(function(i,s){let o=i.mapValue.fields||{},c=s.mapValue.fields||{};if(tp(o)!==tp(c))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!ct(o[u],c[u])))return!1;return!0})(r,e);default:return M(52216,{left:r})}}function ki(r,e){return(r.values||[]).find(t=>ct(t,e))!==void 0}function jt(r,e){if(r===e)return 0;let t=zt(r),n=zt(e);if(t!==n)return G(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return G(r.booleanValue,e.booleanValue);case 2:return(function(s,o){let c=ce(s.integerValue||s.doubleValue),u=ce(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1})(r,e);case 3:return np(r.timestampValue,e.timestampValue);case 4:return np(Ni(r),Ni(e));case 5:return tu(r.stringValue,e.stringValue);case 6:return(function(s,o){let c=_t(s),u=_t(o);return c.compareTo(u)})(r.bytesValue,e.bytesValue);case 7:return(function(s,o){let c=s.split("/"),u=o.split("/");for(let h=0;h<c.length&&h<u.length;h++){let f=G(c[h],u[h]);if(f!==0)return f}return G(c.length,u.length)})(r.referenceValue,e.referenceValue);case 8:return(function(s,o){let c=G(ce(s.latitude),ce(o.latitude));return c!==0?c:G(ce(s.longitude),ce(o.longitude))})(r.geoPointValue,e.geoPointValue);case 9:return rp(r.arrayValue,e.arrayValue);case 10:return(function(s,o){let c=s.fields||{},u=o.fields||{},h=c[Er]?.arrayValue,f=u[Er]?.arrayValue,m=G(h?.values?.length||0,f?.values?.length||0);return m!==0?m:rp(h,f)})(r.mapValue,e.mapValue);case 11:return(function(s,o){if(s===Mt.mapValue&&o===Mt.mapValue)return 0;if(s===Mt.mapValue)return 1;if(o===Mt.mapValue)return-1;let c=s.fields||{},u=Object.keys(c),h=o.fields||{},f=Object.keys(h);u.sort(),f.sort();for(let m=0;m<u.length&&m<f.length;++m){let y=tu(u[m],f[m]);if(y!==0)return y;let P=jt(c[u[m]],h[f[m]]);if(P!==0)return P}return G(u.length,f.length)})(r.mapValue,e.mapValue);default:throw M(23264,{he:t})}}function np(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return G(r,e);let t=gt(r),n=gt(e),i=G(t.seconds,n.seconds);return i!==0?i:G(t.nanos,n.nanos)}function rp(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=jt(t[i],n[i]);if(s)return s}return G(t.length,n.length)}function Tr(r){return hu(r)}function hu(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(t){let n=gt(t);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(t){return _t(t).toBase64()})(r.bytesValue):"referenceValue"in r?(function(t){return L.fromName(t).toString()})(r.referenceValue):"geoPointValue"in r?(function(t){return`geo(${t.latitude},${t.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=hu(s);return n+"]"})(r.arrayValue):"mapValue"in r?(function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of n)s?s=!1:i+=",",i+=`${o}:${hu(t.fields[o])}`;return i+"}"})(r.mapValue):M(61005,{value:r})}function $s(r){switch(zt(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=ia(r);return e?16+$s(e):16;case 5:return 2*r.stringValue.length;case 6:return _t(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce((i,s)=>i+$s(s),0)})(r.arrayValue);case 10:case 11:return(function(n){let i=0;return tn(n.fields,(s,o)=>{i+=s.length+$s(o)}),i})(r.mapValue);default:throw M(13486,{value:r})}}function Vi(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function du(r){return!!r&&"integerValue"in r}function Oi(r){return!!r&&"arrayValue"in r}function ip(r){return!!r&&"nullValue"in r}function sp(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Ws(r){return!!r&&"mapValue"in r}function sa(r){return(r?.mapValue?.fields||{})[ih]?.stringValue===sh}function _i(r){if(r.geoPointValue)return{geoPointValue:W({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:W({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return tn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=_i(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=_i(r.arrayValue.values[t]);return e}return W({},r)}function Cm(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Pm}var Dm={mapValue:{fields:{[ih]:{stringValue:sh},[Er]:{arrayValue:{}}}}};function Rw(r){return"nullValue"in r?Gs:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Vi(wr.empty(),L.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?sa(r)?Dm:{mapValue:{}}:M(35942,{value:r})}function Pw(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Vi(wr.empty(),L.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Dm:"mapValue"in r?sa(r)?{mapValue:{}}:Mt:M(61959,{value:r})}function op(r,e){let t=jt(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function ap(r,e){let t=jt(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}var Ne=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ws(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=_i(t)}setAll(e){let t=ye.emptyPath(),n={},i=[];e.forEach((o,c)=>{if(!t.isImmediateParentOf(c)){let u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=c.popLast()}o?n[c.lastSegment()]=_i(o):i.push(c.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ct(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Ws(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){tn(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(_i(this.value))}};function Nm(r){let e=[];return tn(r.fields,(t,n)=>{let i=new ye([t]);if(Ws(n)){let s=Nm(n.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new Be(e)}var Ae=class r{constructor(e,t,n,i,s,o,c){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=c}static newInvalidDocument(e){return new r(e,0,q.min(),q.min(),q.min(),Ne.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,q.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,q.min(),q.min(),Ne.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,q.min(),q.min(),Ne.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ne.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ne.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Gt=class{constructor(e,t){this.position=e,this.inclusive=t}};function cp(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],o=r.position[i];if(s.field.isKeyField()?n=L.comparator(L.fromName(o.referenceValue),t.key):n=jt(o,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function up(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!ct(r.position[t],e.position[t]))return!1;return!0}var Nn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Cw(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}var oo=class{},J=class r extends oo{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new mu(e,t,n):t==="array-contains"?new yu(e,n):t==="in"?new ao(e,n):t==="not-in"?new Iu(e,n):t==="array-contains-any"?new wu(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new gu(e,n):new _u(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(jt(t,this.value)):t!==null&&zt(this.value)===zt(t)&&this.matchesComparison(jt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},te=class r extends oo{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new r(e,t)}matches(e){return vr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}};function vr(r){return r.op==="and"}function fu(r){return r.op==="or"}function oh(r){return km(r)&&vr(r)}function km(r){for(let e of r.filters)if(e instanceof te)return!1;return!0}function pu(r){if(r instanceof J)return r.field.canonicalString()+r.op.toString()+Tr(r.value);if(oh(r))return r.filters.map(e=>pu(e)).join(",");{let e=r.filters.map(t=>pu(t)).join(",");return`${r.op}(${e})`}}function Vm(r,e){return r instanceof J?(function(n,i){return i instanceof J&&n.op===i.op&&n.field.isEqual(i.field)&&ct(n.value,i.value)})(r,e):r instanceof te?(function(n,i){return i instanceof te&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,o,c)=>s&&Vm(o,i.filters[c]),!0):!1})(r,e):void M(19439)}function Om(r,e){let t=r.filters.concat(e);return te.create(t,r.op)}function xm(r){return r instanceof J?(function(t){return`${t.field.canonicalString()} ${t.op} ${Tr(t.value)}`})(r):r instanceof te?(function(t){return t.op.toString()+" {"+t.getFilters().map(xm).join(" ,")+"}"})(r):"Filter"}var mu=class extends J{constructor(e,t,n){super(e,t,n),this.key=L.fromName(n.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},gu=class extends J{constructor(e,t){super(e,"in",t),this.keys=Lm("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},_u=class extends J{constructor(e,t){super(e,"not-in",t),this.keys=Lm("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Lm(r,e){return(e.arrayValue?.values||[]).map(t=>L.fromName(t.referenceValue))}var yu=class extends J{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Oi(t)&&ki(t.arrayValue,this.value)}},ao=class extends J{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&ki(this.value.arrayValue,t)}},Iu=class extends J{constructor(e,t){super(e,"not-in",t)}matches(e){if(ki(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ki(this.value.arrayValue,t)}},wu=class extends J{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Oi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>ki(this.value.arrayValue,n))}};var Eu=class{constructor(e,t=null,n=[],i=[],s=null,o=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=c,this.Te=null}};function Tu(r,e=null,t=[],n=[],i=null,s=null,o=null){return new Eu(r,e,t,n,i,s,o)}function kn(r){let e=F(r);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>pu(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>(function(s){return s.field.canonicalString()+s.dir})(n)).join(","),ea(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Tr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Tr(n)).join(",")),e.Te=t}return e.Te}function Ji(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Cw(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Vm(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!up(r.startAt,e.startAt)&&up(r.endAt,e.endAt)}function co(r){return L.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function uo(r,e){return r.filters.filter(t=>t instanceof J&&t.field.isEqual(e))}function lp(r,e,t){let n=Gs,i=!0;for(let s of uo(r,e)){let o=Gs,c=!0;switch(s.op){case"<":case"<=":o=Rw(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,c=!1;break;case"!=":case"not-in":o=Gs}op({value:n,inclusive:i},{value:o,inclusive:c})<0&&(n=o,i=c)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];op({value:n,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}function hp(r,e,t){let n=Mt,i=!0;for(let s of uo(r,e)){let o=Mt,c=!0;switch(s.op){case">=":case">":o=Pw(s.value),c=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,c=!1;break;case"!=":case"not-in":o=Mt}ap({value:n,inclusive:i},{value:o,inclusive:c})>0&&(n=o,i=c)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let o=t.position[s];ap({value:n,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(n=o,i=t.inclusive);break}}return{value:n,inclusive:i}}var $t=class{constructor(e,t=null,n=[],i=[],s=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=c,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}};function Mm(r,e,t,n,i,s,o,c){return new $t(r,e,t,n,i,s,o,c)}function Yi(r){return new $t(r)}function dp(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Fm(r){return r.collectionGroup!==null}function yi(r){let e=F(r);if(e.Ie===null){e.Ie=[];let t=new Set;for(let s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new re(ye.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(h=>{h.isInequality()&&(c=c.add(h.field))})}),c})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new Nn(s,n))}),t.has(ye.keyField().canonicalString())||e.Ie.push(new Nn(ye.keyField(),n))}return e.Ie}function je(r){let e=F(r);return e.Ee||(e.Ee=Dw(e,yi(r))),e.Ee}function Dw(r,e){if(r.limitType==="F")return Tu(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Nn(i.field,s)});let t=r.endAt?new Gt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Gt(r.startAt.position,r.startAt.inclusive):null;return Tu(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function vu(r,e){let t=r.filters.concat([e]);return new $t(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Au(r,e,t){return new $t(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function oa(r,e){return Ji(je(r),je(e))&&r.limitType===e.limitType}function Um(r){return`${kn(je(r))}|lt:${r.limitType}`}function ir(r){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>xm(i)).join(", ")}]`),ea(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Tr(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Tr(i)).join(",")),`Target(${n})`})(je(r))}; limitType=${r.limitType})`}function Xi(r,e){return e.isFoundDocument()&&(function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):L.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)})(r,e)&&(function(n,i){for(let s of yi(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(r,e)&&(function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0})(r,e)&&(function(n,i){return!(n.startAt&&!(function(o,c,u){let h=cp(o,c,u);return o.inclusive?h<=0:h<0})(n.startAt,yi(n),i)||n.endAt&&!(function(o,c,u){let h=cp(o,c,u);return o.inclusive?h>=0:h>0})(n.endAt,yi(n),i))})(r,e)}function Bm(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function qm(r){return(e,t)=>{let n=!1;for(let i of yi(r)){let s=Nw(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function Nw(r,e,t){let n=r.field.isKeyField()?L.comparator(e.key,t.key):(function(s,o,c){let u=o.data.field(s),h=c.data.field(s);return u!==null&&h!==null?jt(u,h):M(42886)})(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return M(19790,{direction:r.dir})}}var Qe=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){tn(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return vm(this.inner)}size(){return this.innerSize}};var kw=new ae(L.comparator);function qe(){return kw}var zm=new ae(L.comparator);function di(...r){let e=zm;for(let t of r)e=e.insert(t.key,t);return e}function jm(r){let e=zm;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function ot(){return Ii()}function Gm(){return Ii()}function Ii(){return new Qe(r=>r.toString(),(r,e)=>r.isEqual(e))}var Vw=new ae(L.comparator),Ow=new re(L.comparator);function H(...r){let e=Ow;for(let t of r)e=e.add(t);return e}var xw=new re(G);function ah(){return xw}function ch(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Si(e)?"-0":e}}function $m(r){return{integerValue:""+r}}function Lw(r,e){return dm(e)?$m(e):ch(r,e)}var Ar=class{constructor(){this._=void 0}};function Mw(r,e,t){return r instanceof Wt?(function(i,s){let o={fields:{[bm]:{stringValue:Am},[Rm]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&rh(s)&&(s=ia(s)),s&&(o.fields[Sm]=s),{mapValue:o}})(t,e):r instanceof Kt?Km(r,e):r instanceof Ht?Hm(r,e):(function(i,s){let o=Wm(i,s),c=fp(o)+fp(i.Ae);return du(o)&&du(i.Ae)?$m(c):ch(i.serializer,c)})(r,e)}function Fw(r,e,t){return r instanceof Kt?Km(r,e):r instanceof Ht?Hm(r,e):t}function Wm(r,e){return r instanceof Vn?(function(n){return du(n)||(function(s){return!!s&&"doubleValue"in s})(n)})(e)?e:{integerValue:0}:null}var Wt=class extends Ar{},Kt=class extends Ar{constructor(e){super(),this.elements=e}};function Km(r,e){let t=Qm(e);for(let n of r.elements)t.some(i=>ct(i,n))||t.push(n);return{arrayValue:{values:t}}}var Ht=class extends Ar{constructor(e){super(),this.elements=e}};function Hm(r,e){let t=Qm(e);for(let n of r.elements)t=t.filter(i=>!ct(i,n));return{arrayValue:{values:t}}}var Vn=class extends Ar{constructor(e,t){super(),this.serializer=e,this.Ae=t}};function fp(r){return ce(r.integerValue||r.doubleValue)}function Qm(r){return Oi(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var lo=class{constructor(e,t){this.field=e,this.transform=t}};function Uw(r,e){return r.field.isEqual(e.field)&&(function(n,i){return n instanceof Kt&&i instanceof Kt||n instanceof Ht&&i instanceof Ht?dr(n.elements,i.elements,ct):n instanceof Vn&&i instanceof Vn?ct(n.Ae,i.Ae):n instanceof Wt&&i instanceof Wt})(r.transform,e.transform)}var bu=class{constructor(e,t){this.version=e,this.transformResults=t}},Re=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Ks(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}var br=class{};function Jm(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new On(r.key,Re.none()):new Qt(r.key,r.data,Re.none());{let t=r.data,n=Ne.empty(),i=new re(ye.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?n.delete(s):n.set(s,o),i=i.add(s)}return new Je(r.key,n,new Be(i.toArray()),Re.none())}}function Bw(r,e,t){r instanceof Qt?(function(i,s,o){let c=i.value.clone(),u=mp(i.fieldTransforms,s,o.transformResults);c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(r,e,t):r instanceof Je?(function(i,s,o){if(!Ks(i.precondition,s))return void s.convertToUnknownDocument(o.version);let c=mp(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(Ym(i)),u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(r,e,t):(function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function wi(r,e,t,n){return r instanceof Qt?(function(s,o,c,u){if(!Ks(s.precondition,o))return c;let h=s.value.clone(),f=gp(s.fieldTransforms,u,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(r,e,t,n):r instanceof Je?(function(s,o,c,u){if(!Ks(s.precondition,o))return c;let h=gp(s.fieldTransforms,u,o),f=o.data;return f.setAll(Ym(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),c===null?null:c.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))})(r,e,t,n):(function(s,o,c){return Ks(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c})(r,e,t)}function qw(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=Wm(n.transform,i||null);s!=null&&(t===null&&(t=Ne.empty()),t.set(n.field,s))}return t||null}function pp(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!(function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&dr(n,i,(s,o)=>Uw(s,o))})(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}var Qt=class extends br{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Je=class extends br{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Ym(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function mp(r,e,t){let n=new Map;U(r.length===t.length,32656,{Re:t.length,Ve:r.length});for(let i=0;i<t.length;i++){let s=r[i],o=s.transform,c=e.data.field(s.field);n.set(s.field,Fw(o,c,t[i]))}return n}function gp(r,e,t){let n=new Map;for(let i of r){let s=i.transform,o=t.data.field(i.field);n.set(i.field,Mw(s,o,e))}return n}var On=class extends br{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ho=class extends br{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var xi=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&Bw(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=wi(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=wi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=Gm();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,c=this.applyToLocalView(o,s.mutatedFields);c=t.has(i.key)?null:c;let u=Jm(o,c);u!==null&&n.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(q.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),H())}isEqual(e){return this.batchId===e.batchId&&dr(this.mutations,e.mutations,(t,n)=>pp(t,n))&&dr(this.baseMutations,e.baseMutations,(t,n)=>pp(t,n))}},Su=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){U(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=(function(){return Vw})(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new r(e,t,n,i)}};var Li=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ru=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var fe,X;function zw(r){switch(r){case C.OK:return M(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return M(15467,{code:r})}}function Xm(r){if(r===void 0)return de("GRPC error has no .code"),C.UNKNOWN;switch(r){case fe.OK:return C.OK;case fe.CANCELLED:return C.CANCELLED;case fe.UNKNOWN:return C.UNKNOWN;case fe.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case fe.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case fe.INTERNAL:return C.INTERNAL;case fe.UNAVAILABLE:return C.UNAVAILABLE;case fe.UNAUTHENTICATED:return C.UNAUTHENTICATED;case fe.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case fe.NOT_FOUND:return C.NOT_FOUND;case fe.ALREADY_EXISTS:return C.ALREADY_EXISTS;case fe.PERMISSION_DENIED:return C.PERMISSION_DENIED;case fe.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case fe.ABORTED:return C.ABORTED;case fe.OUT_OF_RANGE:return C.OUT_OF_RANGE;case fe.UNIMPLEMENTED:return C.UNIMPLEMENTED;case fe.DATA_LOSS:return C.DATA_LOSS;default:return M(39323,{code:r})}}(X=fe||(fe={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";var jw=null;function Gw(){return new TextEncoder}var $w=new ft([4294967295,4294967295],0);function _p(r){let e=Gw().encode(r),t=new Oc;return t.update(e),new Uint8Array(t.digest())}function yp(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ft([t,n],0),new ft([i,s],0)]}var Pu=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Tn(`Invalid padding: ${t}`);if(n<0)throw new Tn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Tn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Tn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=ft.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(ft.fromNumber(n)));return i.compare($w)===1&&(i=new ft([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;let t=_p(e),[n,i]=yp(t);for(let s=0;s<this.hashCount;s++){let o=this.ye(n,i,s);if(!this.we(o))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new r(s,i,t);return n.forEach(c=>o.insert(c)),o}insert(e){if(this.ge===0)return;let t=_p(e),[n,i]=yp(t);for(let s=0;s<this.hashCount;s++){let o=this.ye(n,i,s);this.Se(o)}}Se(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},Tn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Mi=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,Fi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(q.min(),i,new ae(G),qe(),H())}},Fi=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,H(),H(),H())}};var lr=class{constructor(e,t,n,i){this.be=e,this.removedTargetIds=t,this.key=n,this.De=i}},fo=class{constructor(e,t){this.targetId=e,this.Ce=t}},po=class{constructor(e,t,n=ge.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},mo=class{constructor(){this.ve=0,this.Fe=Ip(),this.Me=ge.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=H(),t=H(),n=H();return this.Fe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:M(38017,{changeType:s})}}),new Fi(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=Ip()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,U(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}},Cu=class{constructor(e){this.Ge=e,this.ze=new Map,this.je=qe(),this.Je=Ms(),this.He=Ms(),this.Ye=new ae(G)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:M(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((n,i)=>{this.rt(i)&&t(i)})}st(e){let t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){let s=i.target;if(co(s))if(n===0){let o=new L(s.path);this.et(t,o,Ae.newNoDocument(o,q.min()))}else U(n===1,20013,{expectedCount:n});else{let o=this._t(t);if(o!==n){let c=this.ut(e),u=c?this.ct(c,e,o):1;if(u!==0){this.it(t);let h=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,h)}jw?.lt((function(f,m,y,P,k){let O={localCacheCount:f,existenceFilterCount:m.count,databaseId:y.database,projectId:y.projectId},N=m.unchangedNames;return N&&(O.bloomFilter={applied:k===0,hashCount:N?.hashCount??0,bitmapLength:N?.bits?.bitmap?.length??0,padding:N?.bits?.padding??0,mightContain:$=>P?.mightContain($)??!1}),O})(o,e.Ce,this.Ge.ht(),c,u))}}}}ut(e){let t=e.Ce.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,o,c;try{o=_t(n).toUint8Array()}catch(u){if(u instanceof io)return vi("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Pu(o,i,s)}catch(u){return vi(u instanceof Tn?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.ge===0?null:c}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let o=this.Ge.ht(),c=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(c)||(this.et(t,s,null),i++)}),i}Tt(e){let t=new Map;this.ze.forEach((s,o)=>{let c=this.ot(o);if(c){if(s.current&&co(c.target)){let u=new L(c.target.path);this.It(u).has(o)||this.Et(o,u)||this.et(o,u,Ae.newNoDocument(u,e))}s.Be&&(t.set(o,s.ke()),s.qe())}});let n=H();this.He.forEach((s,o)=>{let c=!0;o.forEachWhile(u=>{let h=this.ot(u);return!h||h.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(s))}),this.je.forEach((s,o)=>o.setReadTime(e));let i=new Mi(e,t,this.Ye,this.je,n);return this.je=qe(),this.Je=Ms(),this.He=Ms(),this.Ye=new ae(G),i}Xe(e,t){if(!this.rt(e))return;let n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new mo,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new re(G),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new re(G),this.Je=this.Je.insert(e,t)),t}rt(e){let t=this.ot(e)!==null;return t||D("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new mo),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}};function Ms(){return new ae(L.comparator)}function Ip(){return new ae(L.comparator)}var Ww={asc:"ASCENDING",desc:"DESCENDING"},Kw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Hw={and:"AND",or:"OR"},Du=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Nu(r,e){return r.useProto3Json||ea(e)?e:{value:e}}function Sr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Zm(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function Qw(r,e){return Sr(r,e.toTimestamp())}function ke(r){return U(!!r,49232),q.fromTimestamp((function(t){let n=gt(t);return new se(n.seconds,n.nanos)})(r))}function uh(r,e){return ku(r,e).canonicalString()}function ku(r,e){let t=(function(i){return new ee(["projects",i.projectId,"databases",i.database])})(r).child("documents");return e===void 0?t:t.child(e)}function eg(r){let e=ee.fromString(r);return U(ug(e),10190,{key:e.toString()}),e}function go(r,e){return uh(r.databaseId,e.path)}function Rn(r,e){let t=eg(e);if(t.get(1)!==r.databaseId.projectId)throw new V(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new V(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new L(rg(t))}function tg(r,e){return uh(r.databaseId,e)}function ng(r){let e=eg(r);return e.length===4?ee.emptyPath():rg(e)}function Vu(r){return new ee(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function rg(r){return U(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function wp(r,e,t){return{name:go(r,e),fields:t.value.mapValue.fields}}function Jw(r,e,t){let n=Rn(r,e.name),i=ke(e.updateTime),s=e.createTime?ke(e.createTime):q.min(),o=new Ne({mapValue:{fields:e.fields}}),c=Ae.newFoundDocument(n,i,s,o);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function Yw(r,e){let t;if("targetChange"in e){e.targetChange;let n=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:M(39313,{state:h})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(h,f){return h.useProto3Json?(U(f===void 0||typeof f=="string",58123),ge.fromBase64String(f||"")):(U(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),ge.fromUint8Array(f||new Uint8Array))})(r,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&(function(h){let f=h.code===void 0?C.UNKNOWN:Xm(h.code);return new V(f,h.message||"")})(o);t=new po(n,i,s,c||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=Rn(r,n.document.name),s=ke(n.document.updateTime),o=n.document.createTime?ke(n.document.createTime):q.min(),c=new Ne({mapValue:{fields:n.document.fields}}),u=Ae.newFoundDocument(i,s,o,c),h=n.targetIds||[],f=n.removedTargetIds||[];t=new lr(h,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=Rn(r,n.document),s=n.readTime?ke(n.readTime):q.min(),o=Ae.newNoDocument(i,s),c=n.removedTargetIds||[];t=new lr([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=Rn(r,n.document),s=n.removedTargetIds||[];t=new lr([],s,i,null)}else{if(!("filter"in e))return M(11601,{Rt:e});{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,o=new Ru(i,s),c=n.targetId;t=new fo(c,o)}}return t}function _o(r,e){let t;if(e instanceof Qt)t={update:wp(r,e.key,e.value)};else if(e instanceof On)t={delete:go(r,e.key)};else if(e instanceof Je)t={update:wp(r,e.key,e.data),updateMask:rE(e.fieldMask)};else{if(!(e instanceof ho))return M(16599,{Vt:e.type});t={verify:go(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>(function(s,o){let c=o.transform;if(c instanceof Wt)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Kt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Ht)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Vn)return{fieldPath:o.field.canonicalString(),increment:c.Ae};throw M(20930,{transform:o.transform})})(0,n))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:Qw(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:M(27497)})(r,e.precondition)),t}function Ou(r,e){let t=e.currentDocument?(function(s){return s.updateTime!==void 0?Re.updateTime(ke(s.updateTime)):s.exists!==void 0?Re.exists(s.exists):Re.none()})(e.currentDocument):Re.none(),n=e.updateTransforms?e.updateTransforms.map(i=>(function(o,c){let u=null;if("setToServerValue"in c)U(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),u=new Wt;else if("appendMissingElements"in c){let f=c.appendMissingElements.values||[];u=new Kt(f)}else if("removeAllFromArray"in c){let f=c.removeAllFromArray.values||[];u=new Ht(f)}else"increment"in c?u=new Vn(o,c.increment):M(16584,{proto:c});let h=ye.fromServerFormat(c.fieldPath);return new lo(h,u)})(r,i)):[];if(e.update){e.update.name;let i=Rn(r,e.update.name),s=new Ne({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=(function(u){let h=u.fieldPaths||[];return new Be(h.map(f=>ye.fromServerFormat(f)))})(e.updateMask);return new Je(i,s,o,t,n)}return new Qt(i,s,t,n)}if(e.delete){let i=Rn(r,e.delete);return new On(i,t)}if(e.verify){let i=Rn(r,e.verify);return new ho(i,t)}return M(1463,{proto:e})}function Xw(r,e){return r&&r.length>0?(U(e!==void 0,14353),r.map(t=>(function(i,s){let o=i.updateTime?ke(i.updateTime):ke(s);return o.isEqual(q.min())&&(o=ke(s)),new bu(o,i.transformResults||[])})(t,e))):[]}function ig(r,e){return{documents:[tg(r,e.path)]}}function sg(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=tg(r,i);let s=(function(h){if(h.length!==0)return cg(te.create(h,"and"))})(e.filters);s&&(t.structuredQuery.where=s);let o=(function(h){if(h.length!==0)return h.map(f=>(function(y){return{field:sr(y.field),direction:eE(y.dir)}})(f))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);let c=Nu(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(e.endAt)),{ft:t,parent:i}}function og(r){let e=ng(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){U(n===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=(function(m){let y=ag(m);return y instanceof te&&oh(y)?y.getFilters():[y]})(t.where));let o=[];t.orderBy&&(o=(function(m){return m.map(y=>(function(k){return new Nn(or(k.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(y))})(t.orderBy));let c=null;t.limit&&(c=(function(m){let y;return y=typeof m=="object"?m.value:m,ea(y)?null:y})(t.limit));let u=null;t.startAt&&(u=(function(m){let y=!!m.before,P=m.values||[];return new Gt(P,y)})(t.startAt));let h=null;return t.endAt&&(h=(function(m){let y=!m.before,P=m.values||[];return new Gt(P,y)})(t.endAt)),Mm(e,i,o,s,c,"F",u,h)}function Zw(r,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ag(r){return r.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=or(t.unaryFilter.field);return J.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=or(t.unaryFilter.field);return J.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=or(t.unaryFilter.field);return J.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=or(t.unaryFilter.field);return J.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}})(r):r.fieldFilter!==void 0?(function(t){return J.create(or(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(t){return te.create(t.compositeFilter.filters.map(n=>ag(n)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}})(t.compositeFilter.op))})(r):M(30097,{filter:r})}function eE(r){return Ww[r]}function tE(r){return Kw[r]}function nE(r){return Hw[r]}function sr(r){return{fieldPath:r.canonicalString()}}function or(r){return ye.fromServerFormat(r.fieldPath)}function cg(r){return r instanceof J?(function(t){if(t.op==="=="){if(sp(t.value))return{unaryFilter:{field:sr(t.field),op:"IS_NAN"}};if(ip(t.value))return{unaryFilter:{field:sr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(sp(t.value))return{unaryFilter:{field:sr(t.field),op:"IS_NOT_NAN"}};if(ip(t.value))return{unaryFilter:{field:sr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sr(t.field),op:tE(t.op),value:t.value}}})(r):r instanceof te?(function(t){let n=t.getFilters().map(i=>cg(i));return n.length===1?n[0]:{compositeFilter:{op:nE(t.op),filters:n}}})(r):M(54877,{filter:r})}function rE(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ug(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var Rr=class r{constructor(e,t,n,i,s=q.min(),o=q.min(),c=ge.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var yo=class{constructor(e){this.yt=e}};function iE(r,e){let t;if(e.document)t=Jw(r.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=L.fromSegments(e.noDocument.path),i=Ln(e.noDocument.readTime);t=Ae.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return M(56709);{let n=L.fromSegments(e.unknownDocument.path),i=Ln(e.unknownDocument.version);t=Ae.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime((function(i){let s=new se(i[0],i[1]);return q.fromTimestamp(s)})(e.readTime)),t}function Ep(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Io(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=(function(s,o){return{name:go(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Sr(s,o.version.toTimestamp()),createTime:Sr(s,o.createTime.toTimestamp())}})(r.yt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:xn(e.version)};else{if(!e.isUnknownDocument())return M(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:xn(e.version)}}return n}function Io(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function xn(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ln(r){let e=new se(r.seconds,r.nanoseconds);return q.fromTimestamp(e)}function yn(r,e){let t=(e.baseMutations||[]).map(s=>Ou(r.yt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let c=e.mutations[s+1];o.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>Ou(r.yt,s)),i=se.fromMillis(e.localWriteTimeMs);return new xi(e.batchId,i,t,n)}function fi(r){let e=Ln(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?Ln(r.lastLimboFreeSnapshotVersion):q.min(),n;return n=(function(s){return s.documents!==void 0})(r.query)?(function(s){let o=s.documents.length;return U(o===1,1966,{count:o}),je(Yi(ng(s.documents[0])))})(r.query):(function(s){return je(og(s))})(r.query),new Rr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,ge.fromBase64String(r.resumeToken))}function lg(r,e){let t=xn(e.snapshotVersion),n=xn(e.lastLimboFreeSnapshotVersion),i;i=co(e.target)?ig(r.yt,e.target):sg(r.yt,e.target).ft;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:kn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function hg(r){let e=og({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Au(e,e.limit,"L"):e}function qc(r,e){return new Li(e.largestBatchId,Ou(r.yt,e.overlayMutation))}function Tp(r,e){let t=e.path.lastSegment();return[r,Pe(e.path.popLast()),t]}function vp(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:xn(n.readTime),documentKey:Pe(n.documentKey.path),largestBatchId:n.largestBatchId}}var xu=class{getBundleMetadata(e,t){return Ap(e).get(t).next(n=>{if(n)return(function(s){return{id:s.bundleId,createTime:Ln(s.createTime),version:s.version}})(n)})}saveBundleMetadata(e,t){return Ap(e).put((function(i){return{bundleId:i.id,createTime:xn(ke(i.createTime)),version:i.version}})(t))}getNamedQuery(e,t){return bp(e).get(t).next(n=>{if(n)return(function(s){return{name:s.name,query:hg(s.bundledQuery),readTime:Ln(s.readTime)}})(n)})}saveNamedQuery(e,t){return bp(e).put((function(i){return{name:i.name,readTime:xn(ke(i.readTime)),bundledQuery:i.bundledQuery}})(t))}};function Ap(r){return we(r,ta)}function bp(r){return we(r,na)}var wo=class r{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return ci(e).get(Tp(this.userId,t)).next(n=>n?qc(this.serializer,n):null)}getOverlays(e,t){let n=ot();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,o)=>{let c=new Li(t,o);i.push(this.St(e,c))}),S.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(o=>i.add(Pe(o.getCollectionPath())));let s=[];return i.forEach(o=>{let c=IDBKeyRange.bound([this.userId,o,n],[this.userId,o,n+1],!1,!0);s.push(ci(e).Z(uu,c))}),S.waitFor(s)}getOverlaysForCollection(e,t,n){let i=ot(),s=Pe(t),o=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ci(e).J(uu,o).next(c=>{for(let u of c){let h=qc(this.serializer,u);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=ot(),o,c=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ci(e).ee({index:ym,range:c},(u,h,f)=>{let m=qc(this.serializer,h);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):f.done()}).next(()=>s)}St(e,t){return ci(e).put((function(i,s,o){let[c,u,h]=Tp(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_o(i.yt,o.mutation)}})(this.serializer,this.userId,t))}};function ci(r){return we(r,ra)}var Lu=class{bt(e){return we(e,th)}getSessionToken(e){return this.bt(e).get("sessionToken").next(t=>{let n=t?.value;return n?ge.fromUint8Array(n):ge.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}};var mt=class{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(ce(e.integerValue));else if("doubleValue"in e){let n=ce(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),Si(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),typeof n=="string"&&(n=gt(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(_t(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?Cm(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):sa(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):M(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};this.Ft(t,55);for(let i of Object.keys(n))this.Ot(i,t),this.Ct(n[i],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let i=Er,s=n[i].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(ce(s)),this.Ot(i,t),this.Ct(n[i],t)}Qt(e,t){let n=e.values||[];this.Ft(t,50);for(let i of n)this.Ct(i,t)}Lt(e,t){this.Ft(t,37),L.fromName(e).path.forEach(n=>{this.Ft(t,60),this.Ut(n,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}};mt.Kt=new mt;var Zn=255;function sE(r){if(r===0)return 8;let e=0;return r>>4||(e+=4,r<<=4),r>>6||(e+=2,r<<=2),r>>7||(e+=1),e}function Sp(r){let e=64-(function(n){let i=0;for(let s=0;s<8;++s){let o=sE(255&n[s]);if(i+=o,o!==8)break}return i})(r);return Math.ceil(e/8)}var Mu=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Gt(n.value),n=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Ht()}Yt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{let i=t.codePointAt(0);this.Gt(240|i>>>18),this.Gt(128|63&i>>>12),this.Gt(128|63&i>>>6),this.Gt(128|63&i)}}this.zt()}Zt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{let i=t.codePointAt(0);this.Jt(240|i>>>18),this.Jt(128|63&i>>>12),this.Jt(128|63&i>>>6),this.Jt(128|63&i)}}this.Ht()}Xt(e){let t=this.en(e),n=Sp(t);this.tn(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}nn(e){let t=this.en(e),n=Sp(t);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}rn(){this.sn(Zn),this.sn(255)}_n(){this.an(Zn),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t=(function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)})(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Gt(e){let t=255&e;t===0?(this.sn(0),this.sn(255)):t===Zn?(this.sn(Zn),this.sn(0)):this.sn(t)}Jt(e){let t=255&e;t===0?(this.an(0),this.an(255)):t===Zn?(this.an(Zn),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Fu=class{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}},Uu=class{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}},In=class{constructor(){this.cn=new Mu,this.ln=new Fu(this.cn),this.hn=new Uu(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}};var wn=class r{constructor(e,t,n,i){this.Tn=e,this.In=t,this.En=n,this.dn=i}An(){let e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new r(this.Tn,this.In,this.En,n)}Rn(e,t,n){return{indexId:this.Tn,uid:e,arrayValue:Hs(this.En),directionalValue:Hs(this.dn),orderedDocumentKey:Hs(t),documentKey:n.path.toArray()}}Vn(e,t,n){let i=this.Rn(e,t,n);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function Vt(r,e){let t=r.Tn-e.Tn;return t!==0?t:(t=Rp(r.En,e.En),t!==0?t:(t=Rp(r.dn,e.dn),t!==0?t:L.comparator(r.In,e.In)))}function Rp(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}function Hs(r){return _c()?(function(t){let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n})(r):r}function Pp(r){return typeof r!="string"?r:(function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n})(r)}var Eo=class{constructor(e){this.mn=new re((t,n)=>ye.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(let t of e.filters){let n=t;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(e){if(U(e.collectionGroup===this.collectionId,49279),this.pn)return!1;let t=nu(e);if(t!==void 0&&!this.wn(t))return!1;let n=mn(e),i=new Set,s=0,o=0;for(;s<n.length&&this.wn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.mn.size>0){let c=this.mn.getIterator().getNext();if(!i.has(c.field.canonicalString())){let u=n[s];if(!this.Sn(c,u)||!this.bn(this.fn[o++],u))return!1}++s}for(;s<n.length;++s){let c=n[s];if(o>=this.fn.length||!this.bn(this.fn[o++],c))return!1}return!0}Dn(){if(this.pn)return null;let e=new re(ye.comparator),t=[];for(let n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new ur(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ur(n.field,0))}for(let n of this.fn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ur(n.field,n.dir==="asc"?0:1)));return new pr(pr.UNKNOWN_ID,this.collectionId,t,bi.empty())}wn(e){for(let t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function dg(r){if(U(r instanceof J||r instanceof te,20012),r instanceof J){if(r instanceof ao){let t=r.value.arrayValue?.values?.map(n=>J.create(r.field,"==",n))||[];return te.create(t,"or")}return r}let e=r.filters.map(t=>dg(t));return te.create(e,r.op)}function oE(r){if(r.getFilters().length===0)return[];let e=zu(dg(r));return U(fg(e),7391),Bu(e)||qu(e)?[e]:e.getFilters()}function Bu(r){return r instanceof J}function qu(r){return r instanceof te&&oh(r)}function fg(r){return Bu(r)||qu(r)||(function(t){if(t instanceof te&&fu(t)){for(let n of t.getFilters())if(!Bu(n)&&!qu(n))return!1;return!0}return!1})(r)}function zu(r){if(U(r instanceof J||r instanceof te,34018),r instanceof J)return r;if(r.filters.length===1)return zu(r.filters[0]);let e=r.filters.map(n=>zu(n)),t=te.create(e,r.op);return t=To(t),fg(t)?t:(U(t instanceof te,64498),U(vr(t),40251),U(t.filters.length>1,57927),t.filters.reduce((n,i)=>lh(n,i)))}function lh(r,e){let t;return U(r instanceof J||r instanceof te,38388),U(e instanceof J||e instanceof te,25473),t=r instanceof J?e instanceof J?(function(i,s){return te.create([i,s],"and")})(r,e):Cp(r,e):e instanceof J?Cp(e,r):(function(i,s){if(U(i.filters.length>0&&s.filters.length>0,48005),vr(i)&&vr(s))return Om(i,s.getFilters());let o=fu(i)?i:s,c=fu(i)?s:i,u=o.filters.map(h=>lh(h,c));return te.create(u,"or")})(r,e),To(t)}function Cp(r,e){if(vr(e))return Om(e,r.getFilters());{let t=e.filters.map(n=>lh(r,n));return te.create(t,"or")}}function To(r){if(U(r instanceof J||r instanceof te,11850),r instanceof J)return r;let e=r.getFilters();if(e.length===1)return To(e[0]);if(km(r))return r;let t=e.map(i=>To(i)),n=[];return t.forEach(i=>{i instanceof J?n.push(i):i instanceof te&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:te.create(n,r.op)}var ju=class{constructor(){this.Cn=new Ui}addToCollectionParentIndex(e,t){return this.Cn.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(We.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(We.min())}updateCollectionGroup(e,t,n){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}},Ui=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new re(ee.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new re(ee.comparator)).toArray()}};var Dp="IndexedDbIndexManager",Fs=new Uint8Array(0),Gu=class{constructor(e,t){this.databaseId=t,this.vn=new Ui,this.Fn=new Qe(n=>kn(n),(n,i)=>Ji(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let s={collectionId:n,parent:Pe(i)};return Np(e).put(s)}return S.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[sm(t),""],!1,!0);return Np(e).J(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;n.push(st(o.parent))}return n})}addFieldIndex(e,t){let n=ui(e),i=(function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}})(t);delete i.indexId;let s=n.add(i);if(t.indexState){let o=tr(e);return s.next(c=>{o.put(vp(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=ui(e),i=tr(e),s=er(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ui(e),n=er(e),i=tr(e);return t.Z().next(()=>n.Z()).next(()=>i.Z())}createTargetIndexes(e,t){return S.forEach(this.Mn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new Eo(n).Dn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=er(e),i=!0,s=new Map;return S.forEach(this.Mn(t),o=>this.xn(e,o).next(c=>{i&&(i=!!c),s.set(o,c)})).next(()=>{if(i){let o=H(),c=[];return S.forEach(s,(u,h)=>{D(Dp,`Using index ${(function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(ne=>`${ne.fieldPath}:${ne.kind}`).join(",")}`})(u)} to execute ${kn(t)}`);let f=(function(B,ne){let Z=nu(ne);if(Z===void 0)return null;for(let Y of uo(B,Z.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null})(h,u),m=(function(B,ne){let Z=new Map;for(let Y of mn(ne))for(let E of uo(B,Y.fieldPath))switch(E.op){case"==":case"in":Z.set(Y.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return Z.set(Y.fieldPath.canonicalString(),E.value),Array.from(Z.values())}return null})(h,u),y=(function(B,ne){let Z=[],Y=!0;for(let E of mn(ne)){let _=E.kind===0?lp(B,E.fieldPath,B.startAt):hp(B,E.fieldPath,B.startAt);Z.push(_.value),Y&&(Y=_.inclusive)}return new Gt(Z,Y)})(h,u),P=(function(B,ne){let Z=[],Y=!0;for(let E of mn(ne)){let _=E.kind===0?hp(B,E.fieldPath,B.endAt):lp(B,E.fieldPath,B.endAt);Z.push(_.value),Y&&(Y=_.inclusive)}return new Gt(Z,Y)})(h,u),k=this.On(u,h,y),O=this.On(u,h,P),N=this.Nn(u,h,m),$=this.Bn(u.indexId,f,k,y.inclusive,O,P.inclusive,N);return S.forEach($,z=>n.Y(z,t.limit).next(B=>{B.forEach(ne=>{let Z=L.fromSegments(ne.documentKey);o.has(Z)||(o=o.add(Z),c.push(Z))})}))}).next(()=>c)}return S.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(e.filters.length===0?t=[e]:t=oE(te.create(e.filters,"and")).map(n=>Tu(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,n,i,s,o,c){let u=(t!=null?t.length:1)*Math.max(n.length,s.length),h=u/(t!=null?t.length:1),f=[];for(let m=0;m<u;++m){let y=t?this.Ln(t[m/h]):Fs,P=this.kn(e,y,n[m%h],i),k=this.qn(e,y,s[m%h],o),O=c.map(N=>this.kn(e,y,N,!0));f.push(...this.createRange(P,k,O))}return f}kn(e,t,n,i){let s=new wn(e,L.empty(),t,n);return i?s:s.An()}qn(e,t,n,i){let s=new wn(e,L.empty(),t,n);return i?s.An():s}xn(e,t){let n=new Eo(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let c of s)n.yn(c)&&(!o||c.fields.length>o.fields.length)&&(o=c);return o})}getIndexType(e,t){let n=2,i=this.Mn(t);return S.forEach(i,s=>this.xn(e,s).next(o=>{o?n!==0&&o.fields.length<(function(u){let h=new re(ye.comparator),f=!1;for(let m of u.filters)for(let y of m.getFlattenedFilters())y.field.isKeyField()||(y.op==="array-contains"||y.op==="array-contains-any"?f=!0:h=h.add(y.field));for(let m of u.orderBy)m.field.isKeyField()||(h=h.add(m.field));return h.size+(f?1:0)})(s)&&(n=1):n=0})).next(()=>(function(o){return o.limit!==null})(t)&&i.length>1&&n===2?1:n)}Qn(e,t){let n=new In;for(let i of mn(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=n.Pn(i.kind);mt.Kt.Dt(s,o)}return n.un()}Ln(e){let t=new In;return mt.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){let n=new In;return mt.Kt.Dt(Vi(this.databaseId,t),n.Pn((function(s){let o=mn(s);return o.length===0?0:o[o.length-1].kind})(e))),n.un()}Nn(e,t,n){if(n===null)return[];let i=[];i.push(new In);let s=0;for(let o of mn(e)){let c=n[s++];for(let u of i)if(this.Un(t,o.fieldPath)&&Oi(c))i=this.Kn(i,o,c);else{let h=u.Pn(o.kind);mt.Kt.Dt(c,h)}}return this.Wn(i)}On(e,t,n){return this.Nn(e,t,n.position)}Wn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].un();return t}Kn(e,t,n){let i=[...e],s=[];for(let o of n.arrayValue.values||[])for(let c of i){let u=new In;u.seed(c.un()),mt.Kt.Dt(o,u.Pn(t.kind)),s.push(u)}return s}Un(e,t){return!!e.filters.find(n=>n instanceof J&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=ui(e),i=tr(e);return(t?n.J(cu,IDBKeyRange.bound(t,t)):n.J()).next(s=>{let o=[];return S.forEach(s,c=>i.get([c.indexId,this.uid]).next(u=>{o.push((function(f,m){let y=m?new bi(m.sequenceNumber,new We(Ln(m.readTime),new L(st(m.documentKey)),m.largestBatchId)):bi.empty(),P=f.fields.map(([k,O])=>new ur(ye.fromServerFormat(k),O));return new pr(f.indexId,f.collectionGroup,P,y)})(c,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:G(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=ui(e),s=tr(e);return this.Gn(e).next(o=>i.J(cu,IDBKeyRange.bound(t,t)).next(c=>S.forEach(c,u=>s.put(vp(u.indexId,this.uid,o,n)))))}updateIndexEntries(e,t){let n=new Map;return S.forEach(t,(i,s)=>{let o=n.get(i.collectionGroup);return(o?S.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(c=>(n.set(i.collectionGroup,c),S.forEach(c,u=>this.zn(e,i,u).next(h=>{let f=this.jn(s,u);return h.isEqual(f)?S.resolve():this.Jn(e,s,u,h,f)}))))})}Hn(e,t,n,i){return er(e).put(i.Rn(this.uid,this.$n(n,t.key),t.key))}Yn(e,t,n,i){return er(e).delete(i.Vn(this.uid,this.$n(n,t.key),t.key))}zn(e,t,n){let i=er(e),s=new re(Vt);return i.ee({index:_m,range:IDBKeyRange.only([n.indexId,this.uid,Hs(this.$n(n,t))])},(o,c)=>{s=s.add(new wn(n.indexId,t,Pp(c.arrayValue),Pp(c.directionalValue)))}).next(()=>s)}jn(e,t){let n=new re(Vt),i=this.Qn(t,e);if(i==null)return n;let s=nu(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Oi(o))for(let c of o.arrayValue.values||[])n=n.add(new wn(t.indexId,e.key,this.Ln(c),i))}else n=n.add(new wn(t.indexId,e.key,Fs,i));return n}Jn(e,t,n,i,s){D(Dp,"Updating index entries for document '%s'",t.key);let o=[];return(function(u,h,f,m,y){let P=u.getIterator(),k=h.getIterator(),O=Xn(P),N=Xn(k);for(;O||N;){let $=!1,z=!1;if(O&&N){let B=f(O,N);B<0?z=!0:B>0&&($=!0)}else O!=null?z=!0:$=!0;$?(m(N),N=Xn(k)):z?(y(O),O=Xn(P)):(O=Xn(P),N=Xn(k))}})(i,s,Vt,c=>{o.push(this.Hn(e,t,n,c))},c=>{o.push(this.Yn(e,t,n,c))}),S.waitFor(o)}Gn(e){let t=1;return tr(e).ee({index:gm,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((o,c)=>Vt(o,c)).filter((o,c,u)=>!c||Vt(o,u[c-1])!==0);let i=[];i.push(e);for(let o of n){let c=Vt(o,e),u=Vt(o,t);if(c===0)i[0]=e.An();else if(c>0&&u<0)i.push(o),i.push(o.An());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Zn(i[o],i[o+1]))return[];let c=i[o].Vn(this.uid,Fs,L.empty()),u=i[o+1].Vn(this.uid,Fs,L.empty());s.push(IDBKeyRange.bound(c,u))}return s}Zn(e,t){return Vt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(kp)}getMinOffset(e,t){return S.mapArray(this.Mn(t),n=>this.xn(e,n).next(i=>i||M(44426))).next(kp)}};function Np(r){return we(r,Ci)}function er(r){return we(r,gi)}function ui(r){return we(r,eh)}function tr(r){return we(r,mi)}function kp(r){U(r.length!==0,28825);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;Yl(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new We(e.readTime,e.documentKey,t)}var Vp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},pg=41943040,Oe=class r{static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}};function mg(r,e,t){let n=r.store(He),i=r.store(gr),s=[],o=IDBKeyRange.only(t.batchId),c=0,u=n.ee({range:o},(f,m,y)=>(c++,y.delete()));s.push(u.next(()=>{U(c===1,47070,{batchId:t.batchId})}));let h=[];for(let f of t.mutations){let m=fm(e,f.key.path,t.batchId);s.push(i.delete(m)),h.push(f.key)}return S.waitFor(s).next(()=>h)}function vo(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw M(14731);e=r.noDocument}return JSON.stringify(e).length}Oe.DEFAULT_COLLECTION_PERCENTILE=10,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Oe.DEFAULT=new Oe(pg,Oe.DEFAULT_COLLECTION_PERCENTILE,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Oe.DISABLED=new Oe(-1,0,0);var Ao=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Xn={}}static wt(e,t,n,i){U(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ot(e).ee({index:En,range:n},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=ar(e),o=Ot(e);return o.add({}).next(c=>{U(typeof c=="number",49019);let u=new xi(c,t,n,i),h=(function(P,k,O){let N=O.baseMutations.map(z=>_o(P.yt,z)),$=O.mutations.map(z=>_o(P.yt,z));return{userId:k,batchId:O.batchId,localWriteTimeMs:O.localWriteTime.toMillis(),baseMutations:N,mutations:$}})(this.serializer,this.userId,u),f=[],m=new re((y,P)=>G(y.canonicalString(),P.canonicalString()));for(let y of i){let P=fm(this.userId,y.key.path,c);m=m.add(y.key.path.popLast()),f.push(o.put(h)),f.push(s.put(P,nw))}return m.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.Xn[c]=u.keys()}),S.waitFor(f).next(()=>u)})}lookupMutationBatch(e,t){return Ot(e).get(t).next(n=>n?(U(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),yn(this.serializer,n)):null)}er(e,t){return this.Xn[t]?S.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.Xn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Ot(e).ee({index:En,range:i},(o,c,u)=>{c.userId===this.userId&&(U(c.batchId>=n,47524,{tr:n}),s=yn(this.serializer,c)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=bn;return Ot(e).ee({index:En,range:t,reverse:!0},(i,s,o)=>{n=s.batchId,o.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,bn],[this.userId,Number.POSITIVE_INFINITY]);return Ot(e).J(En,t).next(n=>n.map(i=>yn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=zs(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return ar(e).ee({range:i},(o,c,u)=>{let[h,f,m]=o,y=st(f);if(h===this.userId&&t.path.isEqual(y))return Ot(e).get(m).next(P=>{if(!P)throw M(61480,{nr:o,batchId:m});U(P.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:P.userId,batchId:m}),s.push(yn(this.serializer,P))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new re(G),i=[];return t.forEach(s=>{let o=zs(this.userId,s.path),c=IDBKeyRange.lowerBound(o),u=ar(e).ee({range:c},(h,f,m)=>{let[y,P,k]=h,O=st(P);y===this.userId&&s.path.isEqual(O)?n=n.add(k):m.done()});i.push(u)}),S.waitFor(i).next(()=>this.rr(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=zs(this.userId,n),o=IDBKeyRange.lowerBound(s),c=new re(G);return ar(e).ee({range:o},(u,h,f)=>{let[m,y,P]=u,k=st(y);m===this.userId&&n.isPrefixOf(k)?k.length===i&&(c=c.add(P)):f.done()}).next(()=>this.rr(e,c))}rr(e,t){let n=[],i=[];return t.forEach(s=>{i.push(Ot(e).get(s).next(o=>{if(o===null)throw M(35274,{batchId:s});U(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),n.push(yn(this.serializer,o))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return mg(e.le,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return S.resolve();let n=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),i=[];return ar(e).ee({range:n},(s,o,c)=>{if(s[0]===this.userId){let u=st(s[1]);i.push(u)}else c.done()}).next(()=>{U(i.length===0,56720,{sr:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return gg(e,this.userId,t)}_r(e){return _g(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:bn,lastStreamToken:""})}};function gg(r,e,t){let n=zs(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),o=!1;return ar(r).ee({range:s,X:!0},(c,u,h)=>{let[f,m,y]=c;f===e&&m===i&&(o=!0),h.done()}).next(()=>o)}function Ot(r){return we(r,He)}function ar(r){return we(r,gr)}function _g(r){return we(r,Ri)}var Pr=class r{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new r(0)}static cr(){return new r(-1)}};var $u=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{let n=new Pr(t.highestTargetId);return t.highestTargetId=n.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(t=>q.fromTimestamp(new se(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.lr(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.hr(e,i)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(n=>(n.targetCount+=1,this.Tr(t,n),this.hr(e,n))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>nr(e).delete(t.targetId)).next(()=>this.lr(e)).next(n=>(U(n.targetCount>0,8065),n.targetCount-=1,this.hr(e,n)))}removeTargets(e,t,n){let i=0,s=[];return nr(e).ee((o,c)=>{let u=fi(c);u.sequenceNumber<=t&&n.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(e,t){return nr(e).ee((n,i)=>{let s=fi(i);t(s)})}lr(e){return Op(e).get(no).next(t=>(U(t!==null,2888),t))}hr(e,t){return Op(e).put(no,t)}Pr(e,t){return nr(e).put(lg(this.serializer,t))}Tr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.lr(e).next(t=>t.targetCount)}getTargetData(e,t){let n=kn(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return nr(e).ee({range:i,index:mm},(o,c,u)=>{let h=fi(c);Ji(t,h.target)&&(s=h,u.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=Lt(e);return t.forEach(o=>{let c=Pe(o.path);i.push(s.put({targetId:n,path:c})),i.push(this.referenceDelegate.addReference(e,n,o))}),S.waitFor(i)}removeMatchingKeys(e,t,n){let i=Lt(e);return S.forEach(t,s=>{let o=Pe(s.path);return S.waitFor([i.delete([n,o]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Lt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Lt(e),s=H();return i.ee({range:n,X:!0},(o,c,u)=>{let h=st(o[1]),f=new L(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=Pe(t.path),i=IDBKeyRange.bound([n],[sm(n)],!1,!0),s=0;return Lt(e).ee({index:Zl,X:!0,range:i},([o,c],u,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}At(e,t){return nr(e).get(t).next(n=>n?fi(n):null)}};function nr(r){return we(r,_r)}function Op(r){return we(r,Sn)}function Lt(r){return we(r,yr)}var xp="LruGarbageCollector",yg=1048576;function Lp([r,e],[t,n]){let i=G(r,t);return i===0?G(e,n):i}var Wu=class{constructor(e){this.Ir=e,this.buffer=new re(Lp),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();Lp(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},bo=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){D(xp,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){en(t)?D(xp,"Ignoring IndexedDB error during garbage collection: ",t):yield Zt(t)}yield this.Vr(3e5)}))}},Ku=class{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return S.resolve(Ue.ce);let n=new Wu(t);return this.mr.forEachTarget(e,i=>n.Ar(i.sequenceNumber)).next(()=>this.mr.pr(e,i=>n.Ar(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Vp)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Vp):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,s,o,c,u,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(n=m,c=Date.now(),this.removeTargets(e,n,t))).next(m=>(s=m,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(m=>(h=Date.now(),rr()<=Q.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(c-o)+`ms
	Removed ${s} targets in `+(u-c)+`ms
	Removed ${m} documents in `+(h-u)+`ms
Total Duration: ${h-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function Ig(r,e){return new Ku(r,e)}var Hu=class{constructor(e,t){this.db=e,this.garbageCollector=Ig(this,t)}gr(e){let t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}wr(e){let t=0;return this.pr(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(n,i)=>t(i))}addReference(e,t,n){return Us(e,n)}removeReference(e,t,n){return Us(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Us(e,t)}br(e,t){return(function(i,s){let o=!1;return _g(i).te(c=>gg(i,c,s).next(u=>(u&&(o=!0),S.resolve(!u)))).next(()=>o)})(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Sr(e,(o,c)=>{if(c<=t){let u=this.br(e,o).next(h=>{if(!h)return s++,n.getEntry(e,o).next(()=>(n.removeEntry(o,q.min()),Lt(e).delete((function(m){return[0,Pe(m.path)]})(o))))});i.push(u)}}).next(()=>S.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Us(e,t)}Sr(e,t){let n=Lt(e),i,s=Ue.ce;return n.ee({index:Zl},([o,c],{path:u,sequenceNumber:h})=>{o===0?(s!==Ue.ce&&t(new L(st(i)),s),s=h,i=u):s=Ue.ce}).next(()=>{s!==Ue.ce&&t(new L(st(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Us(r,e){return Lt(r).put((function(n,i){return{targetId:0,path:Pe(n.path),sequenceNumber:i}})(e,r.currentSequenceNumber))}var So=class{constructor(){this.changes=new Qe(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ae.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?S.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Qu=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return pn(e).put(n)}removeEntry(e,t,n){return pn(e).delete((function(s,o){let c=s.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Io(o),c[c.length-1]]})(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Dr(e,n)))}getEntry(e,t){let n=Ae.newInvalidDocument(t);return pn(e).ee({index:js,range:IDBKeyRange.only(li(t))},(i,s)=>{n=this.Cr(t,s)}).next(()=>n)}vr(e,t){let n={size:0,document:Ae.newInvalidDocument(t)};return pn(e).ee({index:js,range:IDBKeyRange.only(li(t))},(i,s)=>{n={document:this.Cr(t,s),size:vo(s)}}).next(()=>n)}getEntries(e,t){let n=qe();return this.Fr(e,t,(i,s)=>{let o=this.Cr(i,s);n=n.insert(i,o)}).next(()=>n)}Mr(e,t){let n=qe(),i=new ae(L.comparator);return this.Fr(e,t,(s,o)=>{let c=this.Cr(s,o);n=n.insert(s,c),i=i.insert(s,vo(o))}).next(()=>({documents:n,Or:i}))}Fr(e,t,n){if(t.isEmpty())return S.resolve();let i=new re(Up);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(li(i.first()),li(i.last())),o=i.getIterator(),c=o.getNext();return pn(e).ee({index:js,range:s},(u,h,f)=>{let m=L.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;c&&Up(c,m)<0;)n(c,null),c=o.getNext();c&&c.isEqual(m)&&(n(c,h),c=o.hasNext()?o.getNext():null),c?f.j(li(c)):f.done()}).next(()=>{for(;c;)n(c,null),c=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let o=t.path,c=[o.popLast().toArray(),o.lastSegment(),Io(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return pn(e).J(IDBKeyRange.bound(c,u,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=qe();for(let m of h){let y=this.Cr(L.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);y.isFoundDocument()&&(Xi(t,y)||i.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=qe(),o=Fp(t,n),c=Fp(t,We.max());return pn(e).ee({index:pm,range:IDBKeyRange.bound(o,c,!0)},(u,h,f)=>{let m=this.Cr(L.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(m.key,m),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Ju(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Mp(e).get(au).next(t=>(U(!!t,20021),t))}Dr(e,t){return Mp(e).put(au,t)}Cr(e,t){if(t){let n=iE(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(q.min())))return n}return Ae.newInvalidDocument(e)}};function wg(r){return new Qu(r)}var Ju=class extends So{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Qe(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new re((s,o)=>G(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let c=this.Br.get(s);if(t.push(this.Nr.removeEntry(e,s,c.readTime)),o.isValidDocument()){let u=Ep(this.Nr.serializer,o);i=i.add(s.path.popLast());let h=vo(u);n+=h-c.size,t.push(this.Nr.addEntry(e,s,u))}else if(n-=c.size,this.trackRemovals){let u=Ep(this.Nr.serializer,o.convertToNoDocument(q.min()));t.push(this.Nr.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Nr.updateMetadata(e,n)),S.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(n=>(this.Br.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:n,Or:i})=>(i.forEach((s,o)=>{this.Br.set(s,{size:o,readTime:n.get(s).readTime})}),n))}};function Mp(r){return we(r,Pi)}function pn(r){return we(r,to)}function li(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Fp(r,e){let t=e.documentKey.path.toArray();return[r,Io(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Up(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=G(t[s],n[s]),i)return i;return i=G(t.length,n.length),i||(i=G(t[t.length-2],n[n.length-2]),i||G(t[t.length-1],n[n.length-1]))}var Yu=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Ro=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&wi(n.mutation,i,Be.empty(),se.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,H()).next(()=>n))}getLocalViewOfDocuments(e,t,n=H()){let i=ot();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=di();return s.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let n=ot();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,H()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,c)=>{t.set(o,c)})})}computeViews(e,t,n,i){let s=qe(),o=Ii(),c=(function(){return Ii()})();return t.forEach((u,h)=>{let f=n.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Je)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),wi(f.mutation,h,f.mutation.getFieldMask(),se.now())):o.set(h.key,Be.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((h,f)=>o.set(h,f)),t.forEach((h,f)=>c.set(h,new Yu(f,o.get(h)??null))),c))}recalculateAndSaveOverlays(e,t){let n=Ii(),i=new ae((o,c)=>o-c),s=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let c of o)c.keys().forEach(u=>{let h=t.get(u);if(h===null)return;let f=n.get(u)||Be.empty();f=c.applyToLocalView(h,f),n.set(u,f);let m=(i.get(c.batchId)||H()).add(u);i=i.insert(c.batchId,m)})}).next(()=>{let o=[],c=i.getReverseIterator();for(;c.hasNext();){let u=c.getNext(),h=u.key,f=u.value,m=Gm();f.forEach(y=>{if(!s.has(y)){let P=Jm(t.get(y),n.get(y));P!==null&&m.set(y,P),s=s.add(y)}}),o.push(this.documentOverlayCache.saveOverlays(e,h,m))}return S.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return(function(o){return L.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Fm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):S.resolve(ot()),c=fr,u=s;return o.next(h=>S.forEach(h,(f,m)=>(c<m.largestBatchId&&(c=m.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{u=u.insert(f,y)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,u,h,H())).next(f=>({batchId:c,changes:jm(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(n=>{let i=di();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,o=di();return this.indexManager.getCollectionParents(e,s).next(c=>S.forEach(c,u=>{let h=(function(m,y){return new $t(y,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((m,y)=>{o=o.insert(m,y)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(o=>{s.forEach((u,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,Ae.newInvalidDocument(f)))});let c=di();return o.forEach((u,h)=>{let f=s.get(u);f!==void 0&&wi(f.mutation,h,Be.empty(),se.now()),Xi(t,h)&&(c=c.insert(u,h))}),c})}};var Xu=class{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return S.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:ke(i.createTime)}})(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(i){return{name:i.name,query:hg(i.bundledQuery),readTime:ke(i.readTime)}})(t)),S.resolve()}};var Zu=class{constructor(){this.overlays=new ae(L.comparator),this.qr=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){let n=ot();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.St(e,t,s)}),S.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.qr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.qr.delete(n)),S.resolve()}getOverlaysForCollection(e,t,n){let i=ot(),s=t.length+1,o=new L(t.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){let u=c.getNext().value,h=u.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&u.largestBatchId>n&&i.set(u.getKey(),u)}return S.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new ae((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);f===null&&(f=ot(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let c=ot(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((h,f)=>c.set(h,f)),!(c.size()>=i)););return S.resolve(c)}St(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let o=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new Li(t,n));let s=this.qr.get(t);s===void 0&&(s=H(),this.qr.set(t,s)),this.qr.set(t,s.add(n.key))}};var el=class{constructor(){this.sessionToken=ge.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}};var Bi=class{constructor(){this.Qr=new re(pe.$r),this.Ur=new re(pe.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new pe(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Gr(new pe(e,t))}zr(e,t){e.forEach(n=>this.removeReference(n,t))}jr(e){let t=new L(new ee([])),n=new pe(t,e),i=new pe(t,e+1),s=[];return this.Ur.forEachInRange([n,i],o=>{this.Gr(o),s.push(o.key)}),s}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new L(new ee([])),n=new pe(t,e),i=new pe(t,e+1),s=H();return this.Ur.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new pe(e,0),n=this.Qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},pe=class{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return L.comparator(e.key,t.key)||G(e.Yr,t.Yr)}static Kr(e,t){return G(e.Yr,t.Yr)||L.comparator(e.key,t.key)}};var tl=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new re(pe.$r)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new xi(s,t,n,i);this.mutationQueue.push(o);for(let c of i)this.Zr=this.Zr.add(new pe(c.key,s)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return S.resolve(o)}lookupMutationBatch(e,t){return S.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.ei(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?bn:this.tr-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new pe(t,0),i=new pe(t,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,i],o=>{let c=this.Xr(o.Yr);s.push(c)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new re(G);return t.forEach(i=>{let s=new pe(i,0),o=new pe(i,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([s,o],c=>{n=n.add(c.Yr)})}),S.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;L.isDocumentKey(s)||(s=s.child(""));let o=new pe(new L(s),0),c=new re(G);return this.Zr.forEachWhile(u=>{let h=u.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(c=c.add(u.Yr)),!0)},o),S.resolve(this.ti(c))}ti(e){let t=[];return e.forEach(n=>{let i=this.Xr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){U(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return S.forEach(t.mutations,i=>{let s=new pe(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new pe(t,0),i=this.Zr.firstAfterOrEqual(n);return S.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var nl=class{constructor(e){this.ri=e,this.docs=(function(){return new ae(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return S.resolve(n?n.document.mutableCopy():Ae.newInvalidDocument(t))}getEntries(e,t){let n=qe();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Ae.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=qe(),o=t.path,c=new L(o.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){let{key:h,value:{document:f}}=u.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Yl(um(f),n)<=0||(i.has(f.key)||Xi(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(e,t,n,i){M(9500)}ii(e,t){return S.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new rl(this)}getSize(e){return S.resolve(this.size)}},rl=class extends So{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)}),S.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}};var il=class{constructor(e){this.persistence=e,this.si=new Qe(t=>kn(t),Ji),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.oi=0,this._i=new Bi,this.targetCount=0,this.ai=Pr.ur()}forEachTarget(e,t){return this.si.forEach((n,i)=>t(i)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),S.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new Pr(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.Pr(t),S.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.si.forEach((o,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.si.delete(o),s.push(this.removeMatchingKeysForTargetId(e,c.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return S.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),S.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),S.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),S.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return S.resolve(n)}containsKey(e,t){return S.resolve(this._i.containsKey(t))}};var qi=class{constructor(e,t){this.ui={},this.overlays={},this.ci=new Ue(0),this.li=!1,this.li=!0,this.hi=new el,this.referenceDelegate=e(this),this.Pi=new il(this),this.indexManager=new ju,this.remoteDocumentCache=(function(i){return new nl(i)})(n=>this.referenceDelegate.Ti(n)),this.serializer=new yo(t),this.Ii=new Xu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Zu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new tl(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){D("MemoryPersistence","Starting transaction:",e);let i=new sl(this.ci.next());return this.referenceDelegate.Ei(),n(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ai(e,t){return S.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}},sl=class extends Xs{constructor(e){super(),this.currentSequenceNumber=e}},Po=class r{constructor(e){this.persistence=e,this.Ri=new Bi,this.Vi=null}static mi(e){return new r(e)}get fi(){if(this.Vi)return this.Vi;throw M(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),S.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),S.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(i=>this.fi.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.fi.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.fi,n=>{let i=L.fromPath(n);return this.gi(e,i).next(s=>{s||t.removeEntry(i,q.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(n=>{n?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return S.or([()=>S.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}},Co=class r{constructor(e,t){this.persistence=e,this.pi=new Qe(n=>Pe(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=Ig(this,t)}static mi(e,t){return new r(e,t)}Ei(){}di(e){return S.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}wr(e){let t=0;return this.pr(e,n=>{t++}).next(()=>t)}pr(e,t){return S.forEach(this.pi,(n,i)=>this.br(e,n,i).next(s=>s?S.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ii(e,o=>this.br(e,o,t).next(c=>{c||(n++,s.removeEntry(o,q.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),S.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),S.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),S.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),S.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=$s(e.data.value)),t}br(e,t,n){return S.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.pi.get(t);return S.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var ol=class{constructor(e){this.serializer=e}k(e,t,n,i){let s=new Zs("createOrUpgrade",t);n<1&&i>=1&&((function(u){u.createObjectStore(Qi)})(e),(function(u){u.createObjectStore(Ri,{keyPath:tw}),u.createObjectStore(He,{keyPath:Zf,autoIncrement:!0}).createIndex(En,ep,{unique:!0}),u.createObjectStore(gr)})(e),Bp(e),(function(u){u.createObjectStore(gn)})(e));let o=S.resolve();return n<3&&i>=3&&(n!==0&&((function(u){u.deleteObjectStore(yr),u.deleteObjectStore(_r),u.deleteObjectStore(Sn)})(e),Bp(e)),o=o.next(()=>(function(u){let h=u.store(Sn),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:q.min().toTimestamp(),targetCount:0};return h.put(no,f)})(s))),n<4&&i>=4&&(n!==0&&(o=o.next(()=>(function(u,h){return h.store(He).J().next(m=>{u.deleteObjectStore(He),u.createObjectStore(He,{keyPath:Zf,autoIncrement:!0}).createIndex(En,ep,{unique:!0});let y=h.store(He),P=m.map(k=>y.put(k));return S.waitFor(P)})})(e,s))),o=o.next(()=>{(function(u){u.createObjectStore(Ir,{keyPath:lw})})(e)})),n<5&&i>=5&&(o=o.next(()=>this.yi(s))),n<6&&i>=6&&(o=o.next(()=>((function(u){u.createObjectStore(Pi)})(e),this.wi(s)))),n<7&&i>=7&&(o=o.next(()=>this.Si(s))),n<8&&i>=8&&(o=o.next(()=>this.bi(e,s))),n<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(o=o.next(()=>this.Di(s))),n<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore(ta,{keyPath:hw})})(e),(function(u){u.createObjectStore(na,{keyPath:dw})})(e)})),n<12&&i>=12&&(o=o.next(()=>{(function(u){let h=u.createObjectStore(ra,{keyPath:Iw});h.createIndex(uu,ww,{unique:!1}),h.createIndex(ym,Ew,{unique:!1})})(e)})),n<13&&i>=13&&(o=o.next(()=>(function(u){let h=u.createObjectStore(to,{keyPath:rw});h.createIndex(js,iw),h.createIndex(pm,sw)})(e)).next(()=>this.Ci(e,s)).next(()=>e.deleteObjectStore(gn))),n<14&&i>=14&&(o=o.next(()=>this.Fi(e,s))),n<15&&i>=15&&(o=o.next(()=>(function(u){u.createObjectStore(eh,{keyPath:fw,autoIncrement:!0}).createIndex(cu,pw,{unique:!1}),u.createObjectStore(mi,{keyPath:mw}).createIndex(gm,gw,{unique:!1}),u.createObjectStore(gi,{keyPath:_w}).createIndex(_m,yw,{unique:!1})})(e))),n<16&&i>=16&&(o=o.next(()=>{t.objectStore(mi).clear()}).next(()=>{t.objectStore(gi).clear()})),n<17&&i>=17&&(o=o.next(()=>{(function(u){u.createObjectStore(th,{keyPath:Tw})})(e)})),n<18&&i>=18&&_c()&&(o=o.next(()=>{t.objectStore(mi).clear()}).next(()=>{t.objectStore(gi).clear()})),o}wi(e){let t=0;return e.store(gn).ee((n,i)=>{t+=vo(i)}).next(()=>{let n={byteSize:t};return e.store(Pi).put(au,n)})}yi(e){let t=e.store(Ri),n=e.store(He);return t.J().next(i=>S.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,bn],[s.userId,s.lastAcknowledgedBatchId]);return n.J(En,o).next(c=>S.forEach(c,u=>{U(u.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:u.batchId});let h=yn(this.serializer,u);return mg(e,s.userId,h).next(()=>{})}))}))}Si(e){let t=e.store(yr),n=e.store(gn);return e.store(Sn).get(no).next(i=>{let s=[];return n.ee((o,c)=>{let u=new ee(o),h=(function(m){return[0,Pe(m)]})(u);s.push(t.get(h).next(f=>f?S.resolve():(m=>t.put({targetId:0,path:Pe(m),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>S.waitFor(s))})}bi(e,t){e.createObjectStore(Ci,{keyPath:uw});let n=t.store(Ci),i=new Ui,s=o=>{if(i.add(o)){let c=o.lastSegment(),u=o.popLast();return n.put({collectionId:c,parent:Pe(u)})}};return t.store(gn).ee({X:!0},(o,c)=>{let u=new ee(o);return s(u.popLast())}).next(()=>t.store(gr).ee({X:!0},([o,c,u],h)=>{let f=st(c);return s(f.popLast())}))}Di(e){let t=e.store(_r);return t.ee((n,i)=>{let s=fi(i),o=lg(this.serializer,s);return t.put(o)})}Ci(e,t){let n=t.store(gn),i=[];return n.ee((s,o)=>{let c=t.store(to),u=(function(m){return m.document?new L(ee.fromString(m.document.name).popFirst(5)):m.noDocument?L.fromSegments(m.noDocument.path):m.unknownDocument?L.fromSegments(m.unknownDocument.path):M(36783)})(o).path.toArray(),h={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(c.put(h))}).next(()=>S.waitFor(i))}Fi(e,t){let n=t.store(He),i=wg(this.serializer),s=new qi(Po.mi,this.serializer.yt);return n.J().next(o=>{let c=new Map;return o.forEach(u=>{let h=c.get(u.userId)??H();yn(this.serializer,u).keys().forEach(f=>h=h.add(f)),c.set(u.userId,h)}),S.forEach(c,(u,h)=>{let f=new ve(h),m=wo.wt(this.serializer,f),y=s.getIndexManager(f),P=Ao.wt(f,this.serializer,y,s.referenceDelegate);return new Ro(i,P,m,y).recalculateAndSaveOverlaysForDocumentKeys(new Di(t,Ue.ce),u).next()})})}};function Bp(r){r.createObjectStore(yr,{keyPath:aw}).createIndex(Zl,cw,{unique:!0}),r.createObjectStore(_r,{keyPath:"targetId"}).createIndex(mm,ow,{unique:!0}),r.createObjectStore(Sn)}var xt="IndexedDbPersistence",zc=18e5,jc=5e3,Gc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",aE="main",al=class r{constructor(e,t,n,i,s,o,c,u,h,f,m=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Mi=s,this.window=o,this.document=c,this.xi=h,this.Oi=f,this.Ni=m,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=y=>Promise.resolve(),!r.v())throw new V(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Hu(this,i),this.$i=t+aE,this.serializer=new yo(u),this.Ui=new mr(this.$i,this.Ni,new ol(this.serializer)),this.hi=new Lu,this.Pi=new $u(this.referenceDelegate,this.serializer),this.remoteDocumentCache=wg(this.serializer),this.Ii=new xu,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&de(xt,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(C.FAILED_PRECONDITION,Gc);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Ue(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(t=>g(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.Wi())})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Bs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(t=>{t||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(en(e))return D(xt,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D(xt,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return hi(e).get(Yn).next(t=>S.resolve(this.es(t)))}ts(e){return Bs(e).delete(this.clientId)}ns(){return g(this,null,function*(){if(this.isPrimary&&!this.rs(this.qi,zc)){this.qi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=we(t,Ir);return n.J().next(i=>{let s=this.ss(i,zc),o=i.filter(c=>s.indexOf(c)===-1);return S.forEach(o,c=>n.delete(c.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(let t of e)this.Ki.removeItem(this._s(t.clientId))}})}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?S.resolve(!0):hi(e).get(Yn).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,jc)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new V(C.FAILED_PRECONDITION,Gc);return!1}}return!(!this.networkEnabled||!this.inForeground)||Bs(e).J().next(n=>this.ss(n,jc).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,c=this.networkEnabled===i.networkEnabled;if(s||o&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&D(xt,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return g(this,null,function*(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),yield this.Ui.runTransaction("shutdown","readwrite",[Qi,Ir],e=>{let t=new Di(e,Ue.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()})}ss(e,t){return e.filter(n=>this.rs(n.updateTimeMs,t)&&!this.us(n.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Bs(e).J().next(t=>this.ss(t,zc).map(n=>n.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Ao.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Gu(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return wo.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,n){D(xt,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=(function(u){return u===18?bw:u===17?Tm:u===16?Aw:u===15?nh:u===14?Em:u===13?wm:u===12?vw:u===11?Im:void M(60245)})(this.Ni),o;return this.Ui.runTransaction(e,i,s,c=>(o=new Di(c,this.ci?this.ci.next():Ue.ce),t==="readwrite-primary"?this.Hi(o).next(u=>!!u||this.Yi(o)).next(u=>{if(!u)throw de(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new V(C.FAILED_PRECONDITION,lm);return n(o)}).next(u=>this.Xi(o).next(()=>u)):this.Is(o).next(()=>n(o)))).then(c=>(o.raiseOnCommittedEvent(),c))}Is(e){return hi(e).get(Yn).next(t=>{if(t!==null&&this.rs(t.leaseTimestampMs,jc)&&!this.us(t.ownerId)&&!this.es(t)&&!(this.Oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new V(C.FAILED_PRECONDITION,Gc)})}Xi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return hi(e).put(Yn,t)}static v(){return mr.v()}Zi(e){let t=hi(e);return t.get(Yn).next(n=>this.es(n)?(D(xt,"Releasing primary lease."),t.delete(Yn)):S.resolve())}rs(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(de(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();let e=/(?:Version|Mobile)\/1[456]/;gc()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{let t=this.Ki?.getItem(this._s(e))!==null;return D(xt,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(t){return de(xt,"Failed to get zombied client id.",t),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){de("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function hi(r){return we(r,Qi)}function Bs(r){return we(r,Ir)}function Eg(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}var cl=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=H(),i=H();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};var ul=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Do=class{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return gc()?8:hm(he())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.ys(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ws(e,t,i,n).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new ul;return this.Ss(e,t,o).next(c=>{if(s.result=c,this.Vs)return this.bs(e,t,o,c.size)})}).next(()=>s.result)}bs(e,t,n,i){return n.documentReadCount<this.fs?(rr()<=Q.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",ir(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),S.resolve()):(rr()<=Q.DEBUG&&D("QueryEngine","Query:",ir(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(rr()<=Q.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",ir(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,je(t))):S.resolve())}ys(e,t){if(dp(t))return S.resolve(null);let n=je(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Au(t,null,"F"),n=je(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let o=H(...s);return this.ps.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,n).next(u=>{let h=this.Ds(t,c);return this.Cs(t,h,o,u.readTime)?this.ys(e,Au(t,null,"F")):this.vs(e,h,t,u)}))})))}ws(e,t,n,i){return dp(t)||i.isEqual(q.min())?S.resolve(null):this.ps.getDocuments(e,n).next(s=>{let o=this.Ds(t,s);return this.Cs(t,o,n,i)?S.resolve(null):(rr()<=Q.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ir(t)),this.vs(e,o,t,cm(i,fr)).next(c=>c))})}Ds(e,t){let n=new re(qm(e));return t.forEach((i,s)=>{Xi(e,s)&&(n=n.add(s))}),n}Cs(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,t,n){return rr()<=Q.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",ir(t)),this.ps.getDocumentsMatchingQuery(e,t,We.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var hh="LocalStore",cE=3e8,ll=class{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new ae(G),this.xs=new Qe(s=>kn(s),Ji),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ro(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}};function Tg(r,e,t,n){return new ll(r,e,t,n)}function vg(r,e){return g(this,null,function*(){let t=F(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.Bs(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let o=[],c=[],u=H();for(let h of i){o.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}for(let h of s){c.push(h.batchId);for(let f of h.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(n,u).next(h=>({Ls:h,removedBatchIds:o,addedBatchIds:c}))})})})}function uE(r,e){let t=F(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,u,h,f){let m=h.batch,y=m.keys(),P=S.resolve();return y.forEach(k=>{P=P.next(()=>f.getEntry(u,k)).next(O=>{let N=h.docVersions.get(k);U(N!==null,48541),O.version.compareTo(N)<0&&(m.applyToRemoteDocument(O,h),O.isValidDocument()&&(O.setReadTime(h.commitVersion),f.addEntry(O)))})}),P.next(()=>c.mutationQueue.removeMutationBatch(u,m))})(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(c){let u=H();for(let h=0;h<c.mutationResults.length;++h)c.mutationResults[h].transformResults.length>0&&(u=u.add(c.batch.mutations[h].key));return u})(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function Ag(r){let e=F(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function lE(r,e){let t=F(r),n=e.snapshotVersion,i=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Ns.newChangeBuffer({trackRemovals:!0});i=t.Ms;let c=[];e.targetChanges.forEach((f,m)=>{let y=i.get(m);if(!y)return;c.push(t.Pi.removeMatchingKeys(s,f.removedDocuments,m).next(()=>t.Pi.addMatchingKeys(s,f.addedDocuments,m)));let P=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?P=P.withResumeToken(ge.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):f.resumeToken.approximateByteSize()>0&&(P=P.withResumeToken(f.resumeToken,n)),i=i.insert(m,P),(function(O,N,$){return O.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=cE?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0})(y,P,f)&&c.push(t.Pi.updateTargetData(s,P))});let u=qe(),h=H();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),c.push(hE(s,o,e.documentUpdates).next(f=>{u=f.ks,h=f.qs})),!n.isEqual(q.min())){let f=t.Pi.getLastRemoteSnapshotVersion(s).next(m=>t.Pi.setTargetsMetadata(s,s.currentSequenceNumber,n));c.push(f)}return S.waitFor(c).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,h)).next(()=>u)}).then(s=>(t.Ms=i,s))}function hE(r,e,t){let n=H(),i=H();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let o=qe();return t.forEach((c,u)=>{let h=s.get(c);u.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(c)),u.isNoDocument()&&u.version.isEqual(q.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!h.isValidDocument()||u.version.compareTo(h.version)>0||u.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):D(hh,"Ignoring outdated watch update for ",c,". Current version:",h.version," Watch version:",u.version)}),{ks:o,qs:i}})}function dE(r,e){let t=F(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=bn),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function No(r,e){let t=F(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Pi.getTargetData(n,e).next(s=>s?(i=s,S.resolve(i)):t.Pi.allocateTargetId(n).next(o=>(i=new Rr(e,o,"TargetPurposeListen",n.currentSequenceNumber),t.Pi.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.Ms.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(n.targetId,n),t.xs.set(e,n.targetId)),n})}function Cr(r,e,t){return g(this,null,function*(){let n=F(r),i=n.Ms.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,o=>n.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!en(o))throw o;D(hh,`Failed to update sequence numbers for target ${e}: ${o}`)}n.Ms=n.Ms.remove(e),n.xs.delete(i.target)})}function hl(r,e,t){let n=F(r),i=q.min(),s=H();return n.persistence.runTransaction("Execute query","readwrite",o=>(function(u,h,f){let m=F(u),y=m.xs.get(f);return y!==void 0?S.resolve(m.Ms.get(y)):m.Pi.getTargetData(h,f)})(n,o,je(e)).next(c=>{if(c)return i=c.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(o,c.targetId).next(u=>{s=u})}).next(()=>n.Fs.getDocumentsMatchingQuery(o,e,t?i:q.min(),t?s:H())).next(c=>(Rg(n,Bm(e),c),{documents:c,Qs:s})))}function bg(r,e){let t=F(r),n=F(t.Pi),i=t.Ms.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.At(s,e).next(o=>o?o.target:null))}function Sg(r,e){let t=F(r),n=t.Os.get(e)||q.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Ns.getAllFromCollectionGroup(i,e,cm(n,fr),Number.MAX_SAFE_INTEGER)).then(i=>(Rg(t,e,i),i))}function Rg(r,e,t){let n=r.Os.get(e)||q.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.Os.set(e,n)}var Pg="firestore_clients";function qp(r,e){return`${Pg}_${r}_${e}`}var Cg="firestore_mutations";function zp(r,e,t){let n=`${Cg}_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}var Dg="firestore_targets";function $c(r,e){return`${Dg}_${r}_${e}`}var it="SharedClientState",ko=class r{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Ws(e,t,n){let i=JSON.parse(n),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new V(i.error.code,i.error.message))),o?new r(e,t,i.state,s):(de(it,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ei=class r{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ws(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new V(n.error.code,n.error.message))),s?new r(e,n.state,i):(de(it,`Failed to parse target state for ID '${e}': ${t}`),null)}Gs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Vo=class r{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ws(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=ah();for(let o=0;i&&o<n.activeTargetIds.length;++o)i=dm(n.activeTargetIds[o]),s=s.add(n.activeTargetIds[o]);return i?new r(e,s):(de(it,`Failed to parse client data for instance '${e}': ${t}`),null)}},dl=class r{constructor(e,t){this.clientId=e,this.onlineState=t}static Ws(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new r(t.clientId,t.onlineState):(de(it,`Failed to parse online state: ${e}`),null)}},zi=class{constructor(){this.activeTargetIds=ah()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ti=class{constructor(e,t,n,i,s){this.window=e,this.Mi=t,this.persistenceKey=n,this.Js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Hs=this.Ys.bind(this),this.Zs=new ae(G),this.started=!1,this.Xs=[];let o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.eo=qp(this.persistenceKey,this.Js),this.no=(function(u){return`firestore_sequence_number_${u}`})(this.persistenceKey),this.Zs=this.Zs.insert(this.Js,new zi),this.ro=new RegExp(`^${Pg}_${o}_([^_]*)$`),this.io=new RegExp(`^${Cg}_${o}_(\\d+)(?:_(.*))?$`),this.so=new RegExp(`^${Dg}_${o}_(\\d+)$`),this.oo=(function(u){return`firestore_online_state_${u}`})(this.persistenceKey),this._o=(function(u){return`firestore_bundle_loaded_v2_${u}`})(this.persistenceKey),this.window.addEventListener("storage",this.Hs)}static v(e){return!(!e||!e.localStorage)}start(){return g(this,null,function*(){let e=yield this.syncEngine.Ts();for(let n of e){if(n===this.Js)continue;let i=this.getItem(qp(this.persistenceKey,n));if(i){let s=Vo.Ws(n,i);s&&(this.Zs=this.Zs.insert(s.clientId,s))}}this.ao();let t=this.storage.getItem(this.oo);if(t){let n=this.uo(t);n&&this.co(n)}for(let n of this.Xs)this.Ys(n);this.Xs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.no,JSON.stringify(e))}getAllActiveQueryTargets(){return this.lo(this.Zs)}isActiveQueryTarget(e){let t=!1;return this.Zs.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ho(e,"pending")}updateMutationState(e,t,n){this.ho(e,t,n),this.Po(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem($c(this.persistenceKey,e));if(i){let s=Ei.Ws(e,i);s&&(n=s.state)}}return t&&this.To.zs(e),this.ao(),n}removeLocalQueryTarget(e){this.To.js(e),this.ao()}isLocalQueryTarget(e){return this.To.activeTargetIds.has(e)}clearQueryState(e){this.removeItem($c(this.persistenceKey,e))}updateQueryState(e,t,n){this.Io(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Po(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Eo(e)}notifyBundleLoaded(e){this.Ao(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Hs),this.removeItem(this.eo),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return D(it,"READ",e,t),t}setItem(e,t){D(it,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){D(it,"REMOVE",e),this.storage.removeItem(e)}Ys(e){let t=e;if(t.storageArea===this.storage){if(D(it,"EVENT",t.key,t.newValue),t.key===this.eo)return void de("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Mi.enqueueRetryable(()=>g(this,null,function*(){if(this.started){if(t.key!==null){if(this.ro.test(t.key)){if(t.newValue==null){let n=this.Ro(t.key);return this.Vo(n,null)}{let n=this.mo(t.key,t.newValue);if(n)return this.Vo(n.clientId,n)}}else if(this.io.test(t.key)){if(t.newValue!==null){let n=this.fo(t.key,t.newValue);if(n)return this.po(n)}}else if(this.so.test(t.key)){if(t.newValue!==null){let n=this.yo(t.key,t.newValue);if(n)return this.wo(n)}}else if(t.key===this.oo){if(t.newValue!==null){let n=this.uo(t.newValue);if(n)return this.co(n)}}else if(t.key===this.no){let n=(function(s){let o=Ue.ce;if(s!=null)try{let c=JSON.parse(s);U(typeof c=="number",30636,{So:s}),o=c}catch(c){de(it,"Failed to read sequence number from WebStorage",c)}return o})(t.newValue);n!==Ue.ce&&this.sequenceNumberHandler(n)}else if(t.key===this._o){let n=this.bo(t.newValue);yield Promise.all(n.map(i=>this.syncEngine.Do(i)))}}}else this.Xs.push(t)}))}}get To(){return this.Zs.get(this.Js)}ao(){this.setItem(this.eo,this.To.Gs())}ho(e,t,n){let i=new ko(this.currentUser,e,t,n),s=zp(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Gs())}Po(e){let t=zp(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Eo(e){let t={clientId:this.Js,onlineState:e};this.storage.setItem(this.oo,JSON.stringify(t))}Io(e,t,n){let i=$c(this.persistenceKey,e),s=new Ei(e,t,n);this.setItem(i,s.Gs())}Ao(e){let t=JSON.stringify(Array.from(e));this.setItem(this._o,t)}Ro(e){let t=this.ro.exec(e);return t?t[1]:null}mo(e,t){let n=this.Ro(e);return Vo.Ws(n,t)}fo(e,t){let n=this.io.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return ko.Ws(new ve(s),i,t)}yo(e,t){let n=this.so.exec(e),i=Number(n[1]);return Ei.Ws(i,t)}uo(e){return dl.Ws(e)}bo(e){return JSON.parse(e)}po(e){return g(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);D(it,`Ignoring mutation for non-active user ${e.user.uid}`)})}wo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Vo(e,t){let n=t?this.Zs.insert(e,t):this.Zs.remove(e),i=this.lo(this.Zs),s=this.lo(n),o=[],c=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||c.push(u)}),this.syncEngine.Fo(o,c).then(()=>{this.Zs=n})}co(e){this.Zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}lo(e){let t=ah();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Oo=class{constructor(){this.Mo=new zi,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new zi,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var fl=class{Oo(e){}shutdown(){}};var jp="ConnectivityMonitor",xo=class{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){D(jp,"Network connectivity changed: AVAILABLE");for(let e of this.qo)e(0)}ko(){D(jp,"Network connectivity changed: UNAVAILABLE");for(let e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var qs=null;function pl(){return qs===null?qs=(function(){return 268435456+Math.round(2147483648*Math.random())})():qs++,"0x"+qs.toString(16)}var Wc="RestConnection",fE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},ml=class{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===so?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,s){let o=pl(),c=this.zo(e,t.toUriEncodedString());D(Wc,`Sending RPC '${e}' ${o}:`,c,n);let u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,i,s);let{host:h}=new URL(c),f=Pt(h);return this.Jo(e,c,u,n,f).then(m=>(D(Wc,`Received RPC '${e}' ${o}: `,m),m),m=>{throw vi(Wc,`RPC '${e}' ${o} failed with error: `,m,"url: ",c,"request:",n),m})}Ho(e,t,n,i,s,o){return this.Go(e,t,n,i,s)}jo(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Or})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}zo(e,t){let n=fE[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}};var gl=class{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}};var Se="WebChannelConnection",_l=class extends ml{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,s){let o=pl();return new Promise((c,u)=>{let h=new xc;h.setWithCredentials(!0),h.listenOnce(Lc.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case ai.NO_ERROR:let m=h.getResponseJson();D(Se,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(m)),c(m);break;case ai.TIMEOUT:D(Se,`RPC '${e}' ${o} timed out`),u(new V(C.DEADLINE_EXCEEDED,"Request time out"));break;case ai.HTTP_ERROR:let y=h.getStatus();if(D(Se,`RPC '${e}' ${o} failed with status:`,y,"response text:",h.getResponseText()),y>0){let P=h.getResponseJson();Array.isArray(P)&&(P=P[0]);let k=P?.error;if(k&&k.status&&k.message){let O=(function($){let z=$.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(z)>=0?z:C.UNKNOWN})(k.status);u(new V(O,k.message))}else u(new V(C.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new V(C.UNAVAILABLE,"Connection failed."));break;default:M(9055,{l_:e,streamId:o,h_:h.getLastErrorCode(),P_:h.getLastError()})}}finally{D(Se,`RPC '${e}' ${o} completed.`)}});let f=JSON.stringify(i);D(Se,`RPC '${e}' ${o} sending request:`,i),h.send(t,"POST",f,n,15)})}T_(e,t,n){let i=pl(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Uc(),c=Fc(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;let f=s.join("");D(Se,`Creating RPC '${e}' stream ${i}: ${f}`,u);let m=o.createWebChannel(f,u);this.I_(m);let y=!1,P=!1,k=new gl({Yo:N=>{P?D(Se,`Not sending because RPC '${e}' stream ${i} is closed:`,N):(y||(D(Se,`Opening RPC '${e}' stream ${i} transport.`),m.open(),y=!0),D(Se,`RPC '${e}' stream ${i} sending:`,N),m.send(N))},Zo:()=>m.close()}),O=(N,$,z)=>{N.listen($,B=>{try{z(B)}catch(ne){setTimeout(()=>{throw ne},0)}})};return O(m,Jn.EventType.OPEN,()=>{P||(D(Se,`RPC '${e}' stream ${i} transport opened.`),k.o_())}),O(m,Jn.EventType.CLOSE,()=>{P||(P=!0,D(Se,`RPC '${e}' stream ${i} transport closed`),k.a_(),this.E_(m))}),O(m,Jn.EventType.ERROR,N=>{P||(P=!0,vi(Se,`RPC '${e}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),k.a_(new V(C.UNAVAILABLE,"The operation could not be completed")))}),O(m,Jn.EventType.MESSAGE,N=>{if(!P){let $=N.data[0];U(!!$,16349);let z=$,B=z?.error||z[0]?.error;if(B){D(Se,`RPC '${e}' stream ${i} received error:`,B);let ne=B.status,Z=(function(_){let w=fe[_];if(w!==void 0)return Xm(w)})(ne),Y=B.message;Z===void 0&&(Z=C.INTERNAL,Y="Unknown error status: "+ne+" with message "+B.message),P=!0,k.a_(new V(Z,Y)),m.close()}else D(Se,`RPC '${e}' stream ${i} received:`,$),k.u_($)}}),O(c,Mc.STAT_EVENT,N=>{N.stat===Ls.PROXY?D(Se,`RPC '${e}' stream ${i} detected buffering proxy`):N.stat===Ls.NOPROXY&&D(Se,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.__()},0),k}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}};function Ng(){return typeof window<"u"?window:null}function Qs(){return typeof document<"u"?document:null}function aa(r){return new Du(r,!0)}var Lo=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}};var Gp="PersistentStream",Mo=class{constructor(e,t,n,i,s,o,c,u){this.Mi=e,this.S_=n,this.b_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Lo(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}stop(){return g(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return g(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return g(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===C.RESOURCE_EXHAUSTED?(de(t.toString()),de("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.D_===t&&this.G_(n,i)},n=>{e(()=>{let i=new V(C.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(i)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(i=>{n(()=>this.z_(i))}),this.stream.onMessage(i=>{n(()=>++this.F_==1?this.J_(i):this.onNext(i))})}N_(){this.state=5,this.M_.p_(()=>g(this,null,function*(){this.state=0,this.start()}))}z_(e){return D(Gp,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(D(Gp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},yl=class extends Mo{constructor(e,t,n,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=Yw(this.serializer,e),n=(function(s){if(!("targetChange"in s))return q.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?q.min():o.readTime?ke(o.readTime):q.min()})(e);return this.listener.H_(t,n)}Y_(e){let t={};t.database=Vu(this.serializer),t.addTarget=(function(s,o){let c,u=o.target;if(c=co(u)?{documents:ig(s,u)}:{query:sg(s,u).ft},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Zm(s,o.resumeToken);let h=Nu(s,o.expectedCount);h!==null&&(c.expectedCount=h)}else if(o.snapshotVersion.compareTo(q.min())>0){c.readTime=Sr(s,o.snapshotVersion.toTimestamp());let h=Nu(s,o.expectedCount);h!==null&&(c.expectedCount=h)}return c})(this.serializer,e);let n=Zw(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){let t={};t.database=Vu(this.serializer),t.removeTarget=e,this.q_(t)}},Il=class extends Mo{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return U(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,U(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){U(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let t=Xw(e.writeResults,e.commitTime),n=ke(e.commitTime);return this.listener.na(n,t)}ra(){let e={};e.database=Vu(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>_o(this.serializer,n))};this.q_(t)}};var wl=class{},El=class extends wl{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new V(C.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Go(e,ku(t,n),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new V(C.UNKNOWN,s.toString())})}Ho(e,t,n,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Ho(e,ku(t,n),i,o,c,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(C.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}},Tl=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(de(t),this.aa=!1):D("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}};var Mn="RemoteStore",vl=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo(o=>{n.enqueueAndForget(()=>g(this,null,function*(){Un(this)&&(D(Mn,"Restarting streams for network reachability change."),yield(function(u){return g(this,null,function*(){let h=F(u);h.Ea.add(4),yield Zi(h),h.Ra.set("Unknown"),h.Ea.delete(4),yield ca(h)})})(this))}))}),this.Ra=new Tl(n,i)}};function ca(r){return g(this,null,function*(){if(Un(r))for(let e of r.da)yield e(!0)})}function Zi(r){return g(this,null,function*(){for(let e of r.da)yield e(!1)})}function ua(r,e){let t=F(r);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ph(t)?fh(t):Lr(t).O_()&&dh(t,e))}function Dr(r,e){let t=F(r),n=Lr(t);t.Ia.delete(e),n.O_()&&kg(t,e),t.Ia.size===0&&(n.O_()?n.L_():Un(t)&&t.Ra.set("Unknown"))}function dh(r,e){if(r.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Lr(r).Y_(e)}function kg(r,e){r.Va.Ue(e),Lr(r).Z_(e)}function fh(r){r.Va=new Cu({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),Lr(r).start(),r.Ra.ua()}function ph(r){return Un(r)&&!Lr(r).x_()&&r.Ia.size>0}function Un(r){return F(r).Ea.size===0}function Vg(r){r.Va=void 0}function pE(r){return g(this,null,function*(){r.Ra.set("Online")})}function mE(r){return g(this,null,function*(){r.Ia.forEach((e,t)=>{dh(r,e)})})}function gE(r,e){return g(this,null,function*(){Vg(r),ph(r)?(r.Ra.ha(e),fh(r)):r.Ra.set("Unknown")})}function _E(r,e,t){return g(this,null,function*(){if(r.Ra.set("Online"),e instanceof po&&e.state===2&&e.cause)try{yield(function(i,s){return g(this,null,function*(){let o=s.cause;for(let c of s.targetIds)i.Ia.has(c)&&(yield i.remoteSyncer.rejectListen(c,o),i.Ia.delete(c),i.Va.removeTarget(c))})})(r,e)}catch(n){D(Mn,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield Fo(r,n)}else if(e instanceof lr?r.Va.Ze(e):e instanceof fo?r.Va.st(e):r.Va.tt(e),!t.isEqual(q.min()))try{let n=yield Ag(r.localStore);t.compareTo(n)>=0&&(yield(function(s,o){let c=s.Va.Tt(o);return c.targetChanges.forEach((u,h)=>{if(u.resumeToken.approximateByteSize()>0){let f=s.Ia.get(h);f&&s.Ia.set(h,f.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,h)=>{let f=s.Ia.get(u);if(!f)return;s.Ia.set(u,f.withResumeToken(ge.EMPTY_BYTE_STRING,f.snapshotVersion)),kg(s,u);let m=new Rr(f.target,u,h,f.sequenceNumber);dh(s,m)}),s.remoteSyncer.applyRemoteEvent(c)})(r,t))}catch(n){D(Mn,"Failed to raise snapshot:",n),yield Fo(r,n)}})}function Fo(r,e,t){return g(this,null,function*(){if(!en(e))throw e;r.Ea.add(1),yield Zi(r),r.Ra.set("Offline"),t||(t=()=>Ag(r.localStore)),r.asyncQueue.enqueueRetryable(()=>g(null,null,function*(){D(Mn,"Retrying IndexedDB access"),yield t(),r.Ea.delete(1),yield ca(r)}))})}function Og(r,e){return e().catch(t=>Fo(r,t,e))}function xr(r){return g(this,null,function*(){let e=F(r),t=Jt(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:bn;for(;yE(e);)try{let i=yield dE(e.localStore,n);if(i===null){e.Ta.length===0&&t.L_();break}n=i.batchId,IE(e,i)}catch(i){yield Fo(e,i)}xg(e)&&Lg(e)})}function yE(r){return Un(r)&&r.Ta.length<10}function IE(r,e){r.Ta.push(e);let t=Jt(r);t.O_()&&t.X_&&t.ea(e.mutations)}function xg(r){return Un(r)&&!Jt(r).x_()&&r.Ta.length>0}function Lg(r){Jt(r).start()}function wE(r){return g(this,null,function*(){Jt(r).ra()})}function EE(r){return g(this,null,function*(){let e=Jt(r);for(let t of r.Ta)e.ea(t.mutations)})}function TE(r,e,t){return g(this,null,function*(){let n=r.Ta.shift(),i=Su.from(n,e,t);yield Og(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield xr(r)})}function vE(r,e){return g(this,null,function*(){e&&Jt(r).X_&&(yield(function(n,i){return g(this,null,function*(){if((function(o){return zw(o)&&o!==C.ABORTED})(i.code)){let s=n.Ta.shift();Jt(n).B_(),yield Og(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield xr(n)}})})(r,e)),xg(r)&&Lg(r)})}function $p(r,e){return g(this,null,function*(){let t=F(r);t.asyncQueue.verifyOperationInProgress(),D(Mn,"RemoteStore received new credentials");let n=Un(t);t.Ea.add(3),yield Zi(t),n&&t.Ra.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),yield ca(t)})}function Al(r,e){return g(this,null,function*(){let t=F(r);e?(t.Ea.delete(2),yield ca(t)):e||(t.Ea.add(2),yield Zi(t),t.Ra.set("Unknown"))})}function Lr(r){return r.ma||(r.ma=(function(t,n,i){let s=F(t);return s.sa(),new yl(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(r.datastore,r.asyncQueue,{Xo:pE.bind(null,r),t_:mE.bind(null,r),r_:gE.bind(null,r),H_:_E.bind(null,r)}),r.da.push(e=>g(null,null,function*(){e?(r.ma.B_(),ph(r)?fh(r):r.Ra.set("Unknown")):(yield r.ma.stop(),Vg(r))}))),r.ma}function Jt(r){return r.fa||(r.fa=(function(t,n,i){let s=F(t);return s.sa(),new Il(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:wE.bind(null,r),r_:vE.bind(null,r),ta:EE.bind(null,r),na:TE.bind(null,r)}),r.da.push(e=>g(null,null,function*(){e?(r.fa.B_(),yield xr(r)):(yield r.fa.stop(),r.Ta.length>0&&(D(Mn,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}var bl=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new $e,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let o=Date.now()+n,c=new r(e,t,o,i,s);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(C.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function mh(r,e){if(de("AsyncQueue",`${e}: ${r}`),en(r))return new V(C.UNAVAILABLE,`${e}: ${r}`);throw r}var Uo=class r{static emptySet(e){return new r(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||L.comparator(t.key,n.key):(t,n)=>L.comparator(t.key,n.key),this.keyedMap=di(),this.sortedSet=new ae(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var Bo=class{constructor(){this.ga=new ae(L.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):M(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}},Nr=class r{constructor(e,t,n,i,s,o,c,u,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){let o=[];return t.forEach(c=>{o.push({type:0,doc:c})}),new r(e,t,Uo.emptySet(t),o,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};var Sl=class{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}},Rl=class{constructor(){this.queries=Wp(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){let i=F(t),s=i.queries;i.queries=Wp(),s.forEach((o,c)=>{for(let u of c.Sa)u.onError(n)})})(this,new V(C.ABORTED,"Firestore shutting down"))}};function Wp(){return new Qe(r=>Um(r),oa)}function gh(r,e){return g(this,null,function*(){let t=F(r),n=3,i=e.query,s=t.queries.get(i);s?!s.ba()&&e.Da()&&(n=2):(s=new Sl,n=e.Da()?0:1);try{switch(n){case 0:s.wa=yield t.onListen(i,!0);break;case 1:s.wa=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let c=mh(o,`Initialization of query '${ir(e.query)}' failed`);return void e.onError(c)}t.queries.set(i,s),s.Sa.push(e),e.va(t.onlineState),s.wa&&e.Fa(s.wa)&&yh(t)})}function _h(r,e){return g(this,null,function*(){let t=F(r),n=e.query,i=3,s=t.queries.get(n);if(s){let o=s.Sa.indexOf(e);o>=0&&(s.Sa.splice(o,1),s.Sa.length===0?i=e.Da()?0:1:!s.ba()&&e.Da()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function AE(r,e){let t=F(r),n=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let c of o.Sa)c.Fa(i)&&(n=!0);o.wa=i}}n&&yh(t)}function bE(r,e,t){let n=F(r),i=n.queries.get(e);if(i)for(let s of i.Sa)s.onError(t);n.queries.delete(e)}function yh(r){r.Ca.forEach(e=>{e.next()})}var Pl,Kp;(Kp=Pl||(Pl={})).Ma="default",Kp.Cache="cache";var ji=class{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new Nr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;let n=t!=="Offline";return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Nr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Pl.Cache}};var qo=class{constructor(e){this.key=e}},zo=class{constructor(e){this.key=e}},Cl=class{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=H(),this.mutatedKeys=H(),this.eu=qm(e),this.tu=new Uo(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new Bo,i=t?t.tu:this.tu,s=t?t.mutatedKeys:this.mutatedKeys,o=i,c=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,m)=>{let y=i.get(f),P=Xi(this.query,m)?m:null,k=!!y&&this.mutatedKeys.has(y.key),O=!!P&&(P.hasLocalMutations||this.mutatedKeys.has(P.key)&&P.hasCommittedMutations),N=!1;y&&P?y.data.isEqual(P.data)?k!==O&&(n.track({type:3,doc:P}),N=!0):this.su(y,P)||(n.track({type:2,doc:P}),N=!0,(u&&this.eu(P,u)>0||h&&this.eu(P,h)<0)&&(c=!0)):!y&&P?(n.track({type:0,doc:P}),N=!0):y&&!P&&(n.track({type:1,doc:y}),N=!0,(u||h)&&(c=!0)),N&&(P?(o=o.add(P),s=O?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{tu:o,iu:n,Cs:c,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let o=e.iu.ya();o.sort((f,m)=>(function(P,k){let O=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{Rt:N})}};return O(P)-O(k)})(f.type,m.type)||this.eu(f.doc,m.doc)),this.ou(n),i=i??!1;let c=t&&!i?this._u():[],u=this.Xa.size===0&&this.current&&!i?1:0,h=u!==this.Za;return this.Za=u,o.length!==0||h?{snapshot:new Nr(this.query,e.tu,s,o,e.mutatedKeys,u===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Bo,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=H(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))});let t=[];return e.forEach(n=>{this.Xa.has(n)||t.push(new zo(n))}),this.Xa.forEach(n=>{e.has(n)||t.push(new qo(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=H();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Nr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}},Mr="SyncEngine",Dl=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},Nl=class{constructor(e){this.key=e,this.hu=!1}},kl=class{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Qe(c=>Um(c),oa),this.Iu=new Map,this.Eu=new Set,this.du=new ae(L.comparator),this.Au=new Map,this.Ru=new Bi,this.Vu={},this.mu=new Map,this.fu=Pr.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}};function SE(r,e,t=!0){return g(this,null,function*(){let n=la(r),i,s=n.Tu.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=yield Mg(n,e,t,!0),i})}function RE(r,e){return g(this,null,function*(){let t=la(r);yield Mg(t,e,!0,!1)})}function Mg(r,e,t,n){return g(this,null,function*(){let i=yield No(r.localStore,je(e)),s=i.targetId,o=r.sharedClientState.addLocalQueryTarget(s,t),c;return n&&(c=yield Ih(r,e,s,o==="current",i.resumeToken)),r.isPrimaryClient&&t&&ua(r.remoteStore,i),c})}function Ih(r,e,t,n,i){return g(this,null,function*(){r.pu=(m,y,P)=>(function(O,N,$,z){return g(this,null,function*(){let B=N.view.ru($);B.Cs&&(B=yield hl(O.localStore,N.query,!1).then(({documents:E})=>N.view.ru(E,B)));let ne=z&&z.targetChanges.get(N.targetId),Z=z&&z.targetMismatches.get(N.targetId)!=null,Y=N.view.applyChanges(B,O.isPrimaryClient,ne,Z);return Vl(O,N.targetId,Y.au),Y.snapshot})})(r,m,y,P);let s=yield hl(r.localStore,e,!0),o=new Cl(e,s.Qs),c=o.ru(s.documents),u=Fi.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=o.applyChanges(c,r.isPrimaryClient,u);Vl(r,t,h.au);let f=new Dl(e,t,o);return r.Tu.set(e,f),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),h.snapshot})}function PE(r,e,t){return g(this,null,function*(){let n=F(r),i=n.Tu.get(e),s=n.Iu.get(i.targetId);if(s.length>1)return n.Iu.set(i.targetId,s.filter(o=>!oa(o,e))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Cr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Dr(n.remoteStore,i.targetId),kr(n,i.targetId)}).catch(Zt))):(kr(n,i.targetId),yield Cr(n.localStore,i.targetId,!0))})}function CE(r,e){return g(this,null,function*(){let t=F(r),n=t.Tu.get(e),i=t.Iu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Dr(t.remoteStore,n.targetId))})}function DE(r,e,t){return g(this,null,function*(){let n=vh(r);try{let i=yield(function(o,c){let u=F(o),h=se.now(),f=c.reduce((P,k)=>P.add(k.key),H()),m,y;return u.persistence.runTransaction("Locally write mutations","readwrite",P=>{let k=qe(),O=H();return u.Ns.getEntries(P,f).next(N=>{k=N,k.forEach(($,z)=>{z.isValidDocument()||(O=O.add($))})}).next(()=>u.localDocuments.getOverlayedDocuments(P,k)).next(N=>{m=N;let $=[];for(let z of c){let B=qw(z,m.get(z.key).overlayedDocument);B!=null&&$.push(new Je(z.key,B,Nm(B.value.mapValue),Re.exists(!0)))}return u.mutationQueue.addMutationBatch(P,h,$,c)}).next(N=>{y=N;let $=N.applyToLocalDocumentSet(m,O);return u.documentOverlayCache.saveOverlays(P,N.batchId,$)})}).then(()=>({batchId:y.batchId,changes:jm(m)}))})(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),(function(o,c,u){let h=o.Vu[o.currentUser.toKey()];h||(h=new ae(G)),h=h.insert(c,u),o.Vu[o.currentUser.toKey()]=h})(n,i.batchId,t),yield nn(n,i.changes),yield xr(n.remoteStore)}catch(i){let s=mh(i,"Failed to persist write");t.reject(s)}})}function Fg(r,e){return g(this,null,function*(){let t=F(r);try{let n=yield lE(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Au.get(s);o&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.hu=!0:i.modifiedDocuments.size>0?U(o.hu,14607):i.removedDocuments.size>0&&(U(o.hu,42227),o.hu=!1))}),yield nn(t,n,e)}catch(n){yield Zt(n)}})}function Hp(r,e,t){let n=F(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.Tu.forEach((s,o)=>{let c=o.view.va(e);c.snapshot&&i.push(c.snapshot)}),(function(o,c){let u=F(o);u.onlineState=c;let h=!1;u.queries.forEach((f,m)=>{for(let y of m.Sa)y.va(c)&&(h=!0)}),h&&yh(u)})(n.eventManager,e),i.length&&n.Pu.H_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function NE(r,e,t){return g(this,null,function*(){let n=F(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Au.get(e),s=i&&i.key;if(s){let o=new ae(L.comparator);o=o.insert(s,Ae.newNoDocument(s,q.min()));let c=H().add(s),u=new Mi(q.min(),new Map,new ae(G),o,c);yield Fg(n,u),n.du=n.du.remove(s),n.Au.delete(e),Th(n)}else yield Cr(n.localStore,e,!1).then(()=>kr(n,e,t)).catch(Zt)})}function kE(r,e){return g(this,null,function*(){let t=F(r),n=e.batch.batchId;try{let i=yield uE(t.localStore,e);Eh(t,n,null),wh(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield nn(t,i)}catch(i){yield Zt(i)}})}function VE(r,e,t){return g(this,null,function*(){let n=F(r);try{let i=yield(function(o,c){let u=F(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return u.mutationQueue.lookupMutationBatch(h,c).next(m=>(U(m!==null,37113),f=m.keys(),u.mutationQueue.removeMutationBatch(h,m))).next(()=>u.mutationQueue.performConsistencyCheck(h)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(h,f,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>u.localDocuments.getDocuments(h,f))})})(n.localStore,e);Eh(n,e,t),wh(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield nn(n,i)}catch(i){yield Zt(i)}})}function wh(r,e){(r.mu.get(e)||[]).forEach(t=>{t.resolve()}),r.mu.delete(e)}function Eh(r,e,t){let n=F(r),i=n.Vu[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Vu[n.currentUser.toKey()]=i}}function kr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.Iu.get(e))r.Tu.delete(n),t&&r.Pu.yu(n,t);r.Iu.delete(e),r.isPrimaryClient&&r.Ru.jr(e).forEach(n=>{r.Ru.containsKey(n)||Ug(r,n)})}function Ug(r,e){r.Eu.delete(e.path.canonicalString());let t=r.du.get(e);t!==null&&(Dr(r.remoteStore,t),r.du=r.du.remove(e),r.Au.delete(t),Th(r))}function Vl(r,e,t){for(let n of t)n instanceof qo?(r.Ru.addReference(n.key,e),OE(r,n)):n instanceof zo?(D(Mr,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,e),r.Ru.containsKey(n.key)||Ug(r,n.key)):M(19791,{wu:n})}function OE(r,e){let t=e.key,n=t.path.canonicalString();r.du.get(t)||r.Eu.has(n)||(D(Mr,"New document in limbo: "+t),r.Eu.add(n),Th(r))}function Th(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let e=r.Eu.values().next().value;r.Eu.delete(e);let t=new L(ee.fromString(e)),n=r.fu.next();r.Au.set(n,new Nl(t)),r.du=r.du.insert(t,n),ua(r.remoteStore,new Rr(je(Yi(t.path)),n,"TargetPurposeLimboResolution",Ue.ce))}}function nn(r,e,t){return g(this,null,function*(){let n=F(r),i=[],s=[],o=[];n.Tu.isEmpty()||(n.Tu.forEach((c,u)=>{o.push(n.pu(u,e,t).then(h=>{if((h||t)&&n.isPrimaryClient){let f=h?!h.fromCache:t?.targetChanges.get(u.targetId)?.current;n.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(h){i.push(h);let f=cl.As(u.targetId,h);s.push(f)}}))}),yield Promise.all(o),n.Pu.H_(i),yield(function(u,h){return g(this,null,function*(){let f=F(u);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>S.forEach(h,y=>S.forEach(y.Es,P=>f.persistence.referenceDelegate.addReference(m,y.targetId,P)).next(()=>S.forEach(y.ds,P=>f.persistence.referenceDelegate.removeReference(m,y.targetId,P)))))}catch(m){if(!en(m))throw m;D(hh,"Failed to update sequence numbers: "+m)}for(let m of h){let y=m.targetId;if(!m.fromCache){let P=f.Ms.get(y),k=P.snapshotVersion,O=P.withLastLimboFreeSnapshotVersion(k);f.Ms=f.Ms.insert(y,O)}}})})(n.localStore,s))})}function xE(r,e){return g(this,null,function*(){let t=F(r);if(!t.currentUser.isEqual(e)){D(Mr,"User change. New user:",e.toKey());let n=yield vg(t.localStore,e);t.currentUser=e,(function(s,o){s.mu.forEach(c=>{c.forEach(u=>{u.reject(new V(C.CANCELLED,o))})}),s.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield nn(t,n.Ls)}})}function LE(r,e){let t=F(r),n=t.Au.get(e);if(n&&n.hu)return H().add(n.key);{let i=H(),s=t.Iu.get(e);if(!s)return i;for(let o of s){let c=t.Tu.get(o);i=i.unionWith(c.view.nu)}return i}}function ME(r,e){return g(this,null,function*(){let t=F(r),n=yield hl(t.localStore,e.query,!0),i=e.view.cu(n);return t.isPrimaryClient&&Vl(t,e.targetId,i.au),i})}function FE(r,e){return g(this,null,function*(){let t=F(r);return Sg(t.localStore,e).then(n=>nn(t,n))})}function UE(r,e,t,n){return g(this,null,function*(){let i=F(r),s=yield(function(c,u){let h=F(c),f=F(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.er(m,u).next(y=>y?h.localDocuments.getDocuments(m,y):S.resolve(null)))})(i.localStore,e);s!==null?(t==="pending"?yield xr(i.remoteStore):t==="acknowledged"||t==="rejected"?(Eh(i,e,n||null),wh(i,e),(function(c,u){F(F(c).mutationQueue).ir(u)})(i.localStore,e)):M(6720,"Unknown batchState",{Su:t}),yield nn(i,s)):D(Mr,"Cannot apply mutation batch with id: "+e)})}function BE(r,e){return g(this,null,function*(){let t=F(r);if(la(t),vh(t),e===!0&&t.gu!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Qp(t,n.toArray());t.gu=!0,yield Al(t.remoteStore,!0);for(let s of i)ua(t.remoteStore,s)}else if(e===!1&&t.gu!==!1){let n=[],i=Promise.resolve();t.Iu.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?n.push(o):i=i.then(()=>(kr(t,o),Cr(t.localStore,o,!0))),Dr(t.remoteStore,o)}),yield i,yield Qp(t,n),(function(o){let c=F(o);c.Au.forEach((u,h)=>{Dr(c.remoteStore,h)}),c.Ru.Jr(),c.Au=new Map,c.du=new ae(L.comparator)})(t),t.gu=!1,yield Al(t.remoteStore,!1)}})}function Qp(r,e,t){return g(this,null,function*(){let n=F(r),i=[],s=[];for(let o of e){let c,u=n.Iu.get(o);if(u&&u.length!==0){c=yield No(n.localStore,je(u[0]));for(let h of u){let f=n.Tu.get(h),m=yield ME(n,f);m.snapshot&&s.push(m.snapshot)}}else{let h=yield bg(n.localStore,o);c=yield No(n.localStore,h),yield Ih(n,Bg(h),o,!1,c.resumeToken)}i.push(c)}return n.Pu.H_(s),i})}function Bg(r){return Mm(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function qE(r){return(function(t){return F(F(t).persistence).Ts()})(F(r).localStore)}function zE(r,e,t,n){return g(this,null,function*(){let i=F(r);if(i.gu)return void D(Mr,"Ignoring unexpected query state notification.");let s=i.Iu.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield Sg(i.localStore,Bm(s[0])),c=Mi.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ge.EMPTY_BYTE_STRING);yield nn(i,o,c);break}case"rejected":yield Cr(i.localStore,e,!0),kr(i,e,n);break;default:M(64155,t)}})}function jE(r,e,t){return g(this,null,function*(){let n=la(r);if(n.gu){for(let i of e){if(n.Iu.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){D(Mr,"Adding an already active target "+i);continue}let s=yield bg(n.localStore,i),o=yield No(n.localStore,s);yield Ih(n,Bg(s),o.targetId,!1,o.resumeToken),ua(n.remoteStore,o)}for(let i of t)n.Iu.has(i)&&(yield Cr(n.localStore,i,!1).then(()=>{Dr(n.remoteStore,i),kr(n,i)}).catch(Zt))}})}function la(r){let e=F(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Fg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=LE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=NE.bind(null,e),e.Pu.H_=AE.bind(null,e.eventManager),e.Pu.yu=bE.bind(null,e.eventManager),e}function vh(r){let e=F(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=kE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=VE.bind(null,e),e}var Ah=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return g(this,null,function*(){this.serializer=aa(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)})}Fu(t,n){return null}Mu(t,n){return null}vu(t){return Tg(this.persistence,new Do,t.initialUser,this.serializer)}Cu(t){return new qi(Po.mi,this.serializer)}Du(t){return new Oo}terminate(){return g(this,null,function*(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),Ol=class extends Ah{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){U(this.persistence.referenceDelegate instanceof Co,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new bo(n,e.asyncQueue,t)}Cu(e){let t=this.cacheSizeBytes!==void 0?Oe.withCacheSize(this.cacheSizeBytes):Oe.DEFAULT;return new qi(n=>Co.mi(n,t),this.serializer)}},jo=class r extends Ah{constructor(e,t,n){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield tt(r.prototype,this,"initialize").call(this,e),yield this.xu.initialize(this,e),yield vh(this.xu.syncEngine),yield xr(this.xu.remoteStore),yield this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(e){return Tg(this.persistence,new Do,e.initialUser,this.serializer)}Fu(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new bo(n,e.asyncQueue,t)}Mu(e,t){let n=new ou(t,this.persistence);return new su(e.asyncQueue,n)}Cu(e){let t=Eg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Oe.withCacheSize(this.cacheSizeBytes):Oe.DEFAULT;return new al(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Ng(),Qs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new Oo}},xl=class r extends jo{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return g(this,null,function*(){yield tt(r.prototype,this,"initialize").call(this,e);let t=this.xu.syncEngine;this.sharedClientState instanceof Ti&&(this.sharedClientState.syncEngine={Co:UE.bind(null,t),vo:zE.bind(null,t),Fo:jE.bind(null,t),Ts:qE.bind(null,t),Do:FE.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.Ji(n=>g(this,null,function*(){yield BE(this.xu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Du(e){let t=Ng();if(!Ti.v(t))throw new V(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Eg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ti(t,e.asyncQueue,n,e.clientId,e.initialUser)}},bh=(()=>{class r{initialize(t,n){return g(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Hp(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=xE.bind(null,this.syncEngine),yield Al(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new Rl})()}createDatastore(t){let n=aa(t.databaseInfo.databaseId),i=(function(o){return new _l(o)})(t.databaseInfo);return(function(o,c,u,h){return new El(o,c,u,h)})(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return(function(i,s,o,c,u){return new vl(i,s,o,c,u)})(this.localStore,this.datastore,t.asyncQueue,n=>Hp(this.syncEngine,n,0),(function(){return xo.v()?new xo:new fl})())}createSyncEngine(t,n){return(function(s,o,c,u,h,f,m){let y=new kl(s,o,c,u,h,f);return m&&(y.gu=!0),y})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return g(this,null,function*(){yield(function(n){return g(this,null,function*(){let i=F(n);D(Mn,"RemoteStore shutting down."),i.Ea.add(5),yield Zi(i),i.Aa.shutdown(),i.Ra.set("Unknown")})})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()})}}return r.provider={build:()=>new r},r})();var Gi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):de("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Yt="FirestoreClient",Ll=class{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=ve.UNAUTHENTICATED,this.clientId=Ai.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,o=>g(this,null,function*(){D(Yt,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(n,o=>(D(Yt,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new $e;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=mh(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function Kc(r,e){return g(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),D(Yt,"Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>g(null,null,function*(){n.isEqual(i)||(yield vg(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e})}function Jp(r,e){return g(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield GE(r);D(Yt,"Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>$p(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>$p(e.remoteStore,i)),r._onlineComponents=e})}function GE(r){return g(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){D(Yt,"Using user provided OfflineComponentProvider");try{yield Kc(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===C.FAILED_PRECONDITION||i.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;vi("Error using user provided cache. Falling back to memory cache: "+t),yield Kc(r,new Ah)}}else D(Yt,"Using default OfflineComponentProvider"),yield Kc(r,new Ol(void 0));return r._offlineComponents})}function qg(r){return g(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(D(Yt,"Using user provided OnlineComponentProvider"),yield Jp(r,r._uninitializedComponentsProvider._online)):(D(Yt,"Using default OnlineComponentProvider"),yield Jp(r,new bh))),r._onlineComponents})}function $E(r){return qg(r).then(e=>e.syncEngine)}function Go(r){return g(this,null,function*(){let e=yield qg(r),t=e.eventManager;return t.onListen=SE.bind(null,e.syncEngine),t.onUnlisten=PE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=RE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=CE.bind(null,e.syncEngine),t})}function WE(r,e,t={}){let n=new $e;return r.asyncQueue.enqueueAndForget(()=>g(null,null,function*(){return(function(s,o,c,u,h){let f=new Gi({next:y=>{f.Nu(),o.enqueueAndForget(()=>_h(s,m));let P=y.docs.has(c);!P&&y.fromCache?h.reject(new V(C.UNAVAILABLE,"Failed to get document because the client is offline.")):P&&y.fromCache&&u&&u.source==="server"?h.reject(new V(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new ji(Yi(c.path),f,{includeMetadataChanges:!0,qa:!0});return gh(s,m)})(yield Go(r),r.asyncQueue,e,t,n)})),n.promise}function KE(r,e,t={}){let n=new $e;return r.asyncQueue.enqueueAndForget(()=>g(null,null,function*(){return(function(s,o,c,u,h){let f=new Gi({next:y=>{f.Nu(),o.enqueueAndForget(()=>_h(s,m)),y.fromCache&&u.source==="server"?h.reject(new V(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),m=new ji(c,f,{includeMetadataChanges:!0,qa:!0});return gh(s,m)})(yield Go(r),r.asyncQueue,e,t,n)})),n.promise}function zg(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}var Yp=new Map;var HE="firestore.googleapis.com",Xp=!0,$o=class{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new V(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=HE,this.ssl=Xp}else this.host=e.host,this.ssl=e.ssl??Xp;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=pg;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yg)throw new V(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ZI("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=zg(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new V(C.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,i){return n.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},$i=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $o({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new V(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $o(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new Jc;switch(n.type){case"firstParty":return new Zc(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new V(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return g(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let n=Yp.get(t);n&&(D("ComponentProvider","Removing Datastore"),Yp.delete(t),n.terminate())})(this),Promise.resolve()}};var Xt=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},Ie=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ft(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Hi(t,r._jsonSchema))return new r(e,n||null,new L(ee.fromString(t.referencePath)))}};Ie._jsonSchemaVersion="firestore/documentReference/1.0",Ie._jsonSchema={type:me("string",Ie._jsonSchemaVersion),referencePath:me("string")};var Ft=class r extends Xt{constructor(e,t,n){super(e,t,Yi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Ie(this.firestore,null,new L(e))}withConverter(e){return new r(this.firestore,e,this._path)}};function jg(r,e,...t){if(r=ue(r),om("collection","path",e),r instanceof $i){let n=ee.fromString(e,...t);return Hf(n),new Ft(r,null,n)}{if(!(r instanceof Ie||r instanceof Ft))throw new V(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(ee.fromString(e,...t));return Hf(n),new Ft(r.firestore,null,n)}}function ha(r,e,...t){if(r=ue(r),arguments.length===1&&(e=Ai.newId()),om("doc","path",e),r instanceof $i){let n=ee.fromString(e,...t);return Kf(n),new Ie(r,null,new L(n))}{if(!(r instanceof Ie||r instanceof Ft))throw new V(C.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(ee.fromString(e,...t));return Kf(n),new Ie(r.firestore,r instanceof Ft?r.converter:null,new L(n))}}var Zp="AsyncQueue",Wo=class{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Lo(this,"async_queue_retry"),this._c=()=>{let n=Qs();n&&D(Zp,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;let t=Qs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=Qs();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new $e;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return g(this,null,function*(){if(this.Xu.length!==0){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!en(e))throw e;D(Zp,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(n=>{throw this.nc=n,this.rc=!1,de("INTERNAL UNHANDLED ERROR: ",em(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let i=bl.createAndSchedule(this,e,t,n,s=>this.hc(s));return this.tc.push(i),i}uc(){this.nc&&M(47125,{Pc:em(this.nc)})}verifyOperationInProgress(){}Tc(){return g(this,null,function*(){let e;do e=this.ac,yield e;while(e!==this.ac)})}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}};function em(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}function tm(r){return(function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1})(r,["next","error","complete"])}var Ye=class extends $i{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Wo,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return g(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Wo(e),this._firestoreClient=void 0,yield e}})}};function Gg(r,e,t){t||(t=so);let n=oi(r,"firestore");if(n.isInitialized(t)){let i=n.getImmediate({identifier:t}),s=n.getOptions(t);if(nt(s,e))return i;throw new V(C.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new V(C.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yg)throw new V(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return e.host&&Pt(e.host)&&Ds(e.host),n.initialize({options:e,instanceIdentifier:t})}function es(r){if(r._terminated)throw new V(C.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||QE(r),r._firestoreClient}function QE(r){let e=r._freezeSettings(),t=(function(i,s,o,c){return new lu(i,s,o,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,zg(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)})(r._databaseId,r._app?.options.appId||"",r._persistenceKey,e);r._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new Ll(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&(function(i){let s=i?._online.build();return{_offline:i?._offline.build(s),_online:s}})(r._componentsProvider))}var Ut=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(ge.fromBase64String(e))}catch(t){throw new V(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(ge.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Hi(e,r._jsonSchema))return r.fromBase64String(e.bytes)}};Ut._jsonSchemaVersion="firestore/bytes/1.0",Ut._jsonSchema={type:me("string",Ut._jsonSchemaVersion),bytes:me("string")};var Fn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new V(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Vr=class{constructor(e){this._methodName=e}};var Bt=class r{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return G(this._lat,e._lat)||G(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(e){if(Hi(e,r._jsonSchema))return new r(e.latitude,e.longitude)}};Bt._jsonSchemaVersion="firestore/geoPoint/1.0",Bt._jsonSchema={type:me("string",Bt._jsonSchemaVersion),latitude:me("number"),longitude:me("number")};var qt=class r{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Hi(e,r._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new r(e.vectorValues);throw new V(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};qt._jsonSchemaVersion="firestore/vectorValue/1.0",qt._jsonSchema={type:me("string",qt._jsonSchemaVersion),vectorValues:me("object")};var JE=/^__.*__$/,Ml=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Je(e,this.data,this.fieldMask,t,this.fieldTransforms):new Qt(e,this.data,t,this.fieldTransforms)}},Ko=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Je(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function $g(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ac:r})}}var Fl=class r{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new r(W(W({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Qo(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if($g(this.Ac)&&JE.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}},Ul=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||aa(e)}Cc(e,t,n,i=!1){return new Fl({Ac:e,methodName:t,Dc:n,path:ye.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function da(r){let e=r._freezeSettings(),t=aa(r._databaseId);return new Ul(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Wg(r,e,t,n,i,s={}){let o=r.Cc(s.merge||s.mergeFields?2:0,e,t,i);Sh("Data must be an object, but it was:",o,n);let c=Qg(n,o),u,h;if(s.merge)u=new Be(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let y=ql(e,m,t);if(!o.contains(y))throw new V(C.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);Yg(f,y)||f.push(y)}u=new Be(f),h=o.fieldTransforms.filter(m=>u.covers(m.field))}else u=null,h=o.fieldTransforms;return new Ml(new Ne(c),u,h)}var Ho=class r extends Vr{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};var Bl=class r extends Vr{_toFieldTransform(e){return new lo(e.path,new Wt)}isEqual(e){return e instanceof r}};function Kg(r,e,t,n){let i=r.Cc(1,e,t);Sh("Data must be an object, but it was:",i,n);let s=[],o=Ne.empty();tn(n,(u,h)=>{let f=Rh(e,u,t);h=ue(h);let m=i.yc(f);if(h instanceof Ho)s.push(f);else{let y=ts(h,m);y!=null&&(s.push(f),o.set(f,y))}});let c=new Be(s);return new Ko(o,c,i.fieldTransforms)}function Hg(r,e,t,n,i,s){let o=r.Cc(1,e,t),c=[ql(e,n,t)],u=[i];if(s.length%2!=0)throw new V(C.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)c.push(ql(e,s[y])),u.push(s[y+1]);let h=[],f=Ne.empty();for(let y=c.length-1;y>=0;--y)if(!Yg(h,c[y])){let P=c[y],k=u[y];k=ue(k);let O=o.yc(P);if(k instanceof Ho)h.push(P);else{let N=ts(k,O);N!=null&&(h.push(P),f.set(P,N))}}let m=new Be(h);return new Ko(f,m,o.fieldTransforms)}function YE(r,e,t,n=!1){return ts(t,r.Cc(n?4:3,e))}function ts(r,e){if(Jg(r=ue(r)))return Sh("Unsupported field value:",e,r),Qg(r,e);if(r instanceof Vr)return(function(n,i){if(!$g(i.Ac))throw i.Sc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Sc(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(n,i){let s=[],o=0;for(let c of n){let u=ts(c,i.wc(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}})(r,e)}return(function(n,i){if((n=ue(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Lw(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=se.fromDate(n);return{timestampValue:Sr(i.serializer,s)}}if(n instanceof se){let s=new se(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Sr(i.serializer,s)}}if(n instanceof Bt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Ut)return{bytesValue:Zm(i.serializer,n._byteString)};if(n instanceof Ie){let s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:uh(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof qt)return(function(o,c){return{mapValue:{fields:{[ih]:{stringValue:sh},[Er]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw c.Sc("VectorValues must only contain numeric values.");return ch(c.serializer,h)})}}}}}})(n,i);throw i.Sc(`Unsupported field value: ${Zo(n)}`)})(r,e)}function Qg(r,e){let t={};return vm(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):tn(r,(n,i)=>{let s=ts(i,e.mc(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function Jg(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof se||r instanceof Bt||r instanceof Ut||r instanceof Ie||r instanceof Vr||r instanceof qt)}function Sh(r,e,t){if(!Jg(t)||!am(t)){let n=Zo(t);throw n==="an object"?e.Sc(r+" a custom object"):e.Sc(r+" "+n)}}function ql(r,e,t){if((e=ue(e))instanceof Fn)return e._internalPath;if(typeof e=="string")return Rh(r,e);throw Qo("Field path arguments must be of type string or ",r,!1,void 0,t)}var XE=new RegExp("[~\\*/\\[\\]]");function Rh(r,e,t){if(e.search(XE)>=0)throw Qo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Fn(...e.split("."))._internalPath}catch{throw Qo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Qo(r,e,t,n,i){let s=n&&!n.isEmpty(),o=i!==void 0,c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${n}`),o&&(u+=` in document ${i}`),u+=")"),new V(C.INVALID_ARGUMENT,c+r+u)}function Yg(r,e){return r.some(t=>t.isEqual(e))}var Jo=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ie(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new zl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(fa("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},zl=class extends Jo{data(){return super.data()}};function fa(r,e){return typeof e=="string"?Rh(r,e):e instanceof Fn?e._internalPath:e._delegate._internalPath}function Xg(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new V(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Wi=class{},Yo=class extends Wi{};function Ph(r,e,...t){let n=[];e instanceof Wi&&n.push(e),n=n.concat(t),(function(s){let o=s.filter(u=>u instanceof jl).length,c=s.filter(u=>u instanceof Xo).length;if(o>1||o>0&&c>0)throw new V(C.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(let i of n)r=i._apply(r);return r}var Xo=class r extends Yo{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return Zg(e._query,t),new Xt(e.firestore,e.converter,vu(e._query,t))}_parse(e){let t=da(e.firestore);return(function(s,o,c,u,h,f,m){let y;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new V(C.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){rm(m,f);let k=[];for(let O of m)k.push(nm(u,s,O));y={arrayValue:{values:k}}}else y=nm(u,s,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||rm(m,f),y=YE(c,o,m,f==="in"||f==="not-in");return J.create(h,f,y)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function ZE(r,e,t){let n=e,i=fa("where",r);return Xo._create(i,n,t)}var jl=class r extends Wi{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:te.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let o=i,c=s.getFlattenedFilters();for(let u of c)Zg(o,u),o=vu(o,u)})(e._query,t),new Xt(e.firestore,e.converter,vu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Gl=class r extends Yo{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=(function(i,s,o){if(i.startAt!==null)throw new V(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new V(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Nn(s,o)})(e._query,this._field,this._direction);return new Xt(e.firestore,e.converter,(function(i,s){let o=i.explicitOrderBy.concat([s]);return new $t(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function eT(r,e="asc"){let t=e,n=fa("orderBy",r);return Gl._create(n,t)}function nm(r,e,t){if(typeof(t=ue(t))=="string"){if(t==="")throw new V(C.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fm(e)&&t.indexOf("/")!==-1)throw new V(C.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(ee.fromString(t));if(!L.isDocumentKey(n))throw new V(C.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Vi(r,new L(n))}if(t instanceof Ie)return Vi(r,t._key);throw new V(C.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zo(t)}.`)}function rm(r,e){if(!Array.isArray(r)||r.length===0)throw new V(C.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Zg(r,e){let t=(function(i,s){for(let o of i)for(let c of o.getFlattenedFilters())if(s.indexOf(c.op)>=0)return c.op;return null})(r.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new V(C.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new V(C.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var $l=class{convertValue(e,t="none"){switch(zt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ce(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_t(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return tn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){let t=e.fields?.[Er].arrayValue?.values?.map(n=>ce(n.doubleValue));return new qt(t)}convertGeoPoint(e){return new Bt(ce(e.latitude),ce(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=ia(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ni(e));default:return null}}convertTimestamp(e){let t=gt(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ee.fromString(e);U(ug(n),9688,{name:e});let i=new wr(n.get(1),n.get(3)),s=new L(n.popFirst(5));return i.isEqual(t)||de(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function e_(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}var vn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Pn=class r extends Jo{constructor(e,t,n,i,s,o){super(e,t,n,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(fa("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=r._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Pn._jsonSchemaVersion="firestore/documentSnapshot/1.0",Pn._jsonSchema={type:me("string",Pn._jsonSchemaVersion),bundleSource:me("string","DocumentSnapshot"),bundleName:me("string"),bundle:me("string")};var hr=class extends Pn{data(e={}){return super.data(e)}},Cn=class r{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new vn(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new hr(this._firestore,this._userDataWriter,n.key,n,new vn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(c=>{let u=new hr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new vn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(c=>s||c.type!==3).map(c=>{let u=new hr(i._firestore,i._userDataWriter,c.doc.key,c.doc,new vn(i._snapshot.mutatedKeys.has(c.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return c.type!==0&&(h=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),f=o.indexOf(c.doc.key)),{type:tT(c.type),doc:u,oldIndex:h,newIndex:f}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=r._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ai.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function tT(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:r})}}function t_(r){r=ze(r,Ie);let e=ze(r.firestore,Ye);return WE(es(e),r._key).then(t=>s_(e,r,t))}Cn._jsonSchemaVersion="firestore/querySnapshot/1.0",Cn._jsonSchema={type:me("string",Cn._jsonSchemaVersion),bundleSource:me("string","QuerySnapshot"),bundleName:me("string"),bundle:me("string")};var Ki=class extends $l{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ut(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ie(this.firestore,null,t)}};function n_(r){r=ze(r,Xt);let e=ze(r.firestore,Ye),t=es(e),n=new Ki(e);return Xg(r._query),KE(t,r._query).then(i=>new Cn(e,n,r,i))}function Ch(r,e,t){r=ze(r,Ie);let n=ze(r.firestore,Ye),i=e_(r.converter,e,t);return pa(n,[Wg(da(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,Re.none())])}function r_(r,e,t,...n){r=ze(r,Ie);let i=ze(r.firestore,Ye),s=da(i),o;return o=typeof(e=ue(e))=="string"||e instanceof Fn?Hg(s,"updateDoc",r._key,e,t,n):Kg(s,"updateDoc",r._key,e),pa(i,[o.toMutation(r._key,Re.exists(!0))])}function i_(r){return pa(ze(r.firestore,Ye),[new On(r._key,Re.none())])}function Dh(r,...e){r=ue(r);let t={includeMetadataChanges:!1,source:"default"},n=0;typeof e[n]!="object"||tm(e[n])||(t=e[n++]);let i={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(tm(e[n])){let u=e[n];e[n]=u.next?.bind(u),e[n+1]=u.error?.bind(u),e[n+2]=u.complete?.bind(u)}let s,o,c;if(r instanceof Ie)o=ze(r.firestore,Ye),c=Yi(r._key.path),s={next:u=>{e[n]&&e[n](s_(o,r,u))},error:e[n+1],complete:e[n+2]};else{let u=ze(r,Xt);o=ze(u.firestore,Ye),c=u._query;let h=new Ki(o);s={next:f=>{e[n]&&e[n](new Cn(o,h,u,f))},error:e[n+1],complete:e[n+2]},Xg(r._query)}return(function(h,f,m,y){let P=new Gi(y),k=new ji(f,P,m);return h.asyncQueue.enqueueAndForget(()=>g(null,null,function*(){return gh(yield Go(h),k)})),()=>{P.Nu(),h.asyncQueue.enqueueAndForget(()=>g(null,null,function*(){return _h(yield Go(h),k)}))}})(es(o),c,i,s)}function pa(r,e){return(function(n,i){let s=new $e;return n.asyncQueue.enqueueAndForget(()=>g(null,null,function*(){return DE(yield $E(n),i,s)})),s.promise})(es(r),e)}function s_(r,e,t){let n=t.docs.get(e._key),i=new Ki(r);return new Pn(r,i,e._key,n,new vn(t.hasPendingWrites,t.fromCache),e.converter)}var Wl=class{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=nT(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}};function o_(r){return new Wl(r)}var Kl=class{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=bh.provider,this._offlineComponentProvider={build:t=>new jo(t,e?.cacheSizeBytes,this.forceOwnership)}}},Hl=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=bh.provider,this._offlineComponentProvider={build:t=>new xl(t,e?.cacheSizeBytes)}}};function nT(r){return new Kl(r?.forceOwnership)}function a_(){return new Hl}var Ql=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=da(e)}set(e,t,n){this._verifyNotCommitted();let i=Hc(e,this._firestore),s=e_(i.converter,t,n),o=Wg(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(o.toMutation(i._key,Re.none())),this}update(e,t,n,...i){this._verifyNotCommitted();let s=Hc(e,this._firestore),o;return o=typeof(t=ue(t))=="string"||t instanceof Fn?Hg(this._dataReader,"WriteBatch.update",s._key,t,n,i):Kg(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Re.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Hc(e,this._firestore);return this._mutations=this._mutations.concat(new On(t._key,Re.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Hc(r,e){if((r=ue(r)).firestore!==e)throw new V(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function rn(){return new Bl("serverTimestamp")}function c_(r){return es(r=ze(r,Ye)),new Ql(r,e=>pa(r,e))}(function(e,t=!0){(function(i){Or=i})(kt),Nt(new Ge("firestore",(n,{instanceIdentifier:i,options:s})=>{let o=n.getProvider("app").getImmediate(),c=new Ye(new Yc(n.getProvider("auth-internal")),new eu(o,n.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new V(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wr(h.options.projectId,f)})(o,i),o);return s=W({useFetchStreams:t},s),c._setSettings(s),c},"PUBLIC").setMultipleInstances(!0)),Ke(Gf,$f,e),Ke(Gf,$f,"esm2020")})();var rT="firebase",iT="12.7.0";Ke(rT,iT,"app");function v_(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var A_=v_,b_=new ht("auth","Firebase",v_());var wa=new Ct("@firebase/auth");function sT(r,...e){wa.logLevel<=Q.WARN&&wa.warn(`Auth (${kt}): ${r}`,...e)}function ga(r,...e){wa.logLevel<=Q.ERROR&&wa.error(`Auth (${kt}): ${r}`,...e)}function lt(r,...e){throw Hh(r,...e)}function Xe(r,...e){return Hh(r,...e)}function Kh(r,e,t){let n=Te(W({},A_()),{[e]:t});return new ht("auth","Firebase",n).create(e,{appName:r.name})}function Bn(r){return Kh(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function oT(r,e,t){let n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&lt(r,"argument-error"),Kh(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Hh(r,...e){if(typeof r!="string"){let t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return b_.create(r,...e)}function j(r,e,...t){if(!r)throw Hh(e,...t)}function yt(r){let e="INTERNAL ASSERTION FAILED: "+r;throw ga(e),new Error(e)}function wt(r,e){r||yt(e)}function Vh(){return typeof self<"u"&&self.location?.href||""}function aT(){return u_()==="http:"||u_()==="https:"}function u_(){return typeof self<"u"&&self.location?.protocol||null}function cT(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(aT()||Tf()||"connection"in navigator)?navigator.onLine:!0}function uT(){if(typeof navigator>"u")return null;let r=navigator;return r.languages&&r.languages[0]||r.language||null}var qn=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,wt(t>e,"Short delay should be less than long delay!"),this.isMobile=If()||vf()}get(){return cT()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Qh(r,e){wt(r.emulator,"Emulator should always be set here");let{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Ea=class{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;yt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;yt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;yt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var lT={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var hT=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],dT=new qn(3e4,6e4);function Jh(r,e){return r.tenantId&&!e.tenantId?Te(W({},e),{tenantId:r.tenantId}):e}function Ur(s,o,c,u){return g(this,arguments,function*(r,e,t,n,i={}){return S_(r,i,()=>g(null,null,function*(){let h={},f={};n&&(e==="GET"?f=n:h={body:JSON.stringify(n)});let m=Qn(W({key:r.config.apiKey},f)).slice(1),y=yield r._getAdditionalHeaders();y["Content-Type"]="application/json",r.languageCode&&(y["X-Firebase-Locale"]=r.languageCode);let P=W({method:e,headers:y},h);return Ef()||(P.referrerPolicy="no-referrer"),r.emulatorConfig&&Pt(r.emulatorConfig.host)&&(P.credentials="include"),Ea.fetch()(yield R_(r,r.config.apiHost,t,m),P)}))})}function S_(r,e,t){return g(this,null,function*(){r._canInitEmulator=!1;let n=W(W({},lT),e);try{let i=new Oh(r),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw ma(r,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let c=s.ok?o.errorMessage:o.error.message,[u,h]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ma(r,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw ma(r,"email-already-in-use",o);if(u==="USER_DISABLED")throw ma(r,"user-disabled",o);let f=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(h)throw Kh(r,f,h);lt(r,f)}}catch(i){if(i instanceof Le)throw i;lt(r,"network-request-failed",{message:String(i)})}})}function fT(s,o,c,u){return g(this,arguments,function*(r,e,t,n,i={}){let h=yield Ur(r,e,t,n,i);return"mfaPendingCredential"in h&&lt(r,"multi-factor-auth-required",{_serverResponse:h}),h})}function R_(r,e,t,n){return g(this,null,function*(){let i=`${e}${t}?${n}`,s=r,o=s.config.emulator?Qh(r.config,i):`${r.config.apiScheme}://${i}`;return hT.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}var Oh=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Xe(this.auth,"network-request-failed")),dT.get())})}};function ma(r,e,t){let n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);let i=Xe(r,e,n);return i.customData._tokenResponse=t,i}function pT(r,e){return g(this,null,function*(){return Ur(r,"POST","/v1/accounts:delete",e)})}function Ta(r,e){return g(this,null,function*(){return Ur(r,"POST","/v1/accounts:lookup",e)})}function ns(r){if(r)try{let e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function P_(r,e=!1){return g(this,null,function*(){let t=ue(r),n=yield t.getIdToken(e),i=Yh(n);j(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let s=typeof i.firebase=="object"?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:n,authTime:ns(Nh(i.auth_time)),issuedAtTime:ns(Nh(i.iat)),expirationTime:ns(Nh(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function Nh(r){return Number(r)*1e3}function Yh(r){let[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return ga("JWT malformed, contained fewer than 3 sections"),null;try{let i=Ps(t);return i?JSON.parse(i):(ga("Failed to decode base64 JWT payload"),null)}catch(i){return ga("Caught error parsing JWT payload as JSON",i?.toString()),null}}function l_(r){let e=Yh(r);return j(e,"internal-error"),j(typeof e.exp<"u","internal-error"),j(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function is(r,e,t=!1){return g(this,null,function*(){if(t)return e;try{return yield e}catch(n){throw n instanceof Le&&mT(n)&&r.auth.currentUser===r&&(yield r.auth.signOut()),n}})}function mT({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}var xh=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){let t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;let n=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,n)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>g(this,null,function*(){yield this.iteration()}),t)}iteration(){return g(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var ss=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ns(this.lastLoginAt),this.creationTime=ns(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function va(r){return g(this,null,function*(){let e=r.auth,t=yield r.getIdToken(),n=yield is(r,Ta(e,{idToken:t}));j(n?.users.length,e,"internal-error");let i=n.users[0];r._notifyReloadListener(i);let s=i.providerUserInfo?.length?D_(i.providerUserInfo):[],o=gT(r.providerData,s),c=r.isAnonymous,u=!(r.email&&i.passwordHash)&&!o?.length,h=c?u:!1,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new ss(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(r,f)})}function C_(r){return g(this,null,function*(){let e=ue(r);yield va(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function gT(r,e){return[...r.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function D_(r){return r.map(n=>{var i=n,{providerId:e}=i,t=Kn(i,["providerId"]);return{providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}})}function _T(r,e){return g(this,null,function*(){let t=yield S_(r,{},()=>g(null,null,function*(){let n=Qn({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=r.config,o=yield R_(r,i,"/v1/token",`key=${s}`),c=yield r._getAdditionalHeaders();c["Content-Type"]="application/x-www-form-urlencoded";let u={method:"POST",headers:c,body:n};return r.emulatorConfig&&Pt(r.emulatorConfig.host)&&(u.credentials="include"),Ea.fetch()(o,u)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function yT(r,e){return g(this,null,function*(){return Ur(r,"POST","/v2/accounts:revokeToken",Jh(r,e))})}var rs=class r{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){j(e.idToken,"internal-error"),j(typeof e.idToken<"u","internal-error"),j(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):l_(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){j(e.length!==0,"internal-error");let t=l_(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return g(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(j(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return g(this,null,function*(){let{accessToken:n,refreshToken:i,expiresIn:s}=yield _T(e,t);this.updateTokensAndExpiration(n,i,Number(s))})}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:s}=t,o=new r;return n&&(j(typeof n=="string","internal-error",{appName:e}),o.refreshToken=n),i&&(j(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(j(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new r,this.toJSON())}_performRefresh(){return yt("not implemented")}};function sn(r,e){j(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}var on=class r{constructor(s){var o=s,{uid:e,auth:t,stsTokenManager:n}=o,i=Kn(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new xh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new ss(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return g(this,null,function*(){let t=yield is(this,this.stsTokenManager.getToken(this.auth,e));return j(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return P_(this,e)}reload(){return C_(this)}_assign(e){this!==e&&(j(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>W({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new r(Te(W({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){j(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return g(this,null,function*(){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&(yield va(this)),yield this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)})}delete(){return g(this,null,function*(){if(Me(this.auth.app))return Promise.reject(Bn(this.auth));let e=yield this.getIdToken();return yield is(this,pT(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Te(W({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>W({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,i=t.email??void 0,s=t.phoneNumber??void 0,o=t.photoURL??void 0,c=t.tenantId??void 0,u=t._redirectEventId??void 0,h=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:m,emailVerified:y,isAnonymous:P,providerData:k,stsTokenManager:O}=t;j(m&&O,e,"internal-error");let N=rs.fromJSON(this.name,O);j(typeof m=="string",e,"internal-error"),sn(n,e.name),sn(i,e.name),j(typeof y=="boolean",e,"internal-error"),j(typeof P=="boolean",e,"internal-error"),sn(s,e.name),sn(o,e.name),sn(c,e.name),sn(u,e.name),sn(h,e.name),sn(f,e.name);let $=new r({uid:m,auth:e,email:i,emailVerified:y,displayName:n,isAnonymous:P,photoURL:o,phoneNumber:s,tenantId:c,stsTokenManager:N,createdAt:h,lastLoginAt:f});return k&&Array.isArray(k)&&($.providerData=k.map(z=>W({},z))),u&&($._redirectEventId=u),$}static _fromIdTokenResponse(e,t,n=!1){return g(this,null,function*(){let i=new rs;i.updateFromServerResponse(t);let s=new r({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return yield va(s),s})}static _fromGetAccountInfoResponse(e,t,n){return g(this,null,function*(){let i=t.users[0];j(i.localId!==void 0,"internal-error");let s=i.providerUserInfo!==void 0?D_(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!s?.length,c=new rs;c.updateFromIdToken(n);let u=new r({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:o}),h={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new ss(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!s?.length};return Object.assign(u,h),u})}};var h_=new Map;function It(r){wt(r instanceof Function,"Expected a class definition");let e=h_.get(r);return e?(wt(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,h_.set(r,e),e)}var IT=(()=>{class r{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return g(this,null,function*(){return!0})}_set(t,n){return g(this,null,function*(){this.storage[t]=n})}_get(t){return g(this,null,function*(){let n=this.storage[t];return n===void 0?null:n})}_remove(t){return g(this,null,function*(){delete this.storage[t]})}_addListener(t,n){}_removeListener(t,n){}}return r.type="NONE",r})(),Lh=IT;function _a(r,e,t){return`firebase:${r}:${e}:${t}`}var Aa=class r{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:i,name:s}=this.auth;this.fullUserKey=_a(this.userKey,i.apiKey,s),this.fullPersistenceKey=_a("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return g(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield Ta(this.auth,{idToken:e}).catch(()=>{});return t?on._fromGetAccountInfoResponse(this.auth,t,e):null}return on._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return g(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return g(this,null,function*(){if(!t.length)return new r(It(Lh),e,n);let i=(yield Promise.all(t.map(h=>g(null,null,function*(){if(yield h._isAvailable())return h})))).filter(h=>h),s=i[0]||It(Lh),o=_a(n,e.config.apiKey,e.name),c=null;for(let h of t)try{let f=yield h._get(o);if(f){let m;if(typeof f=="string"){let y=yield Ta(e,{idToken:f}).catch(()=>{});if(!y)break;m=yield on._fromGetAccountInfoResponse(e,y,f)}else m=on._fromJSON(e,f);h!==s&&(c=m),s=h;break}}catch{}let u=i.filter(h=>h._shouldAllowMigration);return!s._shouldAllowMigration||!u.length?new r(s,e,n):(s=u[0],c&&(yield s._set(o,c.toJSON())),yield Promise.all(t.map(h=>g(null,null,function*(){if(h!==s)try{yield h._remove(o)}catch{}}))),new r(s,e,n))})}};function d_(r){let e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(O_(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(N_(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(L_(e))return"Blackberry";if(M_(e))return"Webos";if(k_(e))return"Safari";if((e.includes("chrome/")||V_(e))&&!e.includes("edge/"))return"Chrome";if(x_(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if(n?.length===2)return n[1]}return"Other"}function N_(r=he()){return/firefox\//i.test(r)}function k_(r=he()){let e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function V_(r=he()){return/crios\//i.test(r)}function O_(r=he()){return/iemobile/i.test(r)}function x_(r=he()){return/android/i.test(r)}function L_(r=he()){return/blackberry/i.test(r)}function M_(r=he()){return/webos/i.test(r)}function Xh(r=he()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function wT(r=he()){return Xh(r)&&!!window.navigator?.standalone}function ET(){return Af()&&document.documentMode===10}function F_(r=he()){return Xh(r)||x_(r)||M_(r)||L_(r)||/windows phone/i.test(r)||O_(r)}function U_(r,e=[]){let t;switch(r){case"Browser":t=d_(he());break;case"Worker":t=`${d_(he())}-${r}`;break;default:t=r}let n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${kt}/${n}`}var Mh=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=s=>new Promise((o,c)=>{try{let u=e(s);o(u)}catch(u){c(u)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return g(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)yield n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}})}};function TT(t){return g(this,arguments,function*(r,e={}){return Ur(r,"GET","/v2/passwordPolicy",Jh(r,e))})}var vT=6,Fh=class{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??vT,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var Uh=class{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ba(this),this.idTokenSubscription=new ba(this),this.beforeStateQueue=new Mh(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=b_,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=It(t)),this._initializationPromise=this.queue(()=>g(this,null,function*(){if(!this._deleted&&(this.persistenceManager=yield Aa.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return g(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return g(this,null,function*(){try{let t=yield Ta(this,{idToken:e}),n=yield on._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return g(this,null,function*(){if(Me(this.app)){let s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}let t=yield this.assertedPersistence.getCurrentUser(),n=t,i=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let s=this.redirectUser?._redirectEventId,o=n?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!s||s===o)&&c?.user&&(n=c.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{yield this.beforeStateQueue.runMiddleware(n)}catch(s){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return j(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)})}tryRedirectSignIn(e){return g(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return g(this,null,function*(){try{yield va(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=uT()}_delete(){return g(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return g(this,null,function*(){if(Me(this.app))return Promise.reject(Bn(this));let t=e?ue(e):null;return t&&j(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return g(this,null,function*(){if(!this._deleted)return e&&j(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>g(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return g(this,null,function*(){return Me(this.app)?Promise.reject(Bn(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Me(this.app)?Promise.reject(Bn(this)):this.queue(()=>g(this,null,function*(){yield this.assertedPersistence.setPersistence(It(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return g(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return g(this,null,function*(){let e=yield TT(this),t=new Fh(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ht("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}revokeAccessToken(e){return g(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),yield yT(this,n)}})}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}_setRedirectUser(e,t){return g(this,null,function*(){let n=yield this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return g(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&It(e)||this._popupRedirectResolver;j(t,this,"argument-error"),this.redirectPersistenceManager=yield Aa.create(this,[It(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return g(this,null,function*(){return this._isInitialized&&(yield this.queue(()=>g(this,null,function*(){}))),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null})}_persistUserIfCurrent(e){return g(this,null,function*(){if(e===this.currentUser)return this.queue(()=>g(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,c=this._isInitialized?Promise.resolve():this._initializationPromise;if(j(c,this,"internal-error"),c.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let u=e.addObserver(t,n,i);return()=>{o=!0,u()}}else{let u=e.addObserver(t);return()=>{o=!0,u()}}}directlySetCurrentUser(e){return g(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return j(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=U_(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return g(this,null,function*(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=yield this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=yield this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e})}_getAppCheckToken(){return g(this,null,function*(){if(Me(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=yield this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&sT(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function Va(r){return ue(r)}var ba=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Rf(t=>this.observer=t)}get next(){return j(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Zh={loadJS(){return g(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function AT(r){Zh=r}function bT(r){return Zh.loadJS(r)}function ST(){return Zh.gapiScript}function B_(r){return`__${r}${Math.floor(Math.random()*1e6)}`}function q_(r,e){let t=oi(r,"auth");if(t.isInitialized()){let i=t.getImmediate(),s=t.getOptions();if(nt(s,e??{}))return i;lt(i,"already-initialized")}return t.initialize({options:e})}function RT(r,e){let t=e?.persistence||[],n=(Array.isArray(t)?t:[t]).map(It);e?.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e?.popupRedirectResolver)}function z_(r,e,t){let n=Va(r);j(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");let i=!!t?.disableWarnings,s=j_(e),{host:o,port:c}=PT(e),u=c===null?"":`:${c}`,h={url:`${s}//${o}${u}/`},f=Object.freeze({host:o,port:c,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){j(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),j(nt(h,n.config.emulator)&&nt(f,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=h,n.emulatorConfig=f,n.settings.appVerificationDisabledForTesting=!0,Pt(o)?(Ds(`${s}//${o}${u}`),mc("Auth",!0)):i||CT()}function j_(r){let e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function PT(r){let e=j_(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};let n=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let s=i[1];return{host:s,port:f_(n.substr(s.length+1))}}else{let[s,o]=n.split(":");return{host:s,port:f_(o)}}}function f_(r){if(!r)return null;let e=Number(r);return isNaN(e)?null:e}function CT(){function r(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}var os=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yt("not implemented")}_getIdTokenResponse(e){return yt("not implemented")}_linkToIdToken(e,t){return yt("not implemented")}_getReauthenticationResolver(e){return yt("not implemented")}};function Fr(r,e){return g(this,null,function*(){return fT(r,"POST","/v1/accounts:signInWithIdp",Jh(r,e))})}var DT="http://localhost",Sa=class r extends os{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new r(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):lt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let c=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=c,s=Kn(c,["providerId","signInMethod"]);if(!n||!i)return null;let o=new r(n,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){let t=this.buildRequest();return Fr(e,t)}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,Fr(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,Fr(e,t)}buildRequest(){let e={requestUri:DT,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Qn(t)}return e}};var as=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Ra=class extends as{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var ed=(()=>{class r extends Ra{constructor(){super("google.com"),this.addScope("profile")}static credential(t,n){return Sa._fromParams({providerId:r.PROVIDER_ID,signInMethod:r.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:n})}static credentialFromResult(t){return r.credentialFromTaggedObject(t)}static credentialFromError(t){return r.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;let{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return r.credential(n,i)}catch{return null}}}r.GOOGLE_SIGN_IN_METHOD="google.com",r.PROVIDER_ID="google.com";return r})();var cs=class r{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,i=!1){return g(this,null,function*(){let s=yield on._fromIdTokenResponse(e,n,i),o=p_(n);return new r({user:s,providerId:o,_tokenResponse:n,operationType:t})})}static _forOperation(e,t,n){return g(this,null,function*(){yield e._updateTokensIfNecessary(n,!0);let i=p_(n);return new r({user:e,providerId:i,_tokenResponse:n,operationType:t})})}};function p_(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}var Bh=class r extends Le{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,r.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new r(e,t,n,i)}};function G_(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?Bh._fromErrorAndOperation(r,s,e,n):s})}function NT(r,e,t=!1){return g(this,null,function*(){let n=yield is(r,e._linkToIdToken(r.auth,yield r.getIdToken()),t);return cs._forOperation(r,"link",n)})}function kT(r,e,t=!1){return g(this,null,function*(){let{auth:n}=r;if(Me(n.app))return Promise.reject(Bn(n));let i="reauthenticate";try{let s=yield is(r,G_(n,i,e,r),t);j(s.idToken,n,"internal-error");let o=Yh(s.idToken);j(o,n,"internal-error");let{sub:c}=o;return j(r.uid===c,n,"user-mismatch"),cs._forOperation(r,i,s)}catch(s){throw s?.code==="auth/user-not-found"&&lt(n,"user-mismatch"),s}})}function VT(r,e,t=!1){return g(this,null,function*(){if(Me(r.app))return Promise.reject(Bn(r));let n="signIn",i=yield G_(r,n,e),s=yield cs._fromIdTokenResponse(r,n,i);return t||(yield r._updateCurrentUser(s.user)),s})}function td(r,e){return ue(r).setPersistence(e)}function $_(r,e,t,n){return ue(r).onIdTokenChanged(e,t,n)}function W_(r,e,t){return ue(r).beforeAuthStateChanged(e,t)}function nd(r,e,t,n){return ue(r).onAuthStateChanged(e,t,n)}function rd(r){return ue(r).signOut()}var Pa="__sak";var Ca=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Pa,"1"),this.storage.removeItem(Pa),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var OT=1e3,xT=10,LT=(()=>{class r extends Ca{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,n)=>this.onStorageEvent(t,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=F_(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let n of Object.keys(this.listeners)){let i=this.storage.getItem(n),s=this.localCache[n];i!==s&&t(n,s,i)}}onStorageEvent(t,n=!1){if(!t.key){this.forAllChangedKeys((c,u,h)=>{this.notifyListeners(c,h)});return}let i=t.key;n?this.detachListener():this.stopPolling();let s=()=>{let c=this.storage.getItem(i);!n&&this.localCache[i]===c||this.notifyListeners(i,c)},o=this.storage.getItem(i);ET()&&o!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,xT):s()}notifyListeners(t,n){this.localCache[t]=n;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,n,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:n,newValue:i}),!0)})},OT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,n){return g(this,null,function*(){yield tt(r.prototype,this,"_set").call(this,t,n),this.localCache[t]=JSON.stringify(n)})}_get(t){return g(this,null,function*(){let n=yield tt(r.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(n),n})}_remove(t){return g(this,null,function*(){yield tt(r.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return r.type="LOCAL",r})(),Oa=LT;var MT=(()=>{class r extends Ca{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,n){}_removeListener(t,n){}}return r.type="SESSION",r})(),id=MT;function FT(r){return Promise.all(r.map(e=>g(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var UT=(()=>{class r{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let n=this.receivers.find(s=>s.isListeningto(t));if(n)return n;let i=new r(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return g(this,null,function*(){let n=t,{eventId:i,eventType:s,data:o}=n.data,c=this.handlersMap[s];if(!c?.size)return;n.ports[0].postMessage({status:"ack",eventId:i,eventType:s});let u=Array.from(c).map(f=>g(this,null,function*(){return f(n.origin,o)})),h=yield FT(u);n.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:h})})}_subscribe(t,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(n)}_unsubscribe(t,n){this.handlersMap[t]&&n&&this.handlersMap[t].delete(n),(!n||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}r.receivers=[];return r})();function sd(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}var qh=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){return g(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((c,u)=>{let h=sd("",20);i.port1.start();let f=setTimeout(()=>{u(new Error("unsupported_event"))},n);o={messageChannel:i,onMessage(m){let y=m;if(y.data.eventId===h)switch(y.data.status){case"ack":clearTimeout(f),s=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),c(y.data.response);break;default:clearTimeout(f),clearTimeout(s),u(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})})}};function ut(){return window}function BT(r){ut().location.href=r}function K_(){return typeof ut().WorkerGlobalScope<"u"&&typeof ut().importScripts=="function"}function qT(){return g(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function zT(){return navigator?.serviceWorker?.controller||null}function jT(){return K_()?self:null}var H_="firebaseLocalStorageDb",GT=1,Da="firebaseLocalStorage",Q_="fbase_key",zn=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function xa(r,e){return r.transaction([Da],e?"readwrite":"readonly").objectStore(Da)}function $T(){let r=indexedDB.deleteDatabase(H_);return new zn(r).toPromise()}function zh(){let r=indexedDB.open(H_,GT);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{let n=r.result;try{n.createObjectStore(Da,{keyPath:Q_})}catch(i){t(i)}}),r.addEventListener("success",()=>g(null,null,function*(){let n=r.result;n.objectStoreNames.contains(Da)?e(n):(n.close(),yield $T(),e(yield zh()))}))})}function m_(r,e,t){return g(this,null,function*(){let n=xa(r,!0).put({[Q_]:e,value:t});return new zn(n).toPromise()})}function WT(r,e){return g(this,null,function*(){let t=xa(r,!1).get(e),n=yield new zn(t).toPromise();return n===void 0?null:n.value})}function g_(r,e){let t=xa(r,!0).delete(e);return new zn(t).toPromise()}var KT=800,HT=3,QT=(()=>{class r{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return g(this,null,function*(){return this.db?this.db:(this.db=yield zh(),this.db)})}_withRetries(t){return g(this,null,function*(){let n=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(n++>HT)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return g(this,null,function*(){return K_()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return g(this,null,function*(){this.receiver=UT._getInstance(jT()),this.receiver._subscribe("keyChanged",(t,n)=>g(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(n.key)}})),this.receiver._subscribe("ping",(t,n)=>g(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return g(this,null,function*(){if(this.activeServiceWorker=yield qT(),!this.activeServiceWorker)return;this.sender=new qh(this.activeServiceWorker);let t=yield this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return g(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||zT()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return g(this,null,function*(){try{if(!indexedDB)return!1;let t=yield zh();return yield m_(t,Pa,"1"),yield g_(t,Pa),!0}catch{}return!1})}_withPendingWrite(t){return g(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,n){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(i=>m_(i,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)}))})}_get(t){return g(this,null,function*(){let n=yield this._withRetries(i=>WT(i,t));return this.localCache[t]=n,n})}_remove(t){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(n=>g_(n,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return g(this,null,function*(){let t=yield this._withRetries(s=>{let o=xa(s,!1).getAll();return new zn(o).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let n=[],i=new Set;if(t.length!==0)for(let{fbase_key:s,value:o}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),n.push(s));for(let s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),n.push(s));return n})}notifyListeners(t,n){this.localCache[t]=n;let i=this.listeners[t];if(i)for(let s of Array.from(i))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>g(this,null,function*(){return this._poll()}),KT)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(n)}_removeListener(t,n){this.listeners[t]&&(this.listeners[t].delete(n),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return r.type="LOCAL",r})(),J_=QT;var qA=B_("rcb"),zA=new qn(3e4,6e4);function Y_(r,e){return e?It(e):(j(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}var us=class extends os{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Fr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Fr(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function JT(r){return VT(r.auth,new us(r),r.bypassAuthState)}function YT(r){let{auth:e,user:t}=r;return j(t,e,"internal-error"),kT(t,new us(r),r.bypassAuthState)}function XT(r){return g(this,null,function*(){let{auth:e,user:t}=r;return j(t,e,"internal-error"),NT(t,new us(r),r.bypassAuthState)})}var Na=class{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>g(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}onAuthEvent(e){return g(this,null,function*(){let{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:o,type:c}=e;if(o){this.reject(o);return}let u={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(c)(u))}catch(h){this.reject(h)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return JT;case"linkViaPopup":case"linkViaRedirect":return XT;case"reauthViaPopup":case"reauthViaRedirect":return YT;default:lt(this.auth,"internal-error")}}resolve(e){wt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){wt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var ZT=new qn(2e3,1e4);function od(r,e,t){return g(this,null,function*(){if(Me(r.app))return Promise.reject(Xe(r,"operation-not-supported-in-this-environment"));let n=Va(r);oT(r,e,as);let i=Y_(n,t);return new ev(n,"signInViaPopup",e,i).executeNotNull()})}var ev=(()=>{class r extends Na{constructor(t,n,i,s,o){super(t,n,s,o),this.provider=i,this.authWindow=null,this.pollId=null,r.currentPopupAction&&r.currentPopupAction.cancel(),r.currentPopupAction=this}executeNotNull(){return g(this,null,function*(){let t=yield this.execute();return j(t,this.auth,"internal-error"),t})}onExecution(){return g(this,null,function*(){wt(this.filter.length===1,"Popup operations only handle one event");let t=sd();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Xe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Xe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,r.currentPopupAction=null}pollUserCancellation(){let t=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xe(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,ZT.get())};t()}}r.currentPopupAction=null;return r})(),tv="pendingRedirect",ya=new Map,jh=class r extends Na{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){return g(this,null,function*(){let e=ya.get(this.auth._key());if(!e){try{let n=(yield nv(this.resolver,this.auth))?yield tt(r.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ya.set(this.auth._key(),e)}return this.bypassAuthState||ya.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return g(this,null,function*(){if(e.type==="signInViaRedirect")return tt(r.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,tt(r.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return g(this,null,function*(){})}cleanUp(){}};function nv(r,e){return g(this,null,function*(){let t=sv(e),n=iv(r);if(!(yield n._isAvailable()))return!1;let i=(yield n._get(t))==="true";return yield n._remove(t),i})}function rv(r,e){ya.set(r._key(),e)}function iv(r){return It(r._redirectPersistence)}function sv(r){return _a(tv,r.config.apiKey,r.name)}function ov(r,e,t=!1){return g(this,null,function*(){if(Me(r.app))return Promise.reject(Bn(r));let n=Va(r),i=Y_(n,e),o=yield new jh(n,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,yield n._persistUserIfCurrent(o.user),yield n._setRedirectUser(null,e)),o})}var av=600*1e3,Gh=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!cv(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!X_(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Xe(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=av&&this.cachedEventUids.clear(),this.cachedEventUids.has(__(e))}saveEventToCache(e){this.cachedEventUids.add(__(e)),this.lastProcessedEventTime=Date.now()}};function __(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function X_({type:r,error:e}){return r==="unknown"&&e?.code==="auth/no-auth-event"}function cv(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return X_(r);default:return!1}}function uv(t){return g(this,arguments,function*(r,e={}){return Ur(r,"GET","/v1/projects",e)})}var lv=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hv=/^https?/;function dv(r){return g(this,null,function*(){if(r.config.emulator)return;let{authorizedDomains:e}=yield uv(r);for(let t of e)try{if(fv(t))return}catch{}lt(r,"unauthorized-domain")})}function fv(r){let e=Vh(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){let o=new URL(r);return o.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===n}if(!hv.test(t))return!1;if(lv.test(r))return n===r;let i=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}var pv=new qn(3e4,6e4);function y_(){let r=ut().___jsl;if(r?.H){for(let e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function mv(r){return new Promise((e,t)=>{function n(){y_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{y_(),t(Xe(r,"network-request-failed"))},timeout:pv.get()})}if(ut().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(ut().gapi?.load)n();else{let i=B_("iframefcb");return ut()[i]=()=>{gapi.load?n():t(Xe(r,"network-request-failed"))},bT(`${ST()}?onload=${i}`).catch(s=>t(s))}}).catch(e=>{throw Ia=null,e})}var Ia=null;function gv(r){return Ia=Ia||mv(r),Ia}var _v=new qn(5e3,15e3),yv="__/auth/iframe",Iv="emulator/auth/iframe",wv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ev=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Tv(r){let e=r.config;j(e.authDomain,r,"auth-domain-config-required");let t=e.emulator?Qh(e,Iv):`https://${r.config.authDomain}/${yv}`,n={apiKey:e.apiKey,appName:r.name,v:kt},i=Ev.get(r.config.apiHost);i&&(n.eid=i);let s=r._getFrameworks();return s.length&&(n.fw=s.join(",")),`${t}?${Qn(n).slice(1)}`}function vv(r){return g(this,null,function*(){let e=yield gv(r),t=ut().gapi;return j(t,r,"internal-error"),e.open({where:document.body,url:Tv(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:wv,dontclear:!0},n=>new Promise((i,s)=>g(null,null,function*(){yield n.restyle({setHideOnLeave:!1});let o=Xe(r,"network-request-failed"),c=ut().setTimeout(()=>{s(o)},_v.get());function u(){ut().clearTimeout(c),i(n)}n.ping(u).then(u,()=>{s(o)})})))})}var Av={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},bv=500,Sv=600,Rv="_blank",Pv="http://localhost",ka=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function Cv(r,e,t,n=bv,i=Sv){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-n)/2,0).toString(),c="",u=Te(W({},Av),{width:n.toString(),height:i.toString(),top:s,left:o}),h=he().toLowerCase();t&&(c=V_(h)?Rv:t),N_(h)&&(e=e||Pv,u.scrollbars="yes");let f=Object.entries(u).reduce((y,[P,k])=>`${y}${P}=${k},`,"");if(wT(h)&&c!=="_self")return Dv(e||"",c),new ka(null);let m=window.open(e||"",c,f);j(m,r,"popup-blocked");try{m.focus()}catch{}return new ka(m)}function Dv(r,e){let t=document.createElement("a");t.href=r,t.target=e;let n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}var Nv="__/auth/handler",kv="emulator/auth/handler",Vv=encodeURIComponent("fac");function I_(r,e,t,n,i,s){return g(this,null,function*(){j(r.config.authDomain,r,"auth-domain-config-required"),j(r.config.apiKey,r,"invalid-api-key");let o={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:kt,eventId:i};if(e instanceof as){e.setDefaultLanguage(r.languageCode),o.providerId=e.providerId||"",Sf(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(let[f,m]of Object.entries(s||{}))o[f]=m}if(e instanceof Ra){let f=e.getScopes().filter(m=>m!=="");f.length>0&&(o.scopes=f.join(","))}r.tenantId&&(o.tid=r.tenantId);let c=o;for(let f of Object.keys(c))c[f]===void 0&&delete c[f];let u=yield r._getAppCheckToken(),h=u?`#${Vv}=${encodeURIComponent(u)}`:"";return`${Ov(r)}?${Qn(c).slice(1)}${h}`})}function Ov({config:r}){return r.emulator?Qh(r,kv):`https://${r.authDomain}/${Nv}`}var kh="webStorageSupport",$h=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=id,this._completeRedirectFn=ov,this._overrideRedirectResult=rv}_openPopup(e,t,n,i){return g(this,null,function*(){wt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");let s=yield I_(e,t,n,Vh(),i);return Cv(e,s,sd())})}_openRedirect(e,t,n,i){return g(this,null,function*(){yield this._originValidation(e);let s=yield I_(e,t,n,Vh(),i);return BT(s),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(wt(s,"If manager is not set, promise should be"),s)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){return g(this,null,function*(){let t=yield vv(e),n=new Gh(e);return t.register("authEvent",i=>(j(i?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(kh,{type:kh},i=>{let s=i?.[0]?.[kh];s!==void 0&&t(!!s),lt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=dv(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return F_()||k_()||Xh()}},Z_=$h;var w_="@firebase/auth",E_="1.12.0";var Wh=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}getToken(e){return g(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(n=>{e(n?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){j(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function xv(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Lv(r){Nt(new Ge("auth",(e,{options:t})=>{let n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=n.options;j(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});let u={apiKey:o,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:U_(r)},h=new Uh(n,i,s,u);return RT(h,t),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Nt(new Ge("auth-internal",e=>{let t=Va(e.getProvider("auth").getImmediate());return(n=>new Wh(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ke(w_,E_,xv(r)),Ke(w_,E_,"esm2020")}var Mv=300,Fv=pc("authIdTokenMaxAge")||Mv,T_=null,Uv=r=>e=>g(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Fv)return;let i=t?.token;T_!==i&&(T_=i,yield fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function ad(r=Vc()){let e=oi(r,"auth");if(e.isInitialized())return e.getImmediate();let t=q_(r,{popupRedirectResolver:Z_,persistence:[J_,Oa,id]}),n=pc("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){let s=new URL(n,location.origin);if(location.origin===s.origin){let o=Uv(s.toString());W_(t,o,()=>o(t.currentUser)),$_(t,c=>o(c))}}let i=yf("auth");return i&&z_(t,`http://${i}`),t}function Bv(){return document.getElementsByTagName("head")?.[0]??document}AT({loadJS(r){return new Promise((e,t)=>{let n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=i=>{let s=Xe("internal-error");s.customData=i,t(s)},n.type="text/javascript",n.charset="UTF-8",Bv().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Lv("Browser");var ey={production:!0,firebase:{apiKey:"AIzaSyBeHdde0pv1hB5_mKCbe0sfO5AAkI5wmms",authDomain:"familyops-6e2d1.firebaseapp.com",projectId:"familyops-6e2d1",storageBucket:"familyops-6e2d1.firebasestorage.app",messagingSenderId:"662115430672",appId:"1:662115430672:web:58fbcc7b84a09ba3147595",measurementId:"G-5VWXL4WZJW"},appName:"FamilyOps",defaultLanguage:"he",features:{offlineMode:!0,debugMode:!1}};var Br=null,qr=null,jn=null;function yS(){return Br&&qr&&jn?{app:Br,db:qr,auth:jn}:(Br=kc(ey.firebase),qr=Gg(Br,{localCache:o_({tabManager:a_()})}),jn=ad(Br),td(jn,Oa).catch(r=>{console.error("Error setting auth persistence:",r)}),{app:Br,db:qr,auth:jn})}function ty(){if(!qr)throw new Error("Firestore not initialized. Call initializeFirebase() first.");return qr}function ny(){if(!jn)throw new Error("Auth not initialized. Call initializeFirebase() first.");return jn}var La=class r{db=ty();getDocRef(e){return ha(this.db,e)}getCollectionRef(e){return jg(this.db,e)}getDocument(e){return g(this,null,function*(){let t=this.getDocRef(e),n=yield t_(t);return n.exists()?W({id:n.id},n.data()):null})}getDocument$(e){return new ac(t=>{let n=this.getDocRef(e),i=Dh(n,s=>{s.exists()?t.next(W({id:s.id},s.data())):t.next(null)},s=>t.error(s));return()=>i()})}getCollection(e,...t){return g(this,null,function*(){let n=this.getCollectionRef(e),i=t.length>0?Ph(n,...t):n;return(yield n_(i)).docs.map(o=>W({id:o.id},o.data()))})}getCollection$(e,...t){return new ac(n=>{let i=this.getCollectionRef(e),s=t.length>0?Ph(i,...t):i,o=Dh(s,c=>{let u=c.docs.map(h=>W({id:h.id},h.data()));n.next(u)},c=>n.error(c));return()=>o()})}createDocument(e,t){return g(this,null,function*(){let n=this.getCollectionRef(e),i=ha(n);return yield Ch(i,Te(W({},t),{createdAt:rn(),updatedAt:rn()})),i.id})}setDocument(e,t,n=!1){return g(this,null,function*(){let i=this.getDocRef(e);yield Ch(i,Te(W({},t),{updatedAt:rn()}),{merge:n})})}updateDocument(e,t){return g(this,null,function*(){let n=this.getDocRef(e);yield r_(n,Te(W({},t),{updatedAt:rn()}))})}deleteDocument(e){return g(this,null,function*(){let t=this.getDocRef(e);yield i_(t)})}batchWrite(e){return g(this,null,function*(){let t=c_(this.db);for(let n of e){let i=this.getDocRef(n.path);switch(n.type){case"set":t.set(i,Te(W({},n.data),{updatedAt:rn()}));break;case"update":t.update(i,Te(W({},n.data),{updatedAt:rn()}));break;case"delete":t.delete(i);break}}yield t.commit()})}generateId(e){let t=this.getCollectionRef(e);return ha(t).id}toTimestamp(e){return se.fromDate(e)}fromTimestamp(e){return e.toDate()}getServerTimestamp(){return rn()}static \u0275fac=function(t){return new(t||r)};static \u0275prov=Ss({token:r,factory:r.\u0275fac,providedIn:"root"})};var ry={theme:"system",language:"he",notifications:!0};var iy=class r{constructor(e){this.firestoreService=e;this.googleProvider.setCustomParameters({prompt:"select_account"}),nd(this.auth,t=>g(this,null,function*(){this._firebaseUser.set(t),this._isInitialized.set(!1),t?yield this.loadUserDocument(t.uid):this._userDocument.set(null),this._isLoading.set(!1),this._isInitialized.set(!0)}))}auth=ny();googleProvider=new ed;_firebaseUser=Hn(null);_userDocument=Hn(null);_isLoading=Hn(!0);_isInitialized=Hn(!1);_error=Hn(null);firebaseUser=this._firebaseUser.asReadonly();user=this._userDocument.asReadonly();isLoading=this._isLoading.asReadonly();isInitialized=this._isInitialized.asReadonly();error=this._error.asReadonly();isAuthenticated=dn(()=>!!this._firebaseUser());userId=dn(()=>this._firebaseUser()?.uid??null);userEmail=dn(()=>this._firebaseUser()?.email??null);displayName=dn(()=>this._userDocument()?.displayName??this._firebaseUser()?.displayName??null);photoURL=dn(()=>this._userDocument()?.photoURL??this._firebaseUser()?.photoURL??null);activeFamilyId=dn(()=>this._userDocument()?.activeFamilyId??null);loadUserDocument(e){return g(this,null,function*(){try{let t=yield this.firestoreService.getDocument(`users/${e}`);this._userDocument.set(t)}catch(t){console.warn("Could not load user document:",t.message)}})}signInWithGoogle(){return g(this,null,function*(){this._isLoading.set(!0),this._error.set(null);try{let t=(yield od(this.auth,this.googleProvider)).user;this.ensureUserDocument(t).catch(n=>{console.warn("Background user document creation failed:",n.message)})}catch(e){throw console.error("Google sign-in error:",e),this._error.set(this.getErrorMessage(e.code)),e}finally{this._isLoading.set(!1)}})}ensureUserDocument(e){return g(this,null,function*(){try{if(!(yield this.firestoreService.getDocument(`users/${e.uid}`))){let n={displayName:e.displayName||"\u05DE\u05E9\u05EA\u05DE\u05E9",email:e.email||"",photoURL:e.photoURL||void 0,familyMemberships:{},preferences:ry};yield this.firestoreService.setDocument(`users/${e.uid}`,Te(W({},n),{createdAt:this.firestoreService.getServerTimestamp()}))}yield this.loadUserDocument(e.uid)}catch(t){console.warn("Firestore operations failed:",t.message)}})}logout(){return g(this,null,function*(){this._isLoading.set(!0),this._error.set(null);try{yield rd(this.auth),this._userDocument.set(null)}catch(e){throw console.error("Logout error:",e),this._error.set(this.getErrorMessage(e.code)),e}finally{this._isLoading.set(!1)}})}updateProfile(e){return g(this,null,function*(){let t=this.userId();if(!t)throw new Error("No authenticated user");try{yield this.firestoreService.updateDocument(`users/${t}`,e),yield this.loadUserDocument(t)}catch(n){throw console.error("Update profile error:",n),this._error.set("\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05E2\u05D3\u05DB\u05D5\u05DF \u05D4\u05E4\u05E8\u05D5\u05E4\u05D9\u05DC"),n}})}setActiveFamily(e){return g(this,null,function*(){let t=this.userId();if(!t)throw new Error("No authenticated user");try{yield this.firestoreService.updateDocument(`users/${t}`,{activeFamilyId:e}),yield this.loadUserDocument(t)}catch(n){throw console.error("Set active family error:",n),n}})}addFamilyMembership(e,t){return g(this,null,function*(){let n=this.userId(),i=this._userDocument();if(!n||!i)throw new Error("No authenticated user");try{let s=Te(W({},i.familyMemberships),{[e]:t});yield this.firestoreService.updateDocument(`users/${n}`,W({familyMemberships:s},Object.keys(i.familyMemberships).length===0?{activeFamilyId:e}:{})),yield this.loadUserDocument(n)}catch(s){throw console.error("Add family membership error:",s),s}})}removeFamilyMembership(e){return g(this,null,function*(){let t=this.userId(),n=this._userDocument();if(!t||!n)throw new Error("No authenticated user");try{let i=n.familyMemberships,{[e]:s}=i,o=Kn(i,[hf(e)]),c=n.activeFamilyId;if(n.activeFamilyId===e){let u=Object.keys(o);c=u.length>0?u[0]:void 0}yield this.firestoreService.updateDocument(`users/${t}`,{familyMemberships:o,activeFamilyId:c??null}),yield this.loadUserDocument(t)}catch(s){throw console.error("Remove family membership error:",s),s}})}getFamilyRole(e){let t=this._userDocument();return t?t.familyMemberships[e]??null:null}isFamilyMember(e){return this.getFamilyRole(e)!==null}clearError(){this._error.set(null)}getErrorMessage(e){return{"auth/popup-closed-by-user":"\u05D4\u05D7\u05DC\u05D5\u05DF \u05E0\u05E1\u05D2\u05E8 \u05DC\u05E4\u05E0\u05D9 \u05D4\u05E9\u05DC\u05DE\u05EA \u05D4\u05D4\u05EA\u05D7\u05D1\u05E8\u05D5\u05EA","auth/popup-blocked":"\u05D4\u05D7\u05DC\u05D5\u05DF \u05E0\u05D7\u05E1\u05DD. \u05D0\u05E0\u05D0 \u05D0\u05E4\u05E9\u05E8 \u05D7\u05DC\u05D5\u05E0\u05D5\u05EA \u05E7\u05D5\u05E4\u05E6\u05D9\u05DD","auth/cancelled-popup-request":"\u05D1\u05E7\u05E9\u05EA \u05D4\u05D4\u05EA\u05D7\u05D1\u05E8\u05D5\u05EA \u05D1\u05D5\u05D8\u05DC\u05D4","auth/account-exists-with-different-credential":"\u05E7\u05D9\u05D9\u05DD \u05D7\u05E9\u05D1\u05D5\u05DF \u05E2\u05DD \u05D0\u05D9\u05DE\u05D9\u05D9\u05DC \u05D6\u05D4 \u05D1\u05E9\u05D9\u05D8\u05EA \u05D4\u05EA\u05D7\u05D1\u05E8\u05D5\u05EA \u05D0\u05D7\u05E8\u05EA","auth/network-request-failed":"\u05E9\u05D2\u05D9\u05D0\u05EA \u05E8\u05E9\u05EA. \u05D1\u05D3\u05D5\u05E7 \u05D0\u05EA \u05D4\u05D7\u05D9\u05D1\u05D5\u05E8 \u05DC\u05D0\u05D9\u05E0\u05D8\u05E8\u05E0\u05D8","auth/too-many-requests":"\u05D9\u05D5\u05EA\u05E8 \u05DE\u05D3\u05D9 \u05E0\u05D9\u05E1\u05D9\u05D5\u05E0\u05D5\u05EA. \u05E0\u05E1\u05D4 \u05E9\u05D5\u05D1 \u05DE\u05D0\u05D5\u05D7\u05E8 \u05D9\u05D5\u05EA\u05E8","auth/user-disabled":"\u05D4\u05DE\u05E9\u05EA\u05DE\u05E9 \u05D4\u05D5\u05E9\u05D1\u05EA"}[e]??"\u05D0\u05D9\u05E8\u05E2\u05D4 \u05E9\u05D2\u05D9\u05D0\u05D4. \u05E0\u05E1\u05D4 \u05E9\u05D5\u05D1"}static \u0275fac=function(t){return new(t||r)(df(La))};static \u0275prov=Ss({token:r,factory:r.\u0275fac,providedIn:"root"})};export{se as a,jg as b,Ph as c,ZE as d,eT as e,n_ as f,yS as g,ty as h,La as i,iy as j};
