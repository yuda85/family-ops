import{a as de}from"./chunk-UAW6TWS3.js";import{a as pe,c as ve}from"./chunk-T3S3PSFS.js";import{a as ie,d as ne}from"./chunk-BFWFC2UO.js";import{a as oe,c as re}from"./chunk-EI4X5JRH.js";import{a as Z,c as ee,h as te}from"./chunk-DNCMLEWE.js";import{a as j,b as q}from"./chunk-BCPCSMU2.js";import{a as se}from"./chunk-OHB7MTR6.js";import{a as ae,b as le,c as ce,d as ue}from"./chunk-PHBB3HXL.js";import{b as me}from"./chunk-BUPX7NXY.js";import"./chunk-JCYEYCY7.js";import{f as L}from"./chunk-HS2XTPUM.js";import{d as h,f as H,g as J,j as K,l as Q,m as W,p as X,r as Y}from"./chunk-FSRTV3VH.js";import"./chunk-QJJTVXVB.js";import{d as $}from"./chunk-X4QG5DAP.js";import{a as R,b as B,d as z,e as G,f as U}from"./chunk-SXGBHULN.js";import"./chunk-EB5YHKWW.js";import{d as A,i as N,j as V}from"./chunk-JFU3JZIN.js";import{k as T}from"./chunk-OJNKK6II.js";import{$b as k,Ab as P,Bb as u,Cb as i,Db as n,Eb as C,Ib as O,Jb as S,Lb as y,Pb as D,Rb as c,Sa as a,Y as g,ba as _,bc as F,ca as f,cc as w,dc as r,ec as E,fb as I,fc as x,oa as p,vb as s,wb as d,zb as b}from"./chunk-QZLPLYI5.js";import{f as v}from"./chunk-ATWMZ64T.js";var fe=(o,t)=>t.value,Ce=(o,t)=>t.id;function De(o,t){if(o&1&&(i(0,"mat-option",12)(1,"mat-icon"),r(2),n(),r(3),n()),o&2){let e=t.$implicit;u("value",e.value),a(2),E(e.icon),a(),x(" ",e.label," ")}}function Ee(o,t){o&1&&C(0,"mat-spinner",15)}function xe(o,t){o&1&&(O(0),i(1,"mat-icon"),r(2,"add_link"),n(),r(3," \u05E6\u05D5\u05E8 \u05D4\u05D6\u05DE\u05E0\u05D4 "),S())}function Me(o,t){if(o&1){let e=y();i(0,"div",16)(1,"div",17)(2,"mat-icon"),r(3,"link"),n(),i(4,"span"),r(5,"\u05E7\u05D9\u05E9\u05D5\u05E8 \u05D4\u05D6\u05DE\u05E0\u05D4"),n()(),i(6,"div",18),C(7,"input",19,0),i(9,"button",20),D("click",function(){_(e);let m=c(2);return f(m.copyLink())}),i(10,"mat-icon"),r(11),n()()(),i(12,"p",21),r(13,"\u05E9\u05EA\u05E4\u05D5 \u05D0\u05EA \u05D4\u05E7\u05D9\u05E9\u05D5\u05E8 \u05E2\u05DD \u05D1\u05E0\u05D9 \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4 \u05E9\u05D1\u05E8\u05E6\u05D5\u05E0\u05DB\u05DD \u05DC\u05D4\u05D6\u05DE\u05D9\u05DF"),n()()}if(o&2){let e=c(2);a(7),u("value",e.generatedInviteLink()),a(2),u("matTooltip","\u05D4\u05E2\u05EA\u05E7 \u05E7\u05D9\u05E9\u05D5\u05E8"),a(2),E(e.copied()?"check":"content_copy")}}function ye(o,t){if(o&1){let e=y();i(0,"section",4)(1,"h2"),r(2,"\u05D9\u05E6\u05D9\u05E8\u05EA \u05D4\u05D6\u05DE\u05E0\u05D4 \u05D7\u05D3\u05E9\u05D4"),n(),i(3,"form",9),D("ngSubmit",function(){_(e);let m=c();return f(m.createInvite())}),i(4,"mat-form-field",10)(5,"mat-label"),r(6,"\u05EA\u05E4\u05E7\u05D9\u05D3"),n(),i(7,"mat-select",11),b(8,De,4,3,"mat-option",12,fe),n(),i(10,"mat-hint"),r(11,"\u05D4\u05EA\u05E4\u05E7\u05D9\u05D3 \u05E9\u05D9\u05E7\u05D1\u05DC \u05D4\u05DE\u05D5\u05D6\u05DE\u05DF"),n()(),i(12,"mat-form-field",10)(13,"mat-label"),r(14,"\u05EA\u05D5\u05E7\u05E3 \u05D4\u05D4\u05D6\u05DE\u05E0\u05D4"),n(),i(15,"mat-select",13)(16,"mat-option",12),r(17,"\u05D9\u05D5\u05DD \u05D0\u05D7\u05D3"),n(),i(18,"mat-option",12),r(19,"3 \u05D9\u05DE\u05D9\u05DD"),n(),i(20,"mat-option",12),r(21,"\u05E9\u05D1\u05D5\u05E2"),n(),i(22,"mat-option",12),r(23,"\u05E9\u05D1\u05D5\u05E2\u05D9\u05D9\u05DD"),n(),i(24,"mat-option",12),r(25,"\u05D7\u05D5\u05D3\u05E9"),n()()(),i(26,"button",14),s(27,Ee,1,0,"mat-spinner",15)(28,xe,4,0,"ng-container"),n()(),s(29,Me,14,3,"div",16),n()}if(o&2){let e=c();a(3),u("formGroup",e.inviteForm),a(5),P(e.availableRoles),a(8),u("value",1),a(2),u("value",3),a(2),u("value",7),a(2),u("value",14),a(2),u("value",30),a(2),u("disabled",e.inviteForm.invalid||e.isCreating()),a(),d(e.isCreating()?27:28),a(2),d(e.generatedInviteLink()?29:-1)}}function be(o,t){o&1&&(i(0,"div",6),C(1,"mat-spinner",22),n())}function Pe(o,t){o&1&&C(0,"app-empty-state",7)}function he(o,t){o&1&&(i(0,"span"),r(1,"\u05E0\u05D5\u05E6\u05DC \u05E2\u05DC \u05D9\u05D3\u05D9 \u05DE\u05E9\u05EA\u05DE\u05E9"),n())}function Ie(o,t){if(o&1&&(i(0,"span"),r(1),n()),o&2){let e=c().$implicit,l=c(2);a(),x("\u05E4\u05D2 \u05EA\u05D5\u05E7\u05E3: ",l.formatDate(e.expiresAt))}}function Oe(o,t){if(o&1){let e=y();i(0,"button",31)(1,"mat-icon"),r(2,"more_vert"),n()(),i(3,"mat-menu",null,1)(5,"button",32),D("click",function(){_(e);let m=c().$implicit,M=c(2);return f(M.copyInviteLink(m.id))}),i(6,"mat-icon"),r(7,"content_copy"),n(),i(8,"span"),r(9,"\u05D4\u05E2\u05EA\u05E7 \u05E7\u05D9\u05E9\u05D5\u05E8"),n()(),i(10,"button",33),D("click",function(){_(e);let m=c().$implicit,M=c(2);return f(M.deleteInvite(m.id))}),i(11,"mat-icon"),r(12,"delete"),n(),i(13,"span"),r(14,"\u05DE\u05D7\u05E7 \u05D4\u05D6\u05DE\u05E0\u05D4"),n()()()}if(o&2){let e=k(4);u("matMenuTriggerFor",e)}}function Se(o,t){if(o&1&&(i(0,"div",24)(1,"div",25)(2,"mat-icon"),r(3),n()(),i(4,"div",26)(5,"div",27)(6,"mat-chip"),r(7),n(),i(8,"span",28),r(9),n()(),i(10,"div",29),s(11,he,2,0,"span")(12,Ie,2,1,"span"),n(),i(13,"div",30),r(14),n()(),s(15,Oe,15,1),n()),o&2){let e=t.$implicit,l=c(2);F("used",e.usedBy)("expired",l.isExpired(e)),a(3),E(l.getStatusIcon(e)),a(4),E(l.getRoleLabel(e.role)),a(),w(l.getStatusClass(e)),a(),x(" ",l.getStatusLabel(e)," "),a(2),d(e.usedBy?11:12),a(3),x(" \u05E0\u05D5\u05E6\u05E8: ",l.formatDate(e.createdAt)," "),a(),d(!e.usedBy&&!l.isExpired(e)?15:-1)}}function ke(o,t){if(o&1&&(i(0,"div",8),b(1,Se,16,12,"div",23,Ce),n()),o&2){let e=c();a(),P(e.invites())}}var ge=class o{fb=g(X);familyService=g($);firestoreService=g(N);authService=g(V);inviteForm;isLoading=p(!1);isCreating=p(!1);invites=p([]);generatedInviteLink=p(null);copied=p(!1);availableRoles=[{value:"admin",label:"\u05DE\u05E0\u05D4\u05DC",icon:"admin_panel_settings"},{value:"member",label:"\u05D7\u05D1\u05E8",icon:"person"},{value:"viewer",label:"\u05E6\u05D5\u05E4\u05D4",icon:"visibility"}];roleLabels={admin:"\u05DE\u05E0\u05D4\u05DC",member:"\u05D7\u05D1\u05E8",viewer:"\u05E6\u05D5\u05E4\u05D4"};ngOnInit(){this.initForm(),this.loadInvites()}initForm(){this.inviteForm=this.fb.group({role:["member",h.required],expiresInDays:[7,h.required]})}loadInvites(){return v(this,null,function*(){let t=this.familyService.familyId();if(t){this.isLoading.set(!0);try{let e=yield this.firestoreService.getCollection("invites",A("familyId","==",t));e.sort((l,m)=>m.createdAt.toMillis()-l.createdAt.toMillis()),this.invites.set(e)}catch(e){console.error("Error loading invites:",e)}finally{this.isLoading.set(!1)}}})}createInvite(){return v(this,null,function*(){if(this.inviteForm.invalid)return;let t=this.familyService.familyId(),e=this.familyService.familyName();if(!(!t||!e)){this.isCreating.set(!0),this.generatedInviteLink.set(null);try{let l=this.inviteForm.value,m=yield this.familyService.createInvite({familyId:t,familyName:e,role:l.role,expiresInDays:l.expiresInDays}),_e=`${document.baseURI.replace(/\/$/,"")}/#/accept-invite/${m}`;this.generatedInviteLink.set(_e),yield this.loadInvites()}catch(l){console.error("Error creating invite:",l)}finally{this.isCreating.set(!1)}}})}copyLink(){return v(this,null,function*(){let t=this.generatedInviteLink();if(t)try{yield navigator.clipboard.writeText(t),this.copied.set(!0),setTimeout(()=>this.copied.set(!1),2e3)}catch(e){console.error("Error copying link:",e)}})}copyInviteLink(t){let l=`${document.baseURI.replace(/\/$/,"")}/#/accept-invite/${t}`;navigator.clipboard.writeText(l).then(()=>{})}deleteInvite(t){return v(this,null,function*(){try{yield this.firestoreService.deleteDocument(`invites/${t}`),yield this.loadInvites()}catch(e){console.error("Error deleting invite:",e)}})}getRoleLabel(t){return this.roleLabels[t]??t}isExpired(t){return t.expiresAt.toDate()<new Date}getStatusIcon(t){return t.usedBy?"check_circle":this.isExpired(t)?"cancel":"schedule"}getStatusLabel(t){return t.usedBy?"\u05E0\u05D5\u05E6\u05DC":this.isExpired(t)?"\u05E4\u05D2 \u05EA\u05D5\u05E7\u05E3":"\u05DE\u05DE\u05EA\u05D9\u05DF"}getStatusClass(t){return t.usedBy?"used":this.isExpired(t)?"expired":"pending"}formatDate(t){return t.toDate().toLocaleDateString("he-IL",{day:"numeric",month:"short",year:"numeric"})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=I({type:o,selectors:[["app-invite"]],decls:11,vars:2,consts:[["linkInput",""],["inviteMenu","matMenu"],[1,"invite-page"],[1,"page-header"],[1,"create-invite-section"],[1,"invites-list-section"],[1,"loading-state"],["icon","mail","title","\u05D0\u05D9\u05DF \u05D4\u05D6\u05DE\u05E0\u05D5\u05EA","description","\u05DC\u05D0 \u05E0\u05D5\u05E6\u05E8\u05D5 \u05D4\u05D6\u05DE\u05E0\u05D5\u05EA \u05E2\u05D3\u05D9\u05D9\u05DF"],[1,"invites-list"],[1,"invite-form",3,"ngSubmit","formGroup"],["appearance","outline"],["formControlName","role"],[3,"value"],["formControlName","expiresInDays"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["diameter","20"],[1,"invite-link-box"],[1,"link-header"],[1,"link-content"],["type","text","readonly","",1,"link-input",3,"value"],["mat-icon-button","",3,"click","matTooltip"],[1,"link-hint"],["diameter","40"],[1,"invite-card",3,"used","expired"],[1,"invite-card"],[1,"invite-icon"],[1,"invite-info"],[1,"invite-role"],[1,"invite-status"],[1,"invite-meta"],[1,"invite-created"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",1,"danger",3,"click"]],template:function(e,l){e&1&&(i(0,"div",2)(1,"header",3)(2,"h1"),r(3,"\u05D4\u05D6\u05DE\u05E0\u05D4 \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4"),n()(),s(4,ye,30,9,"section",4),i(5,"section",5)(6,"h2"),r(7,"\u05D4\u05D6\u05DE\u05E0\u05D5\u05EA \u05E7\u05D9\u05D9\u05DE\u05D5\u05EA"),n(),s(8,be,2,0,"div",6)(9,Pe,1,0,"app-empty-state",7)(10,ke,3,0,"div",8),n()()),e&2&&(a(4),d(l.familyService.isAdmin()?4:-1),a(4),d(l.isLoading()?8:l.invites().length===0?9:10))},dependencies:[T,Y,K,H,J,W,Q,z,B,R,U,G,ie,te,Z,ee,ve,pe,L,ne,re,oe,ue,le,ae,ce,q,j,se,me,de],styles:[".invite-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:0;color:var(--text-primary)}.create-invite-section[_ngcontent-%COMP%]{background:var(--surface-primary);border:1px solid var(--border-subtle);border-radius:1rem;padding:1.5rem}.create-invite-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;margin:0 0 1.25rem;color:var(--text-primary)}.invite-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.invite-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.invite-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{align-self:flex-start;display:flex;align-items:center;gap:.5rem}.invite-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-inline-end:.5rem}.invite-link-box[_ngcontent-%COMP%]{margin-top:1.5rem;padding:1rem;background:var(--surface-secondary);border-radius:.75rem;border:1px solid var(--color-primary)}.invite-link-box[_ngcontent-%COMP%]   .link-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:600;color:var(--color-primary);margin-bottom:.75rem}.invite-link-box[_ngcontent-%COMP%]   .link-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.invite-link-box[_ngcontent-%COMP%]   .link-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.invite-link-box[_ngcontent-%COMP%]   .link-input[_ngcontent-%COMP%]{flex:1;padding:.75rem;border:1px solid var(--border-subtle);border-radius:.5rem;background:var(--surface-primary);color:var(--text-primary);font-size:.875rem;font-family:monospace;direction:ltr;text-align:left}.invite-link-box[_ngcontent-%COMP%]   .link-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--color-primary)}.invite-link-box[_ngcontent-%COMP%]   .link-hint[_ngcontent-%COMP%]{margin:.75rem 0 0;font-size:.75rem;color:var(--text-secondary)}.invites-list-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.125rem;font-weight:600;margin:0 0 1rem;color:var(--text-primary)}.loading-state[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem}.invites-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.invite-card[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.25rem;background:var(--surface-primary);border:1px solid var(--border-subtle);border-radius:1rem;transition:opacity .2s ease}.invite-card.used[_ngcontent-%COMP%], .invite-card.expired[_ngcontent-%COMP%]{opacity:.6}.invite-card[_ngcontent-%COMP%]   .invite-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:var(--surface-secondary);display:flex;align-items:center;justify-content:center;color:var(--text-secondary)}.invite-card[_ngcontent-%COMP%]   .invite-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem}.invite-card.used[_ngcontent-%COMP%]   .invite-icon[_ngcontent-%COMP%]{background:rgba(var(--color-success-rgb),.1);color:var(--color-success)}.invite-card.expired[_ngcontent-%COMP%]   .invite-icon[_ngcontent-%COMP%]{background:rgba(var(--color-error-rgb),.1);color:var(--color-error)}.invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]{flex:1;min-width:0}.invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]   .invite-role[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:.25rem}.invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]   .invite-status[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500;padding:.125rem .5rem;border-radius:1rem}.invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]   .invite-status.pending[_ngcontent-%COMP%]{background:rgba(var(--color-warning-rgb),.1);color:var(--color-warning)}.invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]   .invite-status.used[_ngcontent-%COMP%]{background:rgba(var(--color-success-rgb),.1);color:var(--color-success)}.invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]   .invite-status.expired[_ngcontent-%COMP%]{background:rgba(var(--color-error-rgb),.1);color:var(--color-error)}.invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]   .invite-meta[_ngcontent-%COMP%], .invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]   .invite-created[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.invite-card[_ngcontent-%COMP%]   .invite-info[_ngcontent-%COMP%]   .invite-meta[_ngcontent-%COMP%]{margin-bottom:.125rem}.danger[_ngcontent-%COMP%]{color:var(--color-error)!important}"]})};export{ge as InviteComponent};
