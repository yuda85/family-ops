import{a as B,c as R}from"./chunk-4SS6VL3O.js";import"./chunk-PBF26NQQ.js";import{a as z,b as N}from"./chunk-IU263WV3.js";import"./chunk-HVH6PFSI.js";import"./chunk-GY27VXU3.js";import{d as T}from"./chunk-WPQFOBGJ.js";import{b as L,d as F,e as q,f as V}from"./chunk-OHJUE5IH.js";import"./chunk-ZOWI4QAM.js";import{a as A,c as I,d as b,i as S}from"./chunk-HH43CGJO.js";import{i as w,j as k}from"./chunk-IGP4P7SY.js";import{j as O}from"./chunk-3EH3MU74.js";import{Bb as h,Cb as t,Db as n,Eb as x,Ib as M,Jb as P,Lb as D,Pb as C,Rb as c,Sa as a,Y as s,ba as d,ca as p,dc as i,ec as v,fb as E,fc as y,oa as m,vb as g,wb as _}from"./chunk-HNLZOKXJ.js";import{f}from"./chunk-ATWMZ64T.js";function $(o,r){o&1&&(t(0,"div",2),x(1,"mat-spinner",5),t(2,"p"),i(3,"\u05D8\u05D5\u05E2\u05DF \u05E4\u05E8\u05D8\u05D9 \u05D4\u05D6\u05DE\u05E0\u05D4..."),n()())}function G(o,r){if(o&1){let e=D();t(0,"div",3)(1,"mat-icon"),i(2,"family_restroom"),n(),t(3,"h2"),i(4,"\u05D4\u05D6\u05DE\u05E0\u05D4 \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4"),n(),t(5,"p"),i(6,"\u05D9\u05E9 \u05DC\u05D4\u05EA\u05D7\u05D1\u05E8 \u05DB\u05D3\u05D9 \u05DC\u05E6\u05E4\u05D5\u05EA \u05D5\u05DC\u05E7\u05D1\u05DC \u05D0\u05EA \u05D4\u05D4\u05D6\u05DE\u05E0\u05D4"),n(),t(7,"button",6),C("click",function(){d(e);let l=c();return p(l.signInAndAccept())}),t(8,"mat-icon"),i(9,"login"),n(),i(10," \u05D4\u05EA\u05D7\u05D1\u05E8 \u05DB\u05D3\u05D9 \u05DC\u05D4\u05DE\u05E9\u05D9\u05DA "),n()()}}function H(o,r){if(o&1&&(t(0,"div",4)(1,"mat-icon"),i(2,"error_outline"),n(),t(3,"h2"),i(4,"\u05E9\u05D2\u05D9\u05D0\u05D4"),n(),t(5,"p"),i(6),n(),t(7,"button",7),i(8," \u05D7\u05D6\u05D5\u05E8 \u05DC\u05D1\u05D7\u05D9\u05E8\u05EA \u05DE\u05E9\u05E4\u05D7\u05D4 "),n()()),o&2){let e=c();a(6),v(e.error())}}function J(o,r){if(o&1){let e=D();t(0,"div",8)(1,"mat-icon"),i(2,"check_circle"),n(),t(3,"h2"),i(4,"\u05D1\u05E8\u05D5\u05DB\u05D9\u05DD \u05D4\u05D1\u05D0\u05D9\u05DD!"),n(),t(5,"p"),i(6),n(),t(7,"button",6),C("click",function(){d(e);let l=c(2);return p(l.goToFamily())}),i(8," \u05D4\u05DE\u05E9\u05DA \u05DC\u05D0\u05E4\u05DC\u05D9\u05E7\u05E6\u05D9\u05D4 "),n()()}if(o&2){let e=c(2);a(6),y("\u05D4\u05E6\u05D8\u05E8\u05E4\u05EA \u05D1\u05D4\u05E6\u05DC\u05D7\u05D4 \u05DC\u05DE\u05E9\u05E4\u05D7\u05EA ",e.invite().familyName)}}function K(o,r){if(o&1){let e=D();t(0,"div",16)(1,"mat-icon"),i(2,"info"),n(),t(3,"p"),i(4,"\u05E2\u05DC\u05D9\u05DA \u05DC\u05D4\u05EA\u05D7\u05D1\u05E8 \u05DB\u05D3\u05D9 \u05DC\u05E7\u05D1\u05DC \u05D0\u05EA \u05D4\u05D4\u05D6\u05DE\u05E0\u05D4"),n(),t(5,"button",6),C("click",function(){d(e);let l=c(3);return p(l.signInAndAccept())}),t(6,"mat-icon"),i(7,"login"),n(),i(8," \u05D4\u05EA\u05D7\u05D1\u05E8 \u05D5\u05E7\u05D1\u05DC \u05D4\u05D6\u05DE\u05E0\u05D4 "),n()()}}function Q(o,r){o&1&&x(0,"mat-spinner",19)}function U(o,r){o&1&&(M(0),t(1,"mat-icon"),i(2,"check"),n(),i(3," \u05E7\u05D1\u05DC \u05D4\u05D6\u05DE\u05E0\u05D4 "),P())}function W(o,r){if(o&1){let e=D();t(0,"div",17)(1,"button",18),C("click",function(){d(e);let l=c(3);return p(l.acceptInvite())}),g(2,Q,1,0,"mat-spinner",19)(3,U,4,0,"ng-container"),n(),t(4,"button",20),i(5," \u05D1\u05D9\u05D8\u05D5\u05DC "),n()()}if(o&2){let e=c(3);a(),h("disabled",e.isAccepting()),a(),_(e.isAccepting()?2:3)}}function X(o,r){if(o&1&&(t(0,"div",9)(1,"div",10)(2,"mat-icon",11),i(3,"family_restroom"),n(),t(4,"h1"),i(5,"\u05D4\u05D6\u05DE\u05E0\u05D4 \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4"),n()(),t(6,"div",12)(7,"div",13)(8,"span",14),i(9,"\u05DE\u05E9\u05E4\u05D7\u05D4:"),n(),t(10,"span",15),i(11),n()(),t(12,"div",13)(13,"span",14),i(14,"\u05EA\u05E4\u05E7\u05D9\u05D3:"),n(),t(15,"mat-chip"),i(16),n()(),t(17,"div",13)(18,"span",14),i(19,"\u05EA\u05D5\u05E7\u05E3 \u05E2\u05D3:"),n(),t(20,"span",15),i(21),n()()(),g(22,K,9,0,"div",16)(23,W,6,2,"div",17),n()),o&2){let e=c(2);a(11),v(e.invite().familyName),a(5),v(e.getRoleLabel(e.invite().role)),a(5),v(e.formatDate(e.invite().expiresAt)),a(),_(e.authService.isAuthenticated()?23:22)}}function Y(o,r){if(o&1&&g(0,J,9,1,"div",8)(1,X,24,4,"div",9),o&2){let e=c();_(e.isAccepted()?0:1)}}var j=class o{route=s(A);router=s(I);familyService=s(T);firestoreService=s(w);authService=s(k);invite=m(null);isLoading=m(!0);isAccepting=m(!1);isAccepted=m(!1);error=m(null);needsAuth=m(!1);acceptedFamilyId=null;roleLabels={admin:"\u05DE\u05E0\u05D4\u05DC",member:"\u05D7\u05D1\u05E8",viewer:"\u05E6\u05D5\u05E4\u05D4"};ngOnInit(){this.loadInvite()}loadInvite(){return f(this,null,function*(){let r=this.route.snapshot.paramMap.get("inviteId");if(!r){this.error.set("\u05E7\u05D9\u05E9\u05D5\u05E8 \u05D4\u05D6\u05DE\u05E0\u05D4 \u05DC\u05D0 \u05EA\u05E7\u05D9\u05DF"),this.isLoading.set(!1);return}if(!this.authService.isAuthenticated()){this.needsAuth.set(!0),this.isLoading.set(!1);return}try{let e=yield this.firestoreService.getDocument(`invites/${r}`);if(!e){this.error.set("\u05D4\u05D6\u05DE\u05E0\u05D4 \u05DC\u05D0 \u05E0\u05DE\u05E6\u05D0\u05D4"),this.isLoading.set(!1);return}if(e.usedBy){this.error.set("\u05D4\u05D4\u05D6\u05DE\u05E0\u05D4 \u05DB\u05D1\u05E8 \u05E0\u05D5\u05E6\u05DC\u05D4"),this.isLoading.set(!1);return}if(e.expiresAt.toDate()<new Date){this.error.set("\u05D4\u05D4\u05D6\u05DE\u05E0\u05D4 \u05E4\u05D2\u05D4 \u05EA\u05D5\u05E7\u05E3"),this.isLoading.set(!1);return}this.invite.set(e)}catch(e){console.error("Error loading invite:",e),this.error.set("\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D8\u05E2\u05D9\u05E0\u05EA \u05D4\u05D4\u05D6\u05DE\u05E0\u05D4")}finally{this.isLoading.set(!1)}})}getRoleLabel(r){return this.roleLabels[r]??r}formatDate(r){return r.toDate().toLocaleDateString("he-IL",{day:"numeric",month:"long",year:"numeric"})}signInAndAccept(){let r=this.route.snapshot.paramMap.get("inviteId");r&&(sessionStorage.setItem("pendingInviteId",r),this.router.navigate(["/auth/login"]))}acceptInvite(){return f(this,null,function*(){let r=this.invite();if(r){this.isAccepting.set(!0);try{let e=yield this.familyService.acceptInvite(r.id);this.acceptedFamilyId=e,this.isAccepted.set(!0)}catch(e){console.error("Error accepting invite:",e),this.error.set(e.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05E7\u05D1\u05DC\u05EA \u05D4\u05D4\u05D6\u05DE\u05E0\u05D4")}finally{this.isAccepting.set(!1)}}})}goToFamily(){this.acceptedFamilyId?(localStorage.setItem("selectedFamilyId",this.acceptedFamilyId),this.router.navigate(["/app"])):this.router.navigate(["/family-select"])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=E({type:o,selectors:[["app-accept-invite"]],decls:6,vars:1,consts:[[1,"accept-invite-page"],[1,"invite-card"],[1,"loading-state"],[1,"auth-required-state"],[1,"error-state"],["diameter","48"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","primary","routerLink","/family-select"],[1,"success-state"],[1,"invite-content"],[1,"invite-header"],[1,"invite-icon"],[1,"invite-details"],[1,"detail-row"],[1,"label"],[1,"value"],[1,"auth-required"],[1,"actions"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20"],["mat-button","","routerLink","/family-select"]],template:function(e,u){e&1&&(t(0,"div",0)(1,"div",1),g(2,$,4,0,"div",2)(3,G,11,0,"div",3)(4,H,9,1,"div",4)(5,Y,2,1),n()()),e&2&&(a(2),_(u.isLoading()?2:u.needsAuth()?3:u.error()?4:u.invite()?5:-1))},dependencies:[O,S,b,F,L,V,q,R,B,N,z],styles:[".accept-invite-page[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:1rem;background:var(--surface-secondary)}.invite-card[_ngcontent-%COMP%]{width:100%;max-width:400px;background:var(--surface-primary);border-radius:1.5rem;padding:2rem;box-shadow:0 4px 24px #00000014}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1.5rem;padding:2rem 0}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0}.auth-required-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:1rem;padding:2rem 0}.auth-required-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:var(--color-primary)}.auth-required-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:0;color:var(--text-primary)}.auth-required-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0}.auth-required-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem}.auth-required-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem;font-size:20px;width:20px;height:20px}.error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:1rem;padding:1rem 0}.error-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;color:var(--color-error)}.error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;margin:0;color:var(--text-primary)}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0}.error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem}.success-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:1rem;padding:1rem 0}.success-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:var(--color-success)}.success-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:0;color:var(--text-primary)}.success-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0;font-size:1.125rem}.success-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem}.invite-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.invite-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:.75rem}.invite-header[_ngcontent-%COMP%]   .invite-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;color:var(--color-primary)}.invite-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:0;color:var(--text-primary)}.invite-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;padding:1rem;background:var(--surface-secondary);border-radius:.75rem}.invite-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.invite-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem}.invite-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--text-primary);font-weight:500}.auth-required[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;text-align:center;gap:1rem;padding:1.5rem;background:var(--surface-secondary);border-radius:.75rem;border:1px dashed var(--border-subtle)}.auth-required[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-primary)}.auth-required[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-secondary)}.auth-required[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-inline-end:.5rem}"]})};export{j as AcceptInviteComponent};
