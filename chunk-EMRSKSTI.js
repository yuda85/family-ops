import{a as ie}from"./chunk-ZGV2CEMS.js";import"./chunk-MFQCTB6K.js";import{a as ne}from"./chunk-6ETVNFEW.js";import{a as ee,b as te}from"./chunk-2TCOEAW5.js";import{c as X,g as Y}from"./chunk-6EYLVA3C.js";import{a as Z}from"./chunk-ZP7QJX4J.js";import"./chunk-4S4SHBAA.js";import"./chunk-PBF26NQQ.js";import{a as H,b as J}from"./chunk-IU263WV3.js";import"./chunk-ISTWEN7X.js";import"./chunk-HVH6PFSI.js";import{c as K,d as Q}from"./chunk-VKZEWMLF.js";import"./chunk-GY27VXU3.js";import"./chunk-WPQFOBGJ.js";import{a as R,b as $,d as N,e as U,f as G}from"./chunk-OHJUE5IH.js";import"./chunk-ZOWI4QAM.js";import{c as W,i as j}from"./chunk-HH43CGJO.js";import"./chunk-IGP4P7SY.js";import{i as q,j as w}from"./chunk-3EH3MU74.js";import{Ab as y,Bb as T,Cb as r,Db as o,Eb as k,Fb as F,Gb as B,Hb as V,Lb as M,Pb as g,Rb as s,Sa as a,T as A,Y as m,ac as _,ba as h,bc as f,ca as v,dc as c,ec as P,fb as b,fc as S,gc as D,oa as I,oc as E,pc as O,vb as d,wb as u,yb as z,zb as x}from"./chunk-HNLZOKXJ.js";import{f as l}from"./chunk-ATWMZ64T.js";var C=class n{_isActive=I(!1);_intensity=I("small");isActive=this._isActive.asReadonly();intensity=this._intensity.asReadonly();celebrateCategory(){this._intensity.set("small"),this._isActive.set(!0),setTimeout(()=>this._isActive.set(!1),1500)}celebrateListComplete(){this._intensity.set("big"),this._isActive.set(!0),setTimeout(()=>this._isActive.set(!1),3e3)}stop(){this._isActive.set(!1)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=A({token:n,factory:n.\u0275fac,providedIn:"root"})};function se(n,t){if(n&1&&V(0,"div",3),n&2){let e=t.$implicit,i=s(2);_("--delay",i.getDelay(e))("--left",i.getLeft(e))("--color",i.getColor(e))("--rotation",i.getRotation(e))("--size",i.getSize(e))}}function le(n,t){if(n&1&&(F(0,"div",1),x(1,se,1,10,"div",2,z),B()),n&2){let e=s();f("big",e.confettiService.intensity()==="big"),a(),y(e.confettiPieces)}}var L=class n{confettiService=m(C);get confettiPieces(){let t=this.confettiService.intensity()==="big"?100:30;return Array.from({length:t},(e,i)=>i)}colors=["#ff6b6b","#feca57","#48dbfb","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#10ac84","#ee5a24"];getDelay(t){return Math.random()*500}getLeft(t){return Math.random()*100}getColor(t){return this.colors[t%this.colors.length]}getRotation(t){return Math.random()*360}getSize(t){return 8+Math.random()*8}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["app-confetti"]],decls:1,vars:1,consts:[[1,"confetti-container",3,"big"],[1,"confetti-container"],[1,"confetti-piece",3,"--delay","--left","--color","--rotation","--size"],[1,"confetti-piece"]],template:function(e,i){e&1&&d(0,le,3,2,"div",0),e&2&&u(i.confettiService.isActive()?0:-1)},dependencies:[w],styles:[".confetti-container[_ngcontent-%COMP%]{position:fixed;inset:0;pointer-events:none;z-index:9999;overflow:hidden}.confetti-piece[_ngcontent-%COMP%]{position:absolute;top:-20px;width:calc(var(--size) * 1px);height:calc(var(--size) * 1.5px);background:var(--color);left:calc(var(--left) * 1%);animation:_ngcontent-%COMP%_confetti-fall 2s ease-out forwards;animation-delay:calc(var(--delay) * 1ms);transform:rotate(calc(var(--rotation) * 1deg));border-radius:2px}.confetti-container.big[_ngcontent-%COMP%]   .confetti-piece[_ngcontent-%COMP%]{animation-duration:3s}@keyframes _ngcontent-%COMP%_confetti-fall{0%{top:-20px;opacity:1;transform:rotate(calc(var(--rotation) * 1deg)) translate(0)}to{top:100vh;opacity:0;transform:rotate(calc(var(--rotation) * 1deg + 720deg)) translate(calc(var(--left) * .5px - 25px))}}"]})};var pe=(n,t)=>t.category,me=(n,t)=>t.id;function de(n,t){n&1&&(r(0,"div",8),k(1,"mat-spinner",10),o())}function ue(n,t){n&1&&(r(0,"mat-icon"),c(1,"check_circle"),o())}function ge(n,t){n&1&&(r(0,"mat-icon"),c(1,"radio_button_unchecked"),o())}function _e(n,t){if(n&1&&(r(0,"span",29),c(1),o()),n&2){let e=s().$implicit,i=s(3);a(),D("",e.quantity," ",i.getUnitLabel(e.unit))}}function fe(n,t){if(n&1&&(r(0,"span",30),c(1),E(2,"number"),o()),n&2){let e=s().$implicit;a(),S("\u20AA",O(2,1,e.estimatedPrice*e.quantity,"1.0-0"))}}function Ce(n,t){if(n&1){let e=M();r(0,"button",25),g("click",function(){let p=h(e).$implicit,ae=s(3);return v(ae.quickCheck(p))}),r(1,"div",26),d(2,ue,2,0,"mat-icon")(3,ge,2,0,"mat-icon"),o(),r(4,"div",27)(5,"span",28),c(6),o(),d(7,_e,2,2,"span",29),o(),d(8,fe,3,4,"span",30),o()}if(n&2){let e=t.$implicit,i=s(3);f("checked",e.checked),T("disabled",i.isChecking),a(2),u(e.checked?2:3),a(4),P(e.name),a(),u(e.quantity>0?7:-1),a(),u(e.estimatedPrice>0?8:-1)}}function he(n,t){if(n&1&&(r(0,"div",19)(1,"div",20)(2,"mat-icon"),c(3),o(),r(4,"span",21),c(5),o(),r(6,"span",22),c(7),o()(),r(8,"div",23),x(9,Ce,9,7,"button",24,me),o()()),n&2){let e=t.$implicit,i=s(2);f("complete",e.isComplete),a(),_("border-color",e.categoryMeta.color),a(),_("color",e.categoryMeta.color),a(),P(e.categoryMeta.icon),a(2),P(e.categoryMeta.labelHe),a(2),D("",i.getCheckedCount(e),"/",e.items.length),a(2),y(e.items)}}function ve(n,t){if(n&1){let e=M();r(0,"button",31),g("click",function(){h(e);let p=s(2);return v(p.completeShopping())}),r(1,"mat-icon"),c(2,"check"),o(),c(3," \u05E1\u05D9\u05D5\u05DD \u05E7\u05E0\u05D9\u05D5\u05EA "),o()}}function xe(n,t){if(n&1){let e=M();r(0,"div",18)(1,"div",32)(2,"mat-icon",33),c(3,"check_circle"),o(),r(4,"h2"),c(5,"\u05DB\u05DC \u05D4\u05E4\u05E8\u05D9\u05D8\u05D9\u05DD \u05E0\u05E7\u05E0\u05D5!"),o(),r(6,"p"),c(7),E(8,"number"),o(),r(9,"button",34),g("click",function(){h(e);let p=s(2);return v(p.completeShopping())}),c(10," \u05E1\u05D9\u05D5\u05DD \u05E7\u05E0\u05D9\u05D5\u05EA "),o()()()}if(n&2){let e=s(2);a(7),S('\u05E1\u05D4"\u05DB \u05DE\u05E9\u05D5\u05E2\u05E8: \u20AA',O(8,1,e.shoppingService.estimatedTotal(),"1.0-0"))}}function ye(n,t){if(n&1&&(r(0,"div",11),x(1,he,11,10,"div",12,pe),o(),r(3,"div",13)(4,"div",14)(5,"span",15),c(6,'\u05E1\u05D4"\u05DB \u05DE\u05E9\u05D5\u05E2\u05E8'),o(),r(7,"span",16),c(8),E(9,"number"),o()(),d(10,ve,4,0,"button",17),o(),d(11,xe,11,4,"div",18)),n&2){let e=s();a(),y(e.shoppingService.groupedItems()),a(7),S("\u20AA",O(9,3,e.shoppingService.estimatedTotal(),"1.0-0")),a(2),u(e.shoppingService.isListComplete()?10:-1),a(),u(e.shoppingService.isListComplete()?11:-1)}}function Me(n,t){if(n&1){let e=M();r(0,"app-empty-state",35),g("action",function(){h(e);let p=s();return v(p.exitSupermarketMode())}),o()}}var re=class n{shoppingService=m(Q);catalogService=m(ne);confettiService=m(C);router=m(W);dialog=m(X);snackBar=m(ee);wakeLock=null;previousCompletedCategories=[];isChecking=!1;ngOnInit(){return l(this,null,function*(){this.catalogService.isLoaded()||(yield this.catalogService.loadCatalog()),this.shoppingService.activeList()||(yield this.shoppingService.loadActiveList()),yield this.shoppingService.enterSupermarketMode(),yield this.requestWakeLock()})}ngOnDestroy(){return l(this,null,function*(){yield this.releaseWakeLock()})}requestWakeLock(){return l(this,null,function*(){try{"wakeLock"in navigator&&(this.wakeLock=yield navigator.wakeLock.request("screen"),console.log("Wake lock acquired"),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)))}catch(t){console.warn("Wake lock not available:",t)}})}releaseWakeLock(){return l(this,null,function*(){this.wakeLock&&(yield this.wakeLock.release(),this.wakeLock=null,console.log("Wake lock released")),document.removeEventListener("visibilitychange",this.handleVisibilityChange.bind(this))})}handleVisibilityChange(){return l(this,null,function*(){document.visibilityState==="visible"&&!this.wakeLock&&(yield this.requestWakeLock())})}quickCheck(t){return l(this,null,function*(){this.isChecking=!0;try{yield this.shoppingService.quickCheck(t.id),this.checkForCelebrations()}catch(e){this.snackBar.open(e.message||"\u05E9\u05D2\u05D9\u05D0\u05D4","\u05E1\u05D2\u05D5\u05E8",{duration:2e3})}finally{this.isChecking=!1}})}checkForCelebrations(){let t=this.shoppingService.completedCategories();if(this.shoppingService.isListComplete()){this.confettiService.celebrateListComplete();return}t.filter(i=>!this.previousCompletedCategories.includes(i)).length>0&&this.confettiService.celebrateCategory(),this.previousCompletedCategories=[...t]}undo(){return l(this,null,function*(){try{yield this.shoppingService.undoLastCheck()}catch(t){this.snackBar.open(t.message||"\u05E9\u05D2\u05D9\u05D0\u05D4","\u05E1\u05D2\u05D5\u05E8",{duration:2e3})}})}exitSupermarketMode(){return l(this,null,function*(){yield this.shoppingService.exitSupermarketMode(),yield this.releaseWakeLock(),this.router.navigate(["/app/shopping"])})}completeShopping(){return l(this,null,function*(){this.dialog.open(ie,{width:"100%",maxWidth:"450px",disableClose:!0}).afterClosed().subscribe(e=>l(this,null,function*(){e?.success&&(yield this.exitSupermarketMode(),this.snackBar.open("\u05E7\u05E0\u05D9\u05D5\u05EA \u05D4\u05D5\u05E9\u05DC\u05DE\u05D5 \u05D1\u05D4\u05E6\u05DC\u05D7\u05D4!","",{duration:3e3}))}))})}getCheckedCount(t){return t.items.filter(e=>e.checked).length}getUnitLabel(t){return K(t).shortHe}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=b({type:n,selectors:[["app-supermarket-mode"]],decls:19,vars:8,consts:[[1,"supermarket-page"],[1,"super-header"],["mat-icon-button","",1,"exit-btn",3,"click"],[1,"header-center"],[1,"progress-text"],["mat-icon-button","",1,"undo-btn",3,"click","disabled"],[1,"super-progress"],[1,"progress-fill"],[1,"loading-container"],["icon","shopping_basket","title","\u05D4\u05E8\u05E9\u05D9\u05DE\u05D4 \u05E8\u05D9\u05E7\u05D4","description","\u05D0\u05D9\u05DF \u05E4\u05E8\u05D9\u05D8\u05D9\u05DD \u05D1\u05E8\u05E9\u05D9\u05DE\u05EA \u05D4\u05E7\u05E0\u05D9\u05D5\u05EA","actionLabel","\u05D7\u05D6\u05D5\u05E8 \u05DC\u05E8\u05E9\u05D9\u05DE\u05D4","actionIcon","arrow_forward"],["diameter","48"],[1,"super-categories"],[1,"super-category",3,"complete"],[1,"super-bottom"],[1,"total-section"],[1,"total-label"],[1,"total-amount"],["mat-flat-button","","color","primary",1,"complete-btn"],[1,"completion-overlay"],[1,"super-category"],[1,"category-header"],[1,"category-name"],[1,"category-progress"],[1,"super-items"],[1,"super-item",3,"checked","disabled"],[1,"super-item",3,"click","disabled"],[1,"item-check"],[1,"item-content"],[1,"item-name"],[1,"item-qty"],[1,"item-price"],["mat-flat-button","","color","primary",1,"complete-btn",3,"click"],[1,"completion-content"],[1,"check-icon"],["mat-flat-button","","color","primary",3,"click"],["icon","shopping_basket","title","\u05D4\u05E8\u05E9\u05D9\u05DE\u05D4 \u05E8\u05D9\u05E7\u05D4","description","\u05D0\u05D9\u05DF \u05E4\u05E8\u05D9\u05D8\u05D9\u05DD \u05D1\u05E8\u05E9\u05D9\u05DE\u05EA \u05D4\u05E7\u05E0\u05D9\u05D5\u05EA","actionLabel","\u05D7\u05D6\u05D5\u05E8 \u05DC\u05E8\u05E9\u05D9\u05DE\u05D4","actionIcon","arrow_forward",3,"action"]],template:function(e,i){e&1&&(k(0,"app-confetti"),r(1,"div",0)(2,"header",1)(3,"button",2),g("click",function(){return i.exitSupermarketMode()}),r(4,"mat-icon"),c(5,"close"),o()(),r(6,"div",3)(7,"h1"),c(8,"\u05DE\u05E6\u05D1 \u05E1\u05D5\u05E4\u05E8"),o(),r(9,"span",4),c(10),o()(),r(11,"button",5),g("click",function(){return i.undo()}),r(12,"mat-icon"),c(13,"undo"),o()()(),r(14,"div",6),k(15,"div",7),o(),d(16,de,2,0,"div",8)(17,ye,12,6)(18,Me,1,0,"app-empty-state",9),o()),e&2&&(a(),f("complete",i.shoppingService.isListComplete()),a(9),D(" ",i.shoppingService.checkedCount(),"/",i.shoppingService.totalCount()," "),a(),T("disabled",!i.shoppingService.canUndo()),a(4),_("width",i.shoppingService.progress(),"%"),a(),u(i.shoppingService.isLoading()?16:i.shoppingService.hasItems()?17:18))},dependencies:[w,j,N,$,R,G,U,te,J,H,Y,Z,L,q],styles:[".supermarket-page[_ngcontent-%COMP%]{position:fixed;inset:0;background:var(--surface-primary);display:flex;flex-direction:column;z-index:1000;overflow:hidden}.supermarket-page.complete[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-success) 5%,var(--surface-primary))}.super-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.75rem 1rem;background:var(--surface-secondary);border-bottom:1px solid var(--border-subtle)}.super-header[_ngcontent-%COMP%]   .header-center[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.super-header[_ngcontent-%COMP%]   .header-center[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.125rem;font-weight:600;color:var(--text-primary)}.super-header[_ngcontent-%COMP%]   .header-center[_ngcontent-%COMP%]   .progress-text[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary)}.super-header[_ngcontent-%COMP%]   .exit-btn[_ngcontent-%COMP%], .super-header[_ngcontent-%COMP%]   .undo-btn[_ngcontent-%COMP%]{width:48px;height:48px}.super-header[_ngcontent-%COMP%]   .undo-btn[_ngcontent-%COMP%]:disabled{opacity:.3}.super-progress[_ngcontent-%COMP%]{height:6px;background:var(--surface-secondary)}.super-progress[_ngcontent-%COMP%]   .progress-fill[_ngcontent-%COMP%]{height:100%;background:var(--color-primary);transition:width .3s ease}.loading-container[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center}.super-categories[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1rem;padding-bottom:100px}.super-category[_ngcontent-%COMP%]{margin-bottom:1.5rem}.super-category.complete[_ngcontent-%COMP%]{opacity:.7}.super-category.complete[_ngcontent-%COMP%]   .category-header[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-success) 10%,var(--surface-secondary))}.category-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:var(--surface-secondary);border-radius:.75rem;border-inline-start:4px solid;margin-bottom:.75rem}.category-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.category-header[_ngcontent-%COMP%]   .category-name[_ngcontent-%COMP%]{flex:1;font-weight:600;color:var(--text-primary)}.category-header[_ngcontent-%COMP%]   .category-progress[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary)}.super-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.super-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;width:100%;padding:1rem;background:var(--surface-primary);border:2px solid var(--border-subtle);border-radius:1rem;cursor:pointer;transition:all .15s ease;text-align:start;min-height:64px}.super-item[_ngcontent-%COMP%]:active:not(:disabled){transform:scale(.98);background:var(--surface-hover)}.super-item.checked[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-success) 10%,var(--surface-primary));border-color:var(--color-success)}.super-item.checked[_ngcontent-%COMP%]   .item-check[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--color-success)}.super-item.checked[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--text-tertiary)}.super-item[_ngcontent-%COMP%]:disabled{opacity:.7}.super-item[_ngcontent-%COMP%]   .item-check[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:28px;width:28px;height:28px;color:var(--text-tertiary)}.super-item[_ngcontent-%COMP%]   .item-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.125rem}.super-item[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]{font-size:1.0625rem;font-weight:500;color:var(--text-primary)}.super-item[_ngcontent-%COMP%]   .item-qty[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--text-secondary)}.super-item[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-primary);font-weight:500}.super-bottom[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--surface-secondary);border-top:1px solid var(--border-subtle);gap:1rem}.super-bottom[_ngcontent-%COMP%]   .total-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.super-bottom[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.super-bottom[_ngcontent-%COMP%]   .total-amount[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:var(--color-primary)}.super-bottom[_ngcontent-%COMP%]   .complete-btn[_ngcontent-%COMP%]{min-width:120px;height:48px;font-size:1rem}.super-bottom[_ngcontent-%COMP%]   .complete-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem}.completion-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:10;animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.completion-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:2rem;background:var(--surface-primary);border-radius:1.5rem;text-align:center;gap:1rem;animation:_ngcontent-%COMP%_scaleIn .3s ease}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}.completion-content[_ngcontent-%COMP%]   .check-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:var(--color-success)}.completion-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;color:var(--text-primary)}.completion-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--text-secondary)}.completion-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:.5rem}"]})};export{re as SupermarketModeComponent};
