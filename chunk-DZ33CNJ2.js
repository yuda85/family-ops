import{a as re}from"./chunk-UG5JRMFQ.js";import{a as oe}from"./chunk-6ETVNFEW.js";import{a as ie}from"./chunk-2TCOEAW5.js";import{a as te,g as ne}from"./chunk-6EYLVA3C.js";import{a as J,c as K,d as X}from"./chunk-4S4SHBAA.js";import{c as Y}from"./chunk-4SS6VL3O.js";import{d as G,e as U,h as q}from"./chunk-PBF26NQQ.js";import{a as z,b as j}from"./chunk-IU263WV3.js";import{b as $,f as H,i as L,q as W}from"./chunk-HVH6PFSI.js";import{a as Z,d as ee}from"./chunk-VKZEWMLF.js";import{a as F,b as Q,d as R,e as A,f as B}from"./chunk-OHJUE5IH.js";import{j as N}from"./chunk-3EH3MU74.js";import{Ab as P,Bb as S,Cb as i,Db as r,Eb as D,Lb as C,Pb as d,Rb as l,Sa as s,Y as x,ac as E,ba as u,bc as I,ca as p,dc as c,ec as v,fb as k,fc as f,ic as O,jc as w,kc as T,oa as h,tc as V,vb as g,wb as _,zb as y}from"./chunk-HNLZOKXJ.js";import{f as M}from"./chunk-ATWMZ64T.js";var b=(n,t)=>t.id;function ce(n,t){if(n&1){let e=C();i(0,"button",16),d("click",function(){u(e);let a=l();return p(a.clearSearch())}),i(1,"mat-icon"),c(2,"close"),r()()}}function se(n,t){if(n&1){let e=C();i(0,"button",20),d("click",function(){let a=u(e).$implicit,m=l(3);return p(m.toggleItem(a))}),i(1,"span",21),c(2),r(),i(3,"span",22)(4,"span",23),c(5),r(),i(6,"mat-icon",24),c(7),r()()()}if(n&2){let e=t.$implicit,o=l(3);I("selected",o.isItemSelected(e.id)),s(2),v(e.nameHe),s(3),f("\u20AA",e.estimatedPrice),s(2),f(" ",o.isItemSelected(e.id)?"check":"add"," ")}}function le(n,t){if(n&1&&(i(0,"div",17),y(1,se,8,5,"button",19,b),r()),n&2){let e=l(2);s(),P(e.searchResults())}}function me(n,t){if(n&1){let e=C();i(0,"div",18)(1,"p"),c(2,"\u05DC\u05D0 \u05E0\u05DE\u05E6\u05D0\u05D5 \u05EA\u05D5\u05E6\u05D0\u05D5\u05EA"),r(),i(3,"button",25),d("click",function(){u(e);let a=l(2);return p(a.addCustomItem())}),i(4,"mat-icon"),c(5,"add"),r(),c(6),r()()}if(n&2){let e=l(2);s(6),f(' \u05D4\u05D5\u05E1\u05E3 "',e.searchQuery,'" ')}}function de(n,t){if(n&1&&(i(0,"div",8),g(1,le,3,0,"div",17)(2,me,7,1,"div",18),r()),n&2){let e=l();s(),_(e.searchResults().length>0?1:2)}}function ue(n,t){if(n&1){let e=C();i(0,"button",30),d("click",function(){let a=u(e).$implicit,m=l(2);return p(m.selectCategory(a.id))}),i(1,"mat-icon"),c(2),r(),i(3,"span"),c(4),r()()}if(n&2){let e=t.$implicit,o=l(2);I("active",o.selectedCategory()===e.id),s(),E("color",e.color),s(),v(e.icon),s(2),v(e.labelHe)}}function pe(n,t){if(n&1){let e=C();i(0,"button",20),d("click",function(){let a=u(e).$implicit,m=l(3);return p(m.toggleItem(a))}),i(1,"span",21),c(2),r(),i(3,"span",22)(4,"span",23),c(5),r(),i(6,"mat-icon",24),c(7),r()()()}if(n&2){let e=t.$implicit,o=l(3);I("selected",o.isItemSelected(e.id)),s(2),v(e.nameHe),s(3),f("\u20AA",e.estimatedPrice),s(2),f(" ",o.isItemSelected(e.id)?"check":"add"," ")}}function ge(n,t){if(n&1&&y(0,pe,8,5,"button",19,b),n&2){let e=l(2);P(e.categoryItems())}}function _e(n,t){n&1&&(i(0,"div",29)(1,"mat-icon"),c(2,"inventory_2"),r(),i(3,"p"),c(4,"\u05D0\u05D9\u05DF \u05E4\u05E8\u05D9\u05D8\u05D9\u05DD \u05D1\u05E7\u05D8\u05D2\u05D5\u05E8\u05D9\u05D4 \u05D6\u05D5"),r()())}function Ce(n,t){if(n&1&&(i(0,"div",9)(1,"div",26),y(2,ue,5,6,"button",27,b),r(),i(4,"div",28),g(5,ge,2,0)(6,_e,5,0,"div",29),r()()),n&2){let e=l();s(2),P(e.categories),s(3),_(e.categoryItems().length>0?5:6)}}function fe(n,t){if(n&1){let e=C();i(0,"div",11)(1,"span"),c(2),r(),i(3,"button",31),d("click",function(){u(e);let a=l();return p(a.clearSelection())}),i(4,"mat-icon"),c(5,"clear_all"),r(),c(6," \u05E0\u05E7\u05D4 "),r()()}if(n&2){let e=l();s(2),f("\u05E0\u05D1\u05D7\u05E8\u05D5 ",e.pendingItems().length," \u05E4\u05E8\u05D9\u05D8\u05D9\u05DD")}}function he(n,t){n&1&&D(0,"mat-spinner",15)}function xe(n,t){n&1&&(i(0,"mat-icon"),c(1,"add_shopping_cart"),r(),c(2," \u05D4\u05D5\u05E1\u05E3 \u05DC\u05E8\u05E9\u05D9\u05DE\u05D4 "))}var ae=class n{dialogRef=x(te);shoppingService=x(ee);catalogService=x(oe);snackBar=x(ie);categories=Z;searchQuery="";selectedCategory=h("vegetables");searchResults=h([]);pendingItems=h([]);isSaving=h(!1);selectedIds=h(new Set);categoryItems=V(()=>this.catalogService.getItemsByCategory(this.selectedCategory()));onSearchChange(t){if(!t||t.trim().length===0){this.searchResults.set([]);return}let e=this.catalogService.searchItems(t);this.searchResults.set(e)}selectCategory(t){this.selectedCategory.set(t)}isItemSelected(t){return this.selectedIds().has(t)}toggleItem(t){let e=this.selectedIds();if(e.has(t.id)){let o=new Set(e);o.delete(t.id),this.selectedIds.set(o),this.pendingItems.update(a=>a.filter(m=>m.data.catalogItemId!==t.id))}else{let o=new Set(e);o.add(t.id),this.selectedIds.set(o),this.pendingItems.update(a=>[...a,{catalogItem:t,data:{catalogItemId:t.id,name:t.nameHe,category:t.category,quantity:t.defaultQuantity,unit:t.defaultUnit,estimatedPrice:t.estimatedPrice}}])}}addCustomItem(){if(!this.searchQuery||this.searchQuery.trim().length===0)return;let t=this.searchQuery.trim(),e=this.catalogService.categorizeItem(t);if(this.pendingItems().some(a=>a.customName===t)){this.snackBar.open("\u05E4\u05E8\u05D9\u05D8 \u05D6\u05D4 \u05DB\u05D1\u05E8 \u05D1\u05E8\u05E9\u05D9\u05DE\u05D4","",{duration:2e3});return}this.pendingItems.update(a=>[...a,{customName:t,data:{name:t,category:e,quantity:1,unit:"units",estimatedPrice:0}}]),this.clearSearch(),this.snackBar.open(`"${t}" \u05E0\u05D5\u05E1\u05E3 \u05DC\u05E8\u05E9\u05D9\u05DE\u05D4`,"",{duration:2e3})}clearSelection(){this.pendingItems.set([]),this.selectedIds.set(new Set)}clearSearch(){this.searchQuery="",this.searchResults.set([])}saveItems(){return M(this,null,function*(){let t=this.pendingItems();if(t.length!==0){this.isSaving.set(!0);try{for(let e of t)yield this.shoppingService.addItem(e.data);this.snackBar.open(`\u05E0\u05D5\u05E1\u05E4\u05D5 ${t.length} \u05E4\u05E8\u05D9\u05D8\u05D9\u05DD \u05DC\u05E8\u05E9\u05D9\u05DE\u05D4`,"",{duration:3e3}),this.dialogRef.close(!0)}catch(e){this.snackBar.open(e.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D4\u05D5\u05E1\u05E4\u05EA \u05E4\u05E8\u05D9\u05D8\u05D9\u05DD","\u05E1\u05D2\u05D5\u05E8",{duration:3e3})}finally{this.isSaving.set(!1)}}})}cancel(){this.dialogRef.close(!1)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=k({type:n,selectors:[["app-item-picker"]],decls:23,vars:6,consts:[[1,"item-picker"],[1,"picker-header"],["mat-icon-button","",3,"click"],[1,"search-section"],["appearance","outline",1,"search-field"],["matPrefix",""],["matInput","","type","text","placeholder","\u05D7\u05D9\u05E4\u05D5\u05E9 \u05E4\u05E8\u05D9\u05D8\u05D9\u05DD...",3,"ngModelChange","ngModel"],["mat-icon-button","","matSuffix",""],[1,"search-results"],[1,"categories-section"],[1,"picker-footer"],[1,"selected-summary"],[1,"footer-actions"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["diameter","20"],["mat-icon-button","","matSuffix","",3,"click"],[1,"results-list"],[1,"no-results"],[1,"item-button",3,"selected"],[1,"item-button",3,"click"],[1,"item-name"],[1,"item-meta"],[1,"item-price"],[1,"add-icon"],["mat-stroked-button","",3,"click"],[1,"category-chips"],[1,"category-chip",3,"active"],[1,"category-items"],[1,"empty-category"],[1,"category-chip",3,"click"],["mat-button","","color","warn",3,"click"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"header",1)(2,"h2"),c(3,"\u05D4\u05D5\u05E1\u05E4\u05EA \u05E4\u05E8\u05D9\u05D8\u05D9\u05DD"),r(),i(4,"button",2),d("click",function(){return o.cancel()}),i(5,"mat-icon"),c(6,"close"),r()()(),i(7,"div",3)(8,"mat-form-field",4)(9,"mat-icon",5),c(10,"search"),r(),i(11,"input",6),T("ngModelChange",function(m){return w(o.searchQuery,m)||(o.searchQuery=m),m}),d("ngModelChange",function(m){return o.onSearchChange(m)}),r(),g(12,ce,3,0,"button",7),r()(),g(13,de,3,1,"div",8)(14,Ce,7,1,"div",9),i(15,"footer",10),g(16,fe,7,1,"div",11),i(17,"div",12)(18,"button",13),d("click",function(){return o.cancel()}),c(19,"\u05D1\u05D9\u05D8\u05D5\u05DC"),r(),i(20,"button",14),d("click",function(){return o.saveItems()}),g(21,he,1,0,"mat-spinner",15)(22,xe,3,0),r()()()()),e&2&&(s(11),O("ngModel",o.searchQuery),s(),_(o.searchQuery?12:-1),s(),_(o.searchQuery?13:14),s(3),_(o.pendingItems().length>0?16:-1),s(4),S("disabled",o.pendingItems().length===0||o.isSaving()),s(),_(o.isSaving()?21:22))},dependencies:[N,W,$,H,L,ne,R,Q,F,B,A,J,q,G,U,X,K,re,Y,j,z],styles:[".item-picker[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:var(--surface-primary)}.picker-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;border-bottom:1px solid var(--border-subtle)}.picker-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--text-primary)}.search-section[_ngcontent-%COMP%]{padding:1rem;padding-bottom:0}.search-field[_ngcontent-%COMP%]{width:100%}.search-field[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}.search-field[_ngcontent-%COMP%]     .mat-mdc-form-field-icon-prefix{padding-inline-end:.5rem;color:var(--text-tertiary)}.search-results[_ngcontent-%COMP%], .categories-section[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1rem}.results-list[_ngcontent-%COMP%], .category-items[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.item-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;padding:.875rem 1rem;background:var(--surface-secondary);border:1px solid var(--border-subtle);border-radius:.75rem;cursor:pointer;transition:all .15s ease;text-align:start}.item-button[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--surface-hover);border-color:var(--color-primary)}.item-button[_ngcontent-%COMP%]:hover:not(:disabled)   .add-icon[_ngcontent-%COMP%]{color:var(--color-primary)}.item-button.selected[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--color-primary) 15%,var(--surface-secondary));border-color:var(--color-primary)}.item-button.selected[_ngcontent-%COMP%]   .add-icon[_ngcontent-%COMP%]{color:var(--color-primary)}.item-button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.item-button[_ngcontent-%COMP%]   .item-name[_ngcontent-%COMP%]{font-size:.9375rem;color:var(--text-primary)}.item-button[_ngcontent-%COMP%]   .item-meta[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.item-button[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.item-button[_ngcontent-%COMP%]   .add-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;color:var(--text-tertiary);transition:color .15s ease}.no-results[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;gap:1rem}.no-results[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0}.category-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--border-subtle)}.category-chip[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.375rem;padding:.5rem .75rem;background:var(--surface-secondary);border:1px solid var(--border-subtle);border-radius:9999px;cursor:pointer;transition:all .15s ease;font-size:.8125rem;color:var(--text-secondary)}.category-chip[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px}.category-chip[_ngcontent-%COMP%]:hover{background:var(--surface-hover)}.category-chip.active[_ngcontent-%COMP%]{background:var(--color-primary-alpha);border-color:var(--color-primary);color:var(--color-primary)}.empty-category[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;gap:.5rem;color:var(--text-tertiary)}.empty-category[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px}.empty-category[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.picker-footer[_ngcontent-%COMP%]{padding:1rem;border-top:1px solid var(--border-subtle);background:var(--surface-secondary)}.selected-summary[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;font-size:.875rem;color:var(--text-secondary)}.selected-summary[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;width:18px;height:18px;margin-inline-end:.25rem}.footer-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}.footer-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem}.footer-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin-inline-end:.5rem}"]})};export{ae as a};
