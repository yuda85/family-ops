import{a as Z}from"./chunk-HCSAL4KD.js";import{a as oe,c as ae,d as re}from"./chunk-BFWFC2UO.js";import{a as ee,b as te,d as ie,h as ne}from"./chunk-DNCMLEWE.js";import{a as B,b as $}from"./chunk-BCPCSMU2.js";import{a as le,b as me}from"./chunk-2RBDTNNC.js";import{a as q}from"./chunk-4Q6TRDAS.js";import{b as H,d as h,f as J,g as K,j as Q,l as U,m as W,p as X,r as Y}from"./chunk-FSRTV3VH.js";import"./chunk-QJJTVXVB.js";import{d as A}from"./chunk-X4QG5DAP.js";import{b as N,d as z,e as G,f as R}from"./chunk-SXGBHULN.js";import{i as V}from"./chunk-EB5YHKWW.js";import{i as j,j as L}from"./chunk-JFU3JZIN.js";import{a as k,c as T,i as I}from"./chunk-TWWUOU6R.js";import{k as w}from"./chunk-OJNKK6II.js";import{Ab as F,Bb as x,Cb as n,Db as o,Eb as C,Lb as E,Pb as d,Rb as c,Sa as m,Y as f,ba as _,bc as P,ca as g,dc as r,ec as v,fb as M,fc as O,oa as y,ub as b,vb as u,wb as s,zb as S}from"./chunk-QZLPLYI5.js";import{f as D}from"./chunk-ATWMZ64T.js";var se=(e,i)=>i.familyId;function de(e,i){e&1&&r(0," \u05D1\u05D7\u05D9\u05E8\u05EA \u05DE\u05E9\u05E4\u05D7\u05D4 ")}function pe(e,i){e&1&&r(0," \u05D9\u05E6\u05D9\u05E8\u05EA \u05DE\u05E9\u05E4\u05D7\u05D4 \u05D7\u05D3\u05E9\u05D4 ")}function fe(e,i){e&1&&r(0," \u05D4\u05E6\u05D8\u05E8\u05E4\u05D5\u05EA \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4 ")}function _e(e,i){if(e&1){let t=E();n(0,"button",15),d("click",function(){let l=_(t).$implicit,p=c(3);return g(p.selectFamily(l.familyId))}),n(1,"div",16),r(2),o(),n(3,"div",17)(4,"span",18),r(5),o(),n(6,"span",19),r(7),o()(),n(8,"mat-icon",20),r(9,"chevron_left"),o()()}if(e&2){let t=i.$implicit,a=c(3);P("active",a.authService.activeFamilyId()===t.familyId),m(2),O(" ",t.name.substring(0,2)," "),m(3),v(t.name),m(2),v(a.getRoleLabel(t.role))}}function ge(e,i){if(e&1&&(n(0,"div",8),S(1,_e,10,5,"button",14,se),o()),e&2){let t=c(2);m(),F(t.families())}}function Ce(e,i){e&1&&(n(0,"div",9),C(1,"mat-spinner",21),n(2,"p"),r(3,"\u05D8\u05D5\u05E2\u05DF \u05DE\u05E9\u05E4\u05D7\u05D5\u05EA..."),o()())}function De(e,i){e&1&&(n(0,"div",10)(1,"mat-icon"),r(2,"family_restroom"),o(),n(3,"p"),r(4,"\u05D0\u05D9\u05DF \u05DC\u05DA \u05DE\u05E9\u05E4\u05D7\u05D5\u05EA \u05E2\u05D3\u05D9\u05D9\u05DF"),o(),n(5,"p",22),r(6,"\u05E6\u05E8\u05D5 \u05DE\u05E9\u05E4\u05D7\u05D4 \u05D7\u05D3\u05E9\u05D4 \u05D0\u05D5 \u05D4\u05E6\u05D8\u05E8\u05E4\u05D5 \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4 \u05E7\u05D9\u05D9\u05DE\u05EA"),o()())}function ye(e,i){if(e&1){let t=E();u(0,ge,3,0,"div",8)(1,Ce,4,0,"div",9)(2,De,7,0,"div",10),C(3,"mat-divider"),n(4,"div",11)(5,"button",12),d("click",function(){_(t);let l=c();return g(l.viewMode.set("create"))}),n(6,"mat-icon"),r(7,"add"),o(),r(8," \u05E6\u05D5\u05E8 \u05DE\u05E9\u05E4\u05D7\u05D4 \u05D7\u05D3\u05E9\u05D4 "),o(),n(9,"button",13),d("click",function(){_(t);let l=c();return g(l.viewMode.set("join"))}),n(10,"mat-icon"),r(11,"group_add"),o(),r(12," \u05D4\u05E6\u05D8\u05E8\u05E3 \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4 "),o()()}if(e&2){let t=c();s(t.families().length>0?0:t.isLoadingFamilies()?1:2)}}function ve(e,i){e&1&&(n(0,"mat-error"),r(1,"\u05E0\u05D0 \u05DC\u05D4\u05D6\u05D9\u05DF \u05E9\u05DD"),o())}function xe(e,i){if(e&1&&(n(0,"div",27)(1,"mat-icon"),r(2,"error"),o(),n(3,"span"),r(4),o()()),e&2){let t=c(2);m(4),v(t.error())}}function Ee(e,i){e&1&&C(0,"mat-spinner",31)}function he(e,i){e&1&&r(0," \u05D9\u05E6\u05D9\u05E8\u05EA \u05DE\u05E9\u05E4\u05D7\u05D4 ")}function Me(e,i){if(e&1){let t=E();n(0,"form",23),d("ngSubmit",function(){_(t);let l=c();return g(l.createFamily())}),n(1,"mat-form-field",24)(2,"mat-label"),r(3,"\u05E9\u05DD \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4"),o(),C(4,"input",25),n(5,"mat-icon",26),r(6,"badge"),o(),u(7,ve,2,0,"mat-error"),o(),u(8,xe,5,1,"div",27),n(9,"div",28)(10,"button",29),d("click",function(){_(t);let l=c();return g(l.viewMode.set("select"))}),r(11," \u05D7\u05D6\u05E8\u05D4 "),o(),n(12,"button",30),u(13,Ee,1,0,"mat-spinner",31)(14,he,1,0),o()()()}if(e&2){let t,a=c();x("formGroup",a.createForm),m(7),s((t=a.createForm.get("name"))!=null&&t.hasError("required")&&((t=a.createForm.get("name"))!=null&&t.touched)?7:-1),m(),s(a.error()?8:-1),m(4),x("disabled",a.createForm.invalid||a.isLoading()),m(),s(a.isLoading()?13:14)}}function be(e,i){e&1&&(n(0,"mat-error"),r(1,"\u05E0\u05D0 \u05DC\u05D4\u05D6\u05D9\u05DF \u05E7\u05D5\u05D3 \u05D4\u05D6\u05DE\u05E0\u05D4"),o())}function Se(e,i){if(e&1&&(n(0,"div",27)(1,"mat-icon"),r(2,"error"),o(),n(3,"span"),r(4),o()()),e&2){let t=c(2);m(4),v(t.error())}}function Fe(e,i){e&1&&C(0,"mat-spinner",31)}function Pe(e,i){e&1&&r(0," \u05D4\u05E6\u05D8\u05E8\u05E4\u05D5\u05EA ")}function Oe(e,i){if(e&1){let t=E();n(0,"form",23),d("ngSubmit",function(){_(t);let l=c();return g(l.joinFamily())}),n(1,"mat-form-field",24)(2,"mat-label"),r(3,"\u05E7\u05D5\u05D3 \u05D4\u05D6\u05DE\u05E0\u05D4"),o(),C(4,"input",32),n(5,"mat-icon",26),r(6,"vpn_key"),o(),u(7,be,2,0,"mat-error"),o(),n(8,"p",33),r(9,"\u05D4\u05D6\u05D9\u05E0\u05D5 \u05D0\u05EA \u05E7\u05D5\u05D3 \u05D4\u05D4\u05D6\u05DE\u05E0\u05D4 \u05E9\u05E7\u05D9\u05D1\u05DC\u05EA\u05DD \u05DE\u05D0\u05D7\u05D3 \u05DE\u05D1\u05E0\u05D9 \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4"),o(),u(10,Se,5,1,"div",27),n(11,"div",28)(12,"button",29),d("click",function(){_(t);let l=c();return g(l.viewMode.set("select"))}),r(13," \u05D7\u05D6\u05E8\u05D4 "),o(),n(14,"button",30),u(15,Fe,1,0,"mat-spinner",31)(16,Pe,1,0),o()()()}if(e&2){let t,a=c();x("formGroup",a.joinForm),m(7),s((t=a.joinForm.get("inviteCode"))!=null&&t.hasError("required")&&((t=a.joinForm.get("inviteCode"))!=null&&t.touched)?7:-1),m(3),s(a.error()?10:-1),m(4),x("disabled",a.joinForm.invalid||a.isLoading()),m(),s(a.isLoading()?15:16)}}var ce=class e{fb=f(X);router=f(T);route=f(k);firestoreService=f(j);authService=f(L);familyService=f(A);themeService=f(q);viewMode=y("select");isLoading=y(!1);isLoadingFamilies=y(!1);error=y(null);families=y([]);createForm=this.fb.group({name:["",[h.required,h.minLength(2)]]});joinForm=this.fb.group({inviteCode:["",[h.required]]});ngOnInit(){let i=this.route.snapshot.queryParams.invite;i&&(this.joinForm.patchValue({inviteCode:i}),this.viewMode.set("join")),this.loadFamilyNames()}loadFamilyNames(){return D(this,null,function*(){let i=this.authService.user();if(!i||Object.keys(i.familyMemberships).length===0){this.families.set([]);return}this.isLoadingFamilies.set(!0);try{let t=Object.entries(i.familyMemberships),a=[];for(let[l,p]of t)try{let ue=yield this.firestoreService.getDocument(`families/${l}`);a.push({familyId:l,name:ue?.name??l,role:p})}catch{a.push({familyId:l,name:l,role:p})}this.families.set(a)}catch(t){console.error("Error loading family names:",t)}finally{this.isLoadingFamilies.set(!1)}})}getRoleLabel(i){return{owner:"\u05D1\u05E2\u05DC\u05D9\u05DD",admin:"\u05DE\u05E0\u05D4\u05DC",member:"\u05D7\u05D1\u05E8",viewer:"\u05E6\u05D5\u05E4\u05D4"}[i]??i}selectFamily(i){return D(this,null,function*(){this.isLoading.set(!0),this.error.set(null);try{yield this.authService.setActiveFamily(i),yield this.familyService.loadFamily(i),this.router.navigate(["/app"])}catch(t){this.error.set(t.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D8\u05E2\u05D9\u05E0\u05EA \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4")}finally{this.isLoading.set(!1)}})}createFamily(){return D(this,null,function*(){if(!this.createForm.invalid){this.isLoading.set(!0),this.error.set(null);try{let i=yield this.familyService.createFamily({name:this.createForm.value.name});yield this.authService.setActiveFamily(i),yield this.familyService.loadFamily(i),this.router.navigate(["/app"])}catch(i){this.error.set(i.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D9\u05E6\u05D9\u05E8\u05EA \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4")}finally{this.isLoading.set(!1)}}})}joinFamily(){return D(this,null,function*(){if(!this.joinForm.invalid){this.isLoading.set(!0),this.error.set(null);try{let i=yield this.familyService.acceptInvite(this.joinForm.value.inviteCode);yield this.authService.setActiveFamily(i),yield this.familyService.loadFamily(i),this.router.navigate(["/app"])}catch(i){this.error.set(i.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D4\u05E6\u05D8\u05E8\u05E4\u05D5\u05EA \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4")}finally{this.isLoading.set(!1)}}})}logout(){return D(this,null,function*(){yield this.authService.logout(),this.router.navigate(["/auth/login"])})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=M({type:e,selectors:[["app-family-select"]],decls:20,vars:4,consts:[[1,"family-select-page"],[1,"family-select-container"],[1,"theme-toggle",3,"click"],[1,"family-select-card"],[1,"card-header"],[1,"logo"],[1,"form",3,"formGroup"],["mat-button","",1,"logout-button",3,"click"],[1,"families-list"],[1,"loading-state"],[1,"empty-state"],[1,"actions"],["mat-flat-button","","color","primary",3,"click"],["mat-stroked-button","",3,"click"],[1,"family-item",3,"active"],[1,"family-item",3,"click"],[1,"family-avatar"],[1,"family-info"],[1,"family-name"],[1,"family-role"],[1,"chevron"],["diameter","32"],[1,"hint"],[1,"form",3,"ngSubmit","formGroup"],["appearance","outline"],["matInput","","formControlName","name"],["matPrefix",""],[1,"error-message"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["diameter","20"],["matInput","","formControlName","inviteCode","dir","ltr"],[1,"hint-text"]],template:function(t,a){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),d("click",function(){return a.themeService.cycleTheme()}),n(3,"mat-icon"),r(4),o()(),n(5,"div",3)(6,"div",4)(7,"span",5),r(8,"\u{1F468}\u200D\u{1F469}\u200D\u{1F467}\u200D\u{1F466}"),o(),n(9,"h1"),u(10,de,1,0)(11,pe,1,0)(12,fe,1,0),o()(),u(13,ye,13,1)(14,Me,15,5,"form",6)(15,Oe,17,5,"form",6),o(),n(16,"button",7),d("click",function(){return a.logout()}),n(17,"mat-icon"),r(18,"logout"),o(),r(19," \u05D4\u05EA\u05E0\u05EA\u05E7\u05D5\u05EA "),o()()()),t&2){let l,p;m(2),b("aria-label","\u05E2\u05E8\u05DB\u05EA \u05E0\u05D5\u05E9\u05D0: "+a.themeService.getThemeLabel()),m(2),v(a.themeService.getThemeIcon()),m(6),s((l=a.viewMode())==="select"?10:l==="create"?11:l==="join"?12:-1),m(3),s((p=a.viewMode())==="select"?13:p==="create"?14:p==="join"?15:-1)}},dependencies:[w,I,Y,Q,H,J,K,W,U,Z,V,z,N,R,G,oe,ne,ee,te,ie,re,ae,$,B,me,le],styles:[".family-select-page[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--surface-app);padding:1rem}.family-select-container[_ngcontent-%COMP%]{width:100%;max-width:420px;position:relative}.theme-toggle[_ngcontent-%COMP%]{position:absolute;top:-3rem;left:0;background:var(--surface-primary);border:1px solid var(--border-default);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease}.theme-toggle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary)}.theme-toggle[_ngcontent-%COMP%]:hover{background:var(--surface-hover)}.family-select-card[_ngcontent-%COMP%]{background:var(--surface-primary);border-radius:1.5rem;padding:2rem;box-shadow:var(--shadow-lg);border:1px solid var(--border-subtle)}.card-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem}.card-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{font-size:2.5rem;display:block;margin-bottom:.75rem}.card-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--text-primary);margin:0}.families-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1.5rem}.family-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--surface-secondary);border:1px solid var(--border-default);border-radius:1rem;cursor:pointer;transition:all .2s ease;width:100%;text-align:right}.family-item[_ngcontent-%COMP%]:hover{background:var(--surface-hover);border-color:var(--border-strong)}.family-item.active[_ngcontent-%COMP%]{border-color:var(--color-primary);background:var(--color-primary-alpha)}.family-avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:var(--radius-lg);background:var(--color-primary);color:var(--text-on-primary);display:flex;align-items:center;justify-content:center;font-weight:var(--font-weight-semibold);font-size:var(--font-size-base)}.family-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.family-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary)}.family-role[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.chevron[_ngcontent-%COMP%]{color:var(--text-tertiary)}.empty-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem;color:var(--text-secondary)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:var(--text-tertiary);margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin:0 auto 1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.empty-state[_ngcontent-%COMP%]   p.hint[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   p.hint[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-tertiary);margin-top:.5rem}mat-divider[_ngcontent-%COMP%]{margin:1.5rem 0}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:48px;font-size:1rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.hint-text[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary);margin:0}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-2);padding:var(--spacing-3) var(--spacing-4);background:var(--error-bg);color:var(--color-error);border-radius:var(--radius-lg);font-size:var(--font-size-sm)}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:.5rem}.form-actions[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{flex:1}.logout-button[_ngcontent-%COMP%]{display:flex;margin:1.5rem auto 0;color:var(--text-secondary)}.logout-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem}"]})};export{ce as FamilySelectComponent};
