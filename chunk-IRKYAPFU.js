import{a as Y}from"./chunk-JZBGX4F2.js";import{a as ne,c as oe,d as re}from"./chunk-4S4SHBAA.js";import{a as Z,b as ee,d as te,h as ie}from"./chunk-PBF26NQQ.js";import{a as R,b as q}from"./chunk-IU263WV3.js";import{a as ae,b as le}from"./chunk-ORAJXFLG.js";import{a as B}from"./chunk-GYCTFNZ4.js";import{b as $,d as h,f as U,g as H,j as J,l as K,m as Q,p as W,r as X}from"./chunk-HVH6PFSI.js";import"./chunk-GY27VXU3.js";import{d as A}from"./chunk-WPQFOBGJ.js";import{b as L,d as z,e as N,f as G}from"./chunk-OHJUE5IH.js";import{i as V}from"./chunk-ZOWI4QAM.js";import{a as k,c as T,i as I}from"./chunk-HH43CGJO.js";import{j}from"./chunk-IGP4P7SY.js";import{j as O}from"./chunk-3EH3MU74.js";import{Ab as F,Bb as y,Cb as n,Db as o,Eb as g,Lb as x,Pb as d,Rb as u,Sa as m,Y as f,ba as p,bc as P,ca as _,dc as a,ec as D,fb as b,fc as w,oa as E,ub as S,vb as c,wb as s,zb as M}from"./chunk-HNLZOKXJ.js";import{f as v}from"./chunk-ATWMZ64T.js";var ue=(t,e)=>e.familyId;function ce(t,e){t&1&&a(0," \u05D1\u05D7\u05D9\u05E8\u05EA \u05DE\u05E9\u05E4\u05D7\u05D4 ")}function se(t,e){t&1&&a(0," \u05D9\u05E6\u05D9\u05E8\u05EA \u05DE\u05E9\u05E4\u05D7\u05D4 \u05D7\u05D3\u05E9\u05D4 ")}function de(t,e){t&1&&a(0," \u05D4\u05E6\u05D8\u05E8\u05E4\u05D5\u05EA \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4 ")}function pe(t,e){if(t&1){let i=x();n(0,"button",14),d("click",function(){let l=p(i).$implicit,C=u(3);return _(C.selectFamily(l.familyId))}),n(1,"div",15),a(2),o(),n(3,"div",16)(4,"span",17),a(5),o(),n(6,"span",18),a(7),o()(),n(8,"mat-icon",19),a(9,"chevron_left"),o()()}if(t&2){let i=e.$implicit,r=u(3);P("active",r.authService.activeFamilyId()===i.familyId),m(2),w(" ",i.familyId.substring(0,2).toUpperCase()," "),m(3),D(i.familyId),m(2),D(r.getRoleLabel(i.role))}}function _e(t,e){if(t&1&&(n(0,"div",8),M(1,pe,10,5,"button",13,ue),o()),t&2){let i=u(2);m(),F(i.getFamilies())}}function fe(t,e){t&1&&(n(0,"div",9)(1,"mat-icon"),a(2,"family_restroom"),o(),n(3,"p"),a(4,"\u05D0\u05D9\u05DF \u05DC\u05DA \u05DE\u05E9\u05E4\u05D7\u05D5\u05EA \u05E2\u05D3\u05D9\u05D9\u05DF"),o(),n(5,"p",20),a(6,"\u05E6\u05E8\u05D5 \u05DE\u05E9\u05E4\u05D7\u05D4 \u05D7\u05D3\u05E9\u05D4 \u05D0\u05D5 \u05D4\u05E6\u05D8\u05E8\u05E4\u05D5 \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4 \u05E7\u05D9\u05D9\u05DE\u05EA"),o()())}function ge(t,e){if(t&1){let i=x();c(0,_e,3,0,"div",8)(1,fe,7,0,"div",9),g(2,"mat-divider"),n(3,"div",10)(4,"button",11),d("click",function(){p(i);let l=u();return _(l.viewMode.set("create"))}),n(5,"mat-icon"),a(6,"add"),o(),a(7," \u05E6\u05D5\u05E8 \u05DE\u05E9\u05E4\u05D7\u05D4 \u05D7\u05D3\u05E9\u05D4 "),o(),n(8,"button",12),d("click",function(){p(i);let l=u();return _(l.viewMode.set("join"))}),n(9,"mat-icon"),a(10,"group_add"),o(),a(11," \u05D4\u05E6\u05D8\u05E8\u05E3 \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4 "),o()()}if(t&2){let i=u();s(i.hasFamilies()?0:1)}}function De(t,e){t&1&&(n(0,"mat-error"),a(1,"\u05E0\u05D0 \u05DC\u05D4\u05D6\u05D9\u05DF \u05E9\u05DD"),o())}function Ce(t,e){if(t&1&&(n(0,"div",25)(1,"mat-icon"),a(2,"error"),o(),n(3,"span"),a(4),o()()),t&2){let i=u(2);m(4),D(i.error())}}function ve(t,e){t&1&&g(0,"mat-spinner",29)}function ye(t,e){t&1&&a(0," \u05D9\u05E6\u05D9\u05E8\u05EA \u05DE\u05E9\u05E4\u05D7\u05D4 ")}function xe(t,e){if(t&1){let i=x();n(0,"form",21),d("ngSubmit",function(){p(i);let l=u();return _(l.createFamily())}),n(1,"mat-form-field",22)(2,"mat-label"),a(3,"\u05E9\u05DD \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4"),o(),g(4,"input",23),n(5,"mat-icon",24),a(6,"badge"),o(),c(7,De,2,0,"mat-error"),o(),c(8,Ce,5,1,"div",25),n(9,"div",26)(10,"button",27),d("click",function(){p(i);let l=u();return _(l.viewMode.set("select"))}),a(11," \u05D7\u05D6\u05E8\u05D4 "),o(),n(12,"button",28),c(13,ve,1,0,"mat-spinner",29)(14,ye,1,0),o()()()}if(t&2){let i,r=u();y("formGroup",r.createForm),m(7),s((i=r.createForm.get("name"))!=null&&i.hasError("required")&&((i=r.createForm.get("name"))!=null&&i.touched)?7:-1),m(),s(r.error()?8:-1),m(4),y("disabled",r.createForm.invalid||r.isLoading()),m(),s(r.isLoading()?13:14)}}function Ee(t,e){t&1&&(n(0,"mat-error"),a(1,"\u05E0\u05D0 \u05DC\u05D4\u05D6\u05D9\u05DF \u05E7\u05D5\u05D3 \u05D4\u05D6\u05DE\u05E0\u05D4"),o())}function he(t,e){if(t&1&&(n(0,"div",25)(1,"mat-icon"),a(2,"error"),o(),n(3,"span"),a(4),o()()),t&2){let i=u(2);m(4),D(i.error())}}function be(t,e){t&1&&g(0,"mat-spinner",29)}function Se(t,e){t&1&&a(0," \u05D4\u05E6\u05D8\u05E8\u05E4\u05D5\u05EA ")}function Me(t,e){if(t&1){let i=x();n(0,"form",21),d("ngSubmit",function(){p(i);let l=u();return _(l.joinFamily())}),n(1,"mat-form-field",22)(2,"mat-label"),a(3,"\u05E7\u05D5\u05D3 \u05D4\u05D6\u05DE\u05E0\u05D4"),o(),g(4,"input",30),n(5,"mat-icon",24),a(6,"vpn_key"),o(),c(7,Ee,2,0,"mat-error"),o(),n(8,"p",31),a(9,"\u05D4\u05D6\u05D9\u05E0\u05D5 \u05D0\u05EA \u05E7\u05D5\u05D3 \u05D4\u05D4\u05D6\u05DE\u05E0\u05D4 \u05E9\u05E7\u05D9\u05D1\u05DC\u05EA\u05DD \u05DE\u05D0\u05D7\u05D3 \u05DE\u05D1\u05E0\u05D9 \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4"),o(),c(10,he,5,1,"div",25),n(11,"div",26)(12,"button",27),d("click",function(){p(i);let l=u();return _(l.viewMode.set("select"))}),a(13," \u05D7\u05D6\u05E8\u05D4 "),o(),n(14,"button",28),c(15,be,1,0,"mat-spinner",29)(16,Se,1,0),o()()()}if(t&2){let i,r=u();y("formGroup",r.joinForm),m(7),s((i=r.joinForm.get("inviteCode"))!=null&&i.hasError("required")&&((i=r.joinForm.get("inviteCode"))!=null&&i.touched)?7:-1),m(3),s(r.error()?10:-1),m(4),y("disabled",r.joinForm.invalid||r.isLoading()),m(),s(r.isLoading()?15:16)}}var me=class t{fb=f(W);router=f(T);route=f(k);authService=f(j);familyService=f(A);themeService=f(B);viewMode=E("select");isLoading=E(!1);error=E(null);createForm=this.fb.group({name:["",[h.required,h.minLength(2)]]});joinForm=this.fb.group({inviteCode:["",[h.required]]});ngOnInit(){let e=this.route.snapshot.queryParams.invite;e&&(this.joinForm.patchValue({inviteCode:e}),this.viewMode.set("join"))}hasFamilies(){let e=this.authService.user();return e?Object.keys(e.familyMemberships).length>0:!1}getFamilies(){let e=this.authService.user();return e?Object.entries(e.familyMemberships).map(([i,r])=>({familyId:i,role:r})):[]}getRoleLabel(e){return{owner:"\u05D1\u05E2\u05DC\u05D9\u05DD",admin:"\u05DE\u05E0\u05D4\u05DC",member:"\u05D7\u05D1\u05E8",viewer:"\u05E6\u05D5\u05E4\u05D4"}[e]??e}selectFamily(e){return v(this,null,function*(){this.isLoading.set(!0),this.error.set(null);try{yield this.authService.setActiveFamily(e),yield this.familyService.loadFamily(e),this.router.navigate(["/app"])}catch(i){this.error.set(i.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D8\u05E2\u05D9\u05E0\u05EA \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4")}finally{this.isLoading.set(!1)}})}createFamily(){return v(this,null,function*(){if(!this.createForm.invalid){this.isLoading.set(!0),this.error.set(null);try{let e=yield this.familyService.createFamily({name:this.createForm.value.name});yield this.authService.setActiveFamily(e),yield this.familyService.loadFamily(e),this.router.navigate(["/app"])}catch(e){this.error.set(e.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D9\u05E6\u05D9\u05E8\u05EA \u05D4\u05DE\u05E9\u05E4\u05D7\u05D4")}finally{this.isLoading.set(!1)}}})}joinFamily(){return v(this,null,function*(){if(!this.joinForm.invalid){this.isLoading.set(!0),this.error.set(null);try{let e=yield this.familyService.acceptInvite(this.joinForm.value.inviteCode);yield this.authService.setActiveFamily(e),yield this.familyService.loadFamily(e),this.router.navigate(["/app"])}catch(e){this.error.set(e.message||"\u05E9\u05D2\u05D9\u05D0\u05D4 \u05D1\u05D4\u05E6\u05D8\u05E8\u05E4\u05D5\u05EA \u05DC\u05DE\u05E9\u05E4\u05D7\u05D4")}finally{this.isLoading.set(!1)}}})}logout(){return v(this,null,function*(){yield this.authService.logout(),this.router.navigate(["/auth/login"])})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=b({type:t,selectors:[["app-family-select"]],decls:20,vars:4,consts:[[1,"family-select-page"],[1,"family-select-container"],[1,"theme-toggle",3,"click"],[1,"family-select-card"],[1,"card-header"],[1,"logo"],[1,"form",3,"formGroup"],["mat-button","",1,"logout-button",3,"click"],[1,"families-list"],[1,"empty-state"],[1,"actions"],["mat-flat-button","","color","primary",3,"click"],["mat-stroked-button","",3,"click"],[1,"family-item",3,"active"],[1,"family-item",3,"click"],[1,"family-avatar"],[1,"family-info"],[1,"family-name"],[1,"family-role"],[1,"chevron"],[1,"hint"],[1,"form",3,"ngSubmit","formGroup"],["appearance","outline"],["matInput","","formControlName","name"],["matPrefix",""],[1,"error-message"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["diameter","20"],["matInput","","formControlName","inviteCode","dir","ltr"],[1,"hint-text"]],template:function(i,r){if(i&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),d("click",function(){return r.themeService.cycleTheme()}),n(3,"mat-icon"),a(4),o()(),n(5,"div",3)(6,"div",4)(7,"span",5),a(8,"\u{1F468}\u200D\u{1F469}\u200D\u{1F467}\u200D\u{1F466}"),o(),n(9,"h1"),c(10,ce,1,0)(11,se,1,0)(12,de,1,0),o()(),c(13,ge,12,1)(14,xe,15,5,"form",6)(15,Me,17,5,"form",6),o(),n(16,"button",7),d("click",function(){return r.logout()}),n(17,"mat-icon"),a(18,"logout"),o(),a(19," \u05D4\u05EA\u05E0\u05EA\u05E7\u05D5\u05EA "),o()()()),i&2){let l,C;m(2),S("aria-label","\u05E2\u05E8\u05DB\u05EA \u05E0\u05D5\u05E9\u05D0: "+r.themeService.getThemeLabel()),m(2),D(r.themeService.getThemeIcon()),m(6),s((l=r.viewMode())==="select"?10:l==="create"?11:l==="join"?12:-1),m(3),s((C=r.viewMode())==="select"?13:C==="create"?14:C==="join"?15:-1)}},dependencies:[O,I,X,J,$,U,H,Q,K,Y,V,z,L,G,N,ne,ie,Z,ee,te,re,oe,q,R,le,ae],styles:[".family-select-page[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--surface-app);padding:1rem}.family-select-container[_ngcontent-%COMP%]{width:100%;max-width:420px;position:relative}.theme-toggle[_ngcontent-%COMP%]{position:absolute;top:-3rem;left:0;background:var(--surface-primary);border:1px solid var(--border-default);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s ease}.theme-toggle[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary)}.theme-toggle[_ngcontent-%COMP%]:hover{background:var(--surface-hover)}.family-select-card[_ngcontent-%COMP%]{background:var(--surface-primary);border-radius:1.5rem;padding:2rem;box-shadow:var(--shadow-lg);border:1px solid var(--border-subtle)}.card-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem}.card-header[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{font-size:2.5rem;display:block;margin-bottom:.75rem}.card-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--text-primary);margin:0}.families-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1.5rem}.family-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem;background:var(--surface-secondary);border:1px solid var(--border-default);border-radius:1rem;cursor:pointer;transition:all .2s ease;width:100%;text-align:right}.family-item[_ngcontent-%COMP%]:hover{background:var(--surface-hover);border-color:var(--border-strong)}.family-item.active[_ngcontent-%COMP%]{border-color:var(--color-primary);background:var(--color-primary-alpha)}.family-avatar[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:var(--radius-lg);background:var(--color-primary);color:var(--text-on-primary);display:flex;align-items:center;justify-content:center;font-weight:var(--font-weight-semibold);font-size:var(--font-size-base)}.family-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:.25rem}.family-name[_ngcontent-%COMP%]{font-weight:600;color:var(--text-primary)}.family-role[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.chevron[_ngcontent-%COMP%]{color:var(--text-tertiary)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem 1rem;color:var(--text-secondary)}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:var(--text-tertiary);margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.empty-state[_ngcontent-%COMP%]   p.hint[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-tertiary);margin-top:.5rem}mat-divider[_ngcontent-%COMP%]{margin:1.5rem 0}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:48px;font-size:1rem}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.hint-text[_ngcontent-%COMP%]{font-size:.875rem;color:var(--text-secondary);margin:0}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-2);padding:var(--spacing-3) var(--spacing-4);background:var(--error-bg);color:var(--color-error);border-radius:var(--radius-lg);font-size:var(--font-size-sm)}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:.5rem}.form-actions[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{flex:1}.logout-button[_ngcontent-%COMP%]{display:flex;margin:1.5rem auto 0;color:var(--text-secondary)}.logout-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-inline-end:.5rem}"]})};export{me as FamilySelectComponent};
